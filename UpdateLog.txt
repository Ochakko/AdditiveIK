AdditiveIK UpdateLog
https://github.com/Ochakko/AdditiveIK


2024/03/29
　AdditiveIK 1.0.0.13 RC4(リリース候補4)
　　1.0.0.12からの変更点
　　　不具合修正
　　　　DepthOfField(DOF)の修正
　　　　　ボケるべき位置にボケない三角形が多数表示される不具合を修正
　　　　　SkyDOFの実装方法をSkyデプス方式からクリア方式へ変更
　　　　　大きいモデル(ポリゴン)表示時やカメラが遠くに離れた場合に不具合が生じていた
　　　　　RefPosをオンにした場合にも生じていた
　　　　RefPosの修正
　　　　　半透明がブレンドされていなかった不具合修正
　　　　　DOFと一緒に使うとボケない三角形が多数表示されていた不具合修正
　　　　　スキンメッシュの内部配列のインデックスが一部RefPosに対応できていなかった不具合修正
　　　
　　　アルファテストスライダー追加
　　　　ShaderプレートメニューにAlphaTestスライダーを追加
　　　　透明度がスライダー値より小さい場合にピクセル単位で描画をスキップする(アルファテスト)

　　　アルファテスト修正
　　　　アルファテスト時にシェーディングアルファ設定にも簡略計算にて対応
　　　　シェーディングアルファで透明度を設定しておいてからアルファテストスライダーを操作することにより
　　　　メッシュを明るい部分から徐々に出現させたり、暗い部分から徐々に消したりすることが可能
　　　　アルファテストで完全に消えた場合の跡地がDOFでボケるようになった　　　

　　　ブラシのスピーディー選択
　　　　3Dウインドウの何も無いところ(背景)を右クリックするとブラシ選択コンテクストメニューが出る
　　　　詳細な設定はBrusheParamsプレートメニューで行いますが、ブラシの種類をパッと変えたいときに便利

　　　選択中ブラシ名を表示
　　　　オイラーグラフのオイラー数値表示の並びに、選択中のブラシ名も表示


　　RC2:
　　　TestフォルダにBoySporty_2モデルを追加
　　　　新しいVRoidでモデルを出力し直して復活
　　　　顔のシェーディングが直った
　　RC3:
　　　OWPスライダーの修正
　　　　セパレータ内のスライダーの左ダブルクリックが効かなくなっていたのを修正
　　　　　ダブルクリック位置の数値を設定
　　　　セパレータ内の右ダブルクリックが効かなくなっていたのを修正
　　　　　アンドゥ
　　　　スライダードラッグ時につまみの位置が微妙にずれるのを修正
　　　　　クリック位置とつまみ位置のずれを保ったままドラッグによりスライドする
　　　　　修正により、つまみ中央をドラッグした場合にもつまみ位置とマウスと位置がぴったり合うことを確認
　　RC4:
　　　剛体マーク表示の修正
　　　　マルチスレッドのスロット番号合わせ
　　　　マウスホイール回転でタイムラインのフレームを変化させたときに、剛体マークとモデルの姿勢が描画１回分ずれていたのを修正
　　　　プレビュー時もマウスホイール時も表示がずれなくなった



動画
  ver1.0.0.4以降共通
　　新機能の使い方まとめ動画
　 　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　https://youtu.be/oKGY62YosSg






2024/03/25
　README.mdのスクリーンショット(説明付き)を更新　

　DOF修正
　　DOFを有効にすると大きいポリゴンやラインオブジェクトの境界部分にボケない三角形が表示される不具合を修正
　　　SkyDOFの実装方法としてSkyオブジェクトのZを使うのではなく、サーフェスをZPRE_ZMAXで初期化することにした
　　　dof.fx内のテクスチャサイズが間違っていたのを修正
　　　DOFとRefPosの相性は改善したので両方をオンにすることも可能に.
　　　相性問題の原因を探る過程でCModelにGroundFlag追加、ChkInViewで無条件視野内の場合にもダミーカメラ距離設定、skyのレンダリングパイプライン修正



2024/03/24
　RefPosのときだけ半透明がブレンドされない不具合を修正
　　refpos時にもカメラからの距離でソートして描画
　　視野内判定、カメラ距離をrefpos分計算して保持

　　RefPosオン時にはDOF描画をスキップ
　　　RefPosオン時にDOFをオンにするとオブジェクトの境目部分に不透明の三角が多数表示されるのでDOFの方をオフ

　スキンメッシュのパイプラインステートのルートシグネチャのインデックスにミスがあったのを修正
　　RefPosの際に単一モデルの描画多重化が出来ていないことがあったようだ

　DOF描画時のアルファテストを修正
　　DOF時にアルベドテクスチャのアルファだけチェックしていたが、DiffuseTextureのアルファも簡略計算ながら考慮に入れた
　　アルファテストで完全に消えたときにDOFでボケるようになった



2024/03/23
　ブラシ選択をスピーディーに
　　3Dウインドウの何も無いところを右クリックするとブラシ選択コンテクストメニューが出ます
　　詳細な設定はBrushesプレートメニューで行いますが、ブラシの種類をパッと変えたいときに便利になりました



2024/03/22
　アルファテストの閾値を設定可能に.
　　ShaderプレートメニューにAlphaTestスライダーを追加
　　1.0.0.12ではAlbgedoTextureのアルファだけで判定していたが、AlbedoTextureAlpha x DiffuseTextureAlphaで判定.

　RefPosのときだけ半透明がブレンドされない件を調査
　　描画前にソートしていないことが原因
　　後で対応予定




2024/03/20
　AdditiveIK 1.0.0.12 release
　　1.0.0.11からの変更点
　　　不具合修正
　　　　マルチスレッド処理修正
　　　　　マルチスレッドのスロット合わせし直し
　　　　　以前はループの最後と最初の部分で部分的に形状が伸びることがあったがその症状は解消した
　　　　　レンダリング中に姿勢計算をしても表示が乱れなくなった
　　　　シェーダーコンパイルエラー時にabortするように.
　　　　　ユーザーがシェーダーをいじることも想定
　　　　　エラーの時にはアプリを終了
　　　　　シェーダーにミスがあった場合(例えばfxファイルに全角スペース１個入っていた場合)にアプリとWindowsOSが固まる不具合を解消


　　　拡大、回転、移動の必要なものだけペースト
　　　　操作対象ボーン設定ダイアログに機能追加
　　　　ペーストショートカットボタンを右クリックで出る操作対象ボーン設定ダイアログに機能追加
　　　　PasteScale, PasteRotation, PasteTranslationの３つのチェックボックスを追加
　　　　スケール(拡大縮小)、ローテーション(回転)、トランスレーション(移動)の中の必要なものだけチェックしてペースト
　　　　SRT３つの組み合わせも可能

　　　ジャンプ補間ボタン
　　　　Hipsジャンプ補間ボタンを追加
　　　　上段カエルボタンを押したときに、補間ボタンの左隣にジャンプ補間ボタンを追加
　　　　選択フレーム範囲の最初フレームと最後フレームのHipsの移動アニメを放物線で補間する
　　　　最後のフレームでちょうど着地するように機能
　　　　ボタンを押したときに、ジャンプ補間用の重力設定ダイアログ(再計算ボタン付き)を表示

　　　常用スライダーを常駐
　　　　アプリ上部に常駐スライダーを追加
　　　　EditRateスライダー、Speedスライダー、TopPosスライダーを常駐ウインドウに配置していつでも操作可能に
　　　　TopPosスライダーの横幅が長くなったのでブラシのピーク位置の設定精度が上がった(長い分、目盛りが細かくなった)
　　　
　　　被写界深度(Depth of Field)対応
　　　　DOFプレートメニュー新規
　　　　ボカシ始め距離、ボカシ完了距離、SkyDof(天球にもボカシを入れるかどうか)の設定
　　　　８スロット分設定可能

　　　フォグ対応
　　　　Fogプレートメニュー新規
　　　　カメラ距離フォグと高さフォグに対応
　　　　フォグ色も指定可能　
　　　　８スロット分設定可能　　　　

　　　Skyプレートメニュー新規
　　　　８スロット分設定可能

　　　アルファテスト
　　　　ピクセルシェーダ内でテクスチャのアルファが0x08より小さい場合に書き込みをスキップ
　　　　書き込みスキップ時はZバッファにも描画されないのでテクスチャ抜きが綺麗に.
　　　
　　　シェーディングアルファ
　　　　BaseAのスライダーでマテリアルの透明度を設定可能
　　　　HiA,LowAも設定可能
　　　　マテリアルごとに
　　　　光の当たり方(シェーディング)によってアルファ(透明度)を徐々に変化させることが可能

　　　DispAndLimitsプレートメニューにAlphaBlendingチェックボックスを追加
　　　　アルファテストだけのアルファ抜き表示の時はオフ、ブレンドしたい場合にオン
　　　　オンにした場合にはZバッファのクリア１回分処理が増える

　　　ドキュメント追記
　　　　Documents/TroubleShooting/0_HowToSetShadowParams.docx
　　　　


　　RC2 : 
　　　　ScreenShotsフォルダに1.0.0.12の新機能に関するスクリーンショットを追加
　　　　追記：Documents/TroubleShooting/0_HowToSetShadowParams.docx　　　
　　RC3 : 
　　　　Sky,Fog,DOFダイアログがメインメニューバーの表示(disp)を操作しても出ないことがあった不具合修正
　　　　　プレートメニューからは出ていたが、メインメニューバーからは出ないことがあった
　　　　　プレートメニュー、メインメニューバー両方から表示できるように修正
　　　　README.mdで参照していた画像のリンク切れ修正
　　　　　RC2での整理の際に消し過ぎていたのを復活
　　RC4 :
　　　　マルチスレッドスロット番号処理に不具合があったので修正
　　　　　表示にだけ影響
　　　　　RefPosが表示されない不具合から発覚して修正
　　　　　RefPosの表示に関して
　　　　　　DOFオンの時にゴーストが消えたり、手前に表示するものがあるとブレンドされずに消えたりする問題あり
　　　　　　すぐには解決できないので次バージョン以降の課題として持ち越す




2024/03/18
　Shaderプレートメニューのマテリアルのアルファスライダーが機能するように.
　　BaseAのスライダーでマテリアルの透明度を設定可能
　　HiA,LowAも設定可能 : 光の当たり方によってアルファ(透明度)を徐々に変化させることが可能

　DispAndLimitsプレートメニューにAlphaBlendingチェックボックスを追加
　　アルファテストだけのアルファ抜き表示の時はオフ、ブレンドしたい場合にオン
　　オンにした場合にはZバッファのクリア１回分処理が増える

　Sky, Fog, DOFをプレートメニュー化
　　覚えやすいアクセス法、簡単アクセスに.
　　Skyに関しては設定ダイアログが大きくて右ペインに収まらないのでそのまま出すように.




2024/03/17
　アルファテスト
　　ピクセルシェーダ内でテクスチャのアルファが0x08より小さい場合に書き込みをスキップ
　　書き込みスキップ時はZバッファにも描画されないのでテクスチャ抜きが綺麗に.

　カメラアニメのMOTINFOについてもアクセスをカプセル化

　常駐スライダーによるサイズ変更の影響でウインドウに微妙に余白が出来ていたのを修正

　シェーダーコンパイルエラー時にabortするように.
　　エラーの時にはアプリを終了
　　シェーダーにミスがあった場合(例えばfxファイルに全角スペース１個入っていた場合)にアプリとWindowsOSが固まる不具合を解消




2024/03/16
　MOTINFO構造体へのアクセスをカプセル化
　　MOTINFO構造体のポインタへのアクセスはCModelからに限定し、他からのアクセスに対しては値を返すように.
　　Get,Set用の関数を追加

　README.mdに新しいスクリーンショットを追加


2024/03/15
　被写界深度(Depth of Field)対応
　　DispAndLimitsプレートメニューのZPrepassとHDRBloomにチェックを入れるとDOFが機能する
　　現在はカメラからの距離が3000からボケ始めて距離6000で最大のボケになる
　
　DOFパラメータ設定画面
　　メインメニューバーに　表示(disp)-->被写界深度設定(DOF Params)メニューを追加
　　ボカシの開始距離とボカシの終了距離を指定
　　天球にもボカシを掛けるかどうかのチェックボックスも追加
　　　ステージが無い場合に天球にボカシを掛けると、ボカシ距離より近いキャラクターにもボケが掛かります

　2024/3/13の修正で物理シミュ時にエンドジョイントの表示フレームが他のジョイントの表示フレームとずれていた
　　修正済


2024/03/14
　フォグ対応
　　メインメニューバーに　表示(disp)-->フォグ設定(FogParams)メニューを追加
　　カメラ距離フォグと高さフォグに対応
　　フォグ色も指定可能　
　
2024/03/13
　マルチスレッド表示の同期の仕方を再び修正
　　3/12の修正は表示速度が遅かったので、以前の方法で表示が乱れないように修正した
　　以前はループの最後と最初の部分で部分的に形状が伸びることがあったがその症状は解消した
　　レンダリング中に姿勢計算をしても表示が乱れなくなった

　マルチスレッド処理によりボーンマーク剛体マークの位置が１フレームずれていたのを修正
　　レンダースロットの姿勢の位置で計算するように.


2024/03/12
　Hipsジャンプ補間ボタンを追加
　　上段カエルボタンを押したときに、補間ボタンの左隣にジャンプ補間ボタンを追加
　　選択フレーム範囲の最初フレームと最後フレームのHipsの移動アニメを放物線で補間する

　　ボタンを押したときに、ジャンプ補間用の重力設定ダイアログ(再計算ボタン付き)を表示

　アプリ上部に常駐スライダーを追加
　　EditRateスライダー、Speedスライダー、TopPosスライダーを常駐ウインドウに配置していつでも操作可能に
　　TopPosスライダーの横幅が長くなったのでブラシのピーク位置の設定精度が上がった(長い分、目盛りが細かくなった)
　　
　表示の同期の仕方を修正
　　マルチスレッド処理についても処理ごとに同期することにした
　　大きく動く場合にも表示が乱れなくなった


2024/03/11
　操作対象ボーン設定ダイアログに機能追加
　　ペーストショートカットボタンを右クリックで出る操作対象ボーン設定ダイアログに機能追加
　　PasteScale, PasteRotation, PasteTranslationの３つのチェックボックスを追加
　　スケール(拡大縮小)、ローテーション(回転)、トランスレーション(移動)の中の必要なものだけチェックしてペースト
　　SRT３つの組み合わせも可能
　


2024/03/08
　AdditiveIK 1.0.0.11 release
　　1.0.0.10からの変更点
　　　不具合修正
　　　　インスタンシング描画修正
　　　　　プリミティブ数指定を修正
　　　　　直す前は、デバッグビルド実行時に警告が出ることがあったようだ

　　　　Shaderプレートメニュー修正
　　　　　見出しボタンを押した後にShaderTypeを変更した場合に
　　　　　最後のマテリアルの３文字タイプ表記が変わらない不具合を修正
　　　　　(設定はされていた)

　　　　fbxに四角形が含まれていた場合に警告ダイアログを出すように.
　　　　　エラーにはならないが４点目の法線を読み込んでいないので警告ダイアログを出した.
　　　　　ワーニングは１ノードに付き１回まで.

　　　　起動時のウインドウ大小選択ダイアログでキャンセルしてアプリを終了した場合に
　　　　　メモリリークしていたのを修正

　　　　法線マップとメタルマップのサンプラー修正
　　　　　複数アセットで確認したが、albedoとnormalとmetalはセットで切り替えるようだった
　　　　　normalとmetalのサンプラーにもalbedoのサンプラーを使用することにした
　　　　　TheHuntStreet1の地面の凸凹が改善した


　　　マテリアルごとに影を落とさない設定を可能に
　　　　ShaderプレートメニューにShadowCasterチェックボックス追加
　　　　天井や壁や仕切りカーテンなどに対してShadowCasterのチェックをオフにすることで狭い場所にもきれいに影が落ちやすくなった

　　　２番目のトークンで類似チェックオンオフを可能に
　　　　DispGroupプレートメニューのSimilarチェックをアップデート
　　　　メッシュ名を右クリックで出るコンテクストメニューに2nd ON, 2nd OFFを追加
　　　　_で区切られたメッシュ名の２つ目の_の後のトークンを元に処理
　　　　例えば、Model_tree_1というメッシュに対して2nd ONを実行するとModel_tree_2, Model_tree_3などがチェックオンになります

　　　ShaderプレートメニューにLightingチェックボックス追加
　　　　チェックオフ時にはライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示
　　
　　　DispAndLimitsプレートメニューのEnableLightチェックをオフにした場合は
　　　　シーン全体に対してライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示

　　　天球表示をオプションに
　　　　DispAndLimitsプレートメニューにSkyDispチェックボックスを追加

　　　天球マテリアル設定機能追加
　　　　アプリ上部のメインメニューバーの表示(disp)-->天球設定(SkyParams)メニュー選択でダイアログ表示
　　　　設定はアプリ終了時自動保存、アプリ起動時自動読込

　　　UVの繰り返し回数設定
　　　　ShaderプレートメニューにTilingU, TilingVのスライダーを追加
　　　　スライダー設定をリアルタイムでテクスチャの繰り返し回数として適用
　　　　Albedoテクスチャ, Normalテクスチャ, Metalテクスチャすべてに影響
　　　　fbxファイルのUVScalingに保存して読み込み
　　　　UVScalingはMayaとUnityでは現在は無視されているようにみえる
　　　　fbxの正式なtiling回数の保存読み込みに関しては不明

　　　CameraDistスライダーの最大値を1000から5000に変更


　　RC2:
　　　起動時のウインドウ大小選択ダイアログでキャンセルしてアプリを終了した場合に
　　　メモリリークしていたのを修正
　　RC3:
　　　ShaderプレートメニューのHSVスライダーなどが機能しなくなっていたのを修正
　　　　DlgProcで設定中に初期化されていたのが原因だった(今回のバージョン用の修正にて出ていた不具合)
　　　法線マップとメタルマップのサンプラー修正
　　　　複数アセットで確認したが、albedoとnormalとmetalはセットで切り替えるようだった
　　　　normalとmetalのサンプラーにもalbedoのサンプラーを使用することにした
　　　　TheHuntStreet1の地面の凸凹が改善した
　　　CameraDistスライダーの最大値を1000から5000に変更
　　　ShaderメニューとDispGroupメニューでPick&Set中にはボーンをピックしないように修正
　　　　Pick&Set中にクリック位置近くにボーンがある場合に設定が出来なくなっていたため
　　　fbx読み込み時にUVScaleの最小値を1.0として読み込むように
　　RC4:
　　　fbx読み込み時にマテリアルが無い場合にもERROR: MaterialNum Overflowの警告が出ていたのを修正
　　　　モーションキャプチャのモーションだけのfbxの読み込み時に要らない警告が出ていた
　　　　今回のバージョン用の修正により起きていた不具合

　　　




2024/03/07
　インスタンシング描画修正
　　プリミティブ数指定を修正
　　直す前は、デバッグビルド実行時に警告が出ることがあったようだ

　ShaderプレートメニューにLightingチェックボックス追加
　　チェックオフ時にはライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示
　　
　　DispAndLimitsプレートメニューのEnableLightチェックをオフにした場合は
　　シーン全体に対してライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示

　天球マテリアル設定機能追加
　　アプリ上部のメインメニューバーの表示(disp)-->天球設定(SkyParams)メニュー選択でダイアログ表示
　　設定はアプリ終了時自動保存、アプリ起動時自動読込



2024/03/05
　UVの繰り返し回数設定
　　ShaderプレートメニューにTilingU, TilingVのスライダーを追加
　　スライダー設定をリアルタイムでテクスチャの繰り返し回数として適応
　　Albedoテクスチャ, Normalテクスチャ, Metalテクスチャすべてに影響
　　fbxファイルのUVScalingに保存して読み込み
　　UVScalingはMayaとUnityでは現在は無視されているようにみえる
　　fbxの正式なtiling回数の保存読み込みに関しては不明


2024/03/04
　Shaderプレートメニュー修正
　　見出しボタンを押した後にShaderTypeを変更した場合に
　　最後のマテリアルの３文字タイプ表記が変わらない不具合を修正
　　(設定はされていた)

　　マテリアルの最大数は1000個だが一時的に4個に変えてみてオーバーフロー時の処理を修正
　　エラーダイアログを出して、ショートカット一覧ウインドウに切り替えるようにした
　　修正後に元の1000個に戻した

　天球表示をオプションに
　　DispAndLimitsプレートメニューにSkyDispチェックボックスを追加
　　
　　こちらの環境では
　　freefpsオン時に３D画面上部にティアリングによる横線が表示されているのが確認された
　　更に調べてみたところ、黒色の横線はSkyDispオンオフに関わらずY12位の位置に表示されていた
　　画面上部上からY24までの部分に黒いアッパーバーを表示することにより、ティアリングに気が付かないようにすることが出来た
　　

2024/03/03
　ShaderプレートメニューにShadowCasterチェックボックス追加
　　天井や壁や仕切りカーテンなどに対してShadowCasterのチェックをオフにすることで狭い場所にもきれいに影が落ちやすくなった

　複数モデルを含むプロジェクトファイル読み込み時やモデル切り替え時に、カレントボーン番号(選択中のボーンの番号)を初期化
　　NULLチェックはしていたのでエラーにはなっていなかったが、デバッグビルドのポインタ確認箇所でASSERTしていたので修正
　　
　fbxに四角形が含まれていた場合に警告ダイアログを出すように.
　　エラーにはならないが４点目の法線を読み込んでいないので警告を出した.
　　ワーニングは１ノードに付き１回まで.


2024/03/02
　天球(sky)モデルを表示
　　透過テクスチャの奥に空が表示されるように天球は最初にレンダーするように.
　　Media/CelestialSphereフォルダに天球データを置くことにした.フォルダ内のReadMe.txtを参照.
　　
　DispGroupプレートメニューのSimilarチェックをアップデート
　　メッシュ名を右クリックで出るコンテクストメニューに2nd ON, 2nd OFFを追加
　　_で区切られたメッシュ名の２つ目の_の後のトークンを元に処理
　　例えば、Model_tree_1というメッシュに対して2nd ONを実行するとModel_tree_2, Model_tree_3などがチェックオンになります

　　

2024/02/29
　ショートムービー
　　半回転階段チャレンジ
　　https://youtu.be/TzlAqf45jIQ



2024/02/27
　AdditiveIK 1.0.0.10 release
　　1.0.0.9からの変更点
　　　不具合修正
　　　　シャドウカメラの計算を修正
　　　　　思った通りになっていなかったのを修正
　　　　ピック&セットの不具合修正
　　　　　DispGroupプレートメニューにおいて、クリックしてもGUI上で選択メッシュが自動選択されないケースがある不具合修正
　　　　　選択メッシュをみつけた場合のbreak抜けにより自動選択されないケースがあった
　　　　OWP_Sliderの修正
　　　　　スライダー上のクリック位置からの移動量でスライドする機能の修正
　　　　　スライダーがセパレータの右側にある場合に計算が間違っていたのを修正
　　　　Testフォルダのモデル更新
　　　　　新しいVRoidのモデルはStdシェーダで表示しても顔の中央に白いラインが出ないので、今後は新しいVRoidのモデルを使用する
　　　　　2/22のモーキャプ＠夕暮れキッチン(https://youtu.be/pMRaTOw5B38)のモデルを新規
　　　　　スカートに剛体設定してスカートのシミュをオンに設定
　　　　　ジャンプした際にスカートががめくれないようにするにはこちらではDispAndLimitsメニューのSpeedを0.5に.　
　　　　Rigの軸がドラッグ開始姿勢に依存していた問題解決
　　　　　ジョイントドラッグのIKはうまくいっていたがRigで問題が出ていた
　　　　　Rigの軸としてNodeX, NodeY, NodeZのどれかを選ぶことで動作が安定
　　　　　ただしfbxのジョイントに適切な初期姿勢が設定されていることが前提
　　　　　初期姿勢が設定されていない場合にNodeX, NodeY, NodeZを指定するとボーン軸ではなくグローバルXYZの回転になってしまう
　　　　　新しいVRoidのモデルではうまくいっているようだ
　　　　DispGroupメニューのメッシュ名右クリックからのSimilarON,OFFの修正
　　　　　処理関数を書き直し
　　　　　先頭に'_'があってもうまくいくようになった
　　　　DispGroupメニューの項目の選択処理が重すぎたのを修正
　　　　　プログラムからの項目選択時にも項目選択リスナーを呼び出していたのを呼び出さないように修正
　　　　カメラドリーダイアログの修正
　　　　　カメラドリーダイアログを出したときにカメラの位置が変わってしまわないように修正
　　　　　(保存したいカメラ画面にしてからダイアログを出す場合に画面が変わると困るから)

　　　カメラターゲットに関わるGUIを右ペインの上のウインドウに常駐
　　　　Lock2Jointチェックボックス : 選択中のジョイントをカメラの注視点にする
　　　　DispTargetチェックボックス : カメラターゲットの位置にマニピュレータと位置座標の数値を表示する
　　　　CamDistスライダー : カメラの視点と注視点の距離を設定する
　　　　MoveEyePosチェックボックス : オフの時スライダー操作時に注視点を移動、オンの時スライダー操作時にカメラ位置を移動.
　　　　CamDistスライダーで注視点を前後させて、カメラの回転の中心を設定することが可能
　　　　MoveEyPosチェックとスライダーの組み合わせで、尺取虫の様にカメラを操作することも可能
　　　　注視点はカメラを回転する場合の回転中心になる

　　　
　　　ファイルオープンダイアログを通常のエクスプローラタイプに変更
　　　　エクスプローラタイプに変更するとファイルを選択しやすい
　　　　しかし
　　　　現状のゲームパッド対応コードでは目的のGUIコントロールを取得することが出来なかった
　　　　(ゲームパッドでオープンダイアログのボタンを押すことが出来ない)
　　　　ゲームパッド対応はモーション遷移テストやキャラクターの移動などに限定して使用していく予定
　　　　ゲームパッド対応時にもマウスは必要という方針に変更
　　　　どうしてもゲームパッドでファイルを開く必要が生じた場合には、ゲームパッドでピック可能なオープンダイアログを作ることになる
　　　　ver1.0.0.10時点では一時的にゲームパッド対応コードをコメントアウトしている
	
　　　LightsプレートメニューのGUI改良
　　　　ライトの方向を設定するためのGUIを極座標表現に変更
　　　　角度２つで設定可能なのでベクトル指定よりも直感的に設定することが可能
　　　　内部データと読み書き用ファイルは向きベクトルのまま
　　　　極座標のXZの角度は本来はX軸方向だが、アプリ起動時のカメラの向きに合わせてZ軸方向を0度にした
　　　　GUIでの角度の数値の小数第２位以降は誤差ですが、表示桁数を減らすと余計に誤差が大きくなるので小数４桁表示しています
　　　
　　　マニピュレータ表示修正
　　　　回転モードのときにはリングも表示
　　　　移動モード、拡縮モードの時には軸だけ表示

　　　DispGroupメニューにClearボタンを追加
　　　　メッシュ名のチェックマークをクリアするボタン

　　　ドキュメント追加
　　　　Documents/TroubleShooting/0_HowToSetPhysicsOfSkirt.docx
　　　　Documents/TroubleShooting/0_HowToSetShadowParams.docx
　　　　Documents/TroubleShooting/0_Win32DialogHasABlackFrame.docx

　　RC1: 
　　　右ペイン上部のカメラターゲットウインドウにMoveEyePosチェックボックスを追加
　　　オンにするとスライダー操作時にカメラ位置を移動、オフにするとスライダー操作時に注視点を移動
　　　MoveEyePosチェックボックスとCamDistスライダーで尺取虫のようにカメラを操作することが可能
　　　注視点はカメラを回転する場合の回転中心になる
　　RC2:
　　　カメラドリースプライトのドラッグが効かなくなっていたのを修正
　　　CameraTargetウインドウのDispTargetにチェックを入れている間はターゲット位置に座標のツールチップを表示
　　RC3:
　　　DispGroupメニューのメッシュ名右クリックからのSimilarON,OFFの修正
　　　　処理関数を書き直し
　　　　先頭に'_'があってもうまくいくようになった
　　　DispGroupメニューにClearボタンを追加
　　　　メッシュ名のチェックマークをクリアするボタン
　　　DispGroupメニューの項目の選択処理が重すぎたのを修正
　　　　プログラムからの項目選択時にも項目選択リスナーを呼び出していたのを呼び出さないように修正
　　　カメラドリーダイアログの修正
　　　　カメラドリーダイアログを出したときにカメラの位置が変わってしまわないように修正
　　　　(保存したいカメラ画面にしてからダイアログを出す場合に画面が変わると困るから)
　　RC4:
　　　Testフォルダのモデルの設定ファイルを修正
　　　　新しいモデルのtboファイル(操作対象ボーン設定ファイル)が未設定だったのを修正
　　release:
　　　Lightsメニューの角度Yの符号が反転する不具合を修正
　　　　符号が反転してしまった数値は自動的には直りません


動画
　　モーキャプ＠夕暮れキッチン
　　https://youtu.be/pMRaTOw5B38

　 【ショート】ピッチャーと棒【モーキャプ】
　　https://youtu.be/WG7QEvYetJg

　 【モーキャプ】VRoidでプロのアセットを飛んでみた【編集ツール】
　  https://youtu.be/R0MsXt8plYg

  ver1.0.0.4以降共通
　　新機能の使い方まとめ動画
　 　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　https://youtu.be/oKGY62YosSg





2024/02/26午前
　カメラターゲットに関わるGUIを右ペインの上のウインドウに常駐
　　Lock2Jointチェックボックス : 選択中のジョイントをカメラの注視点にする
　　DispTargetチェックボックス : カメラターゲットの位置にマニピュレータを表示する
　　CamDistスライダー : カメラの視点と注視点の距離を設定する

　　CamDistスライダーで注視点を前後させて、カメラの回転の中心を設定することが可能
　　
　マニピュレータ表示修正
　　回転モードのときにはリングも表示
　　移動モード、拡縮モードの時には軸だけ表示

　OWP_Sliderの修正
　　スライダー上のクリック位置からの移動量でスライドする機能の修正
　　　スライダーがセパレータの右側にある場合に計算が間違っていたのを修正



2024/02/25
　ドキュメント追加
　　Documsnts/TroubleShooting/0_HowToSetShadowParams.docx
　　Documsnts/TroubleShooting/0_Win32DialogHasABlackFrame.docx
　
　シャドウのシャドウカメラ位置の計算を大幅修正
　　思った通りになっていなかったのを修正
　　設定の仕方はDocumsnts/TroubleShooting/0_HowToSetShadowParams.docxに記述



2024/02/24
　ドキュメント追加
　　　　Documsnts/TroubleShooting/0_HowToSetPhysicsOfSkirt.docx

　ピック&セットの不具合修正
　　DispGroupプレートメニューにおいて、クリックしてもGUI上で選択メッシュが自動選択されないケースがある不具合修正
　　　選択メッシュをみつけた場合のbreak抜けにより自動選択されないケースがあった

　ファイルオープンダイアログを通常のエクスプローラタイプに変更
　　エクスプローラタイプに変更すると
　　　ファイルを選択しやすい
　　　しかし
　　　現状のゲームパッド対応コードでは目的のGUIコントロールを取得することが出来なかった
　　　ゲームパッド対応はモーション遷移テストやキャラクターの移動などに限定して使用していく予定
　　　ゲームパッド対応時にもマウスは必要という方針に変更
　　　どうしてもゲームパッドでファイルを開く必要が生じた場合には、ゲームパッドでピック可能なオープンダイアログを作ることになる
　　　2024/02/24時点では一時的にゲームパッド対応コードをコメントアウトしている
	
　LightsプレートメニューのGUI改良
　　ライトの方向を設定するためのGUIを極座標表現に変更
　　内部データと読み書き用ファイルは向きベクトルのまま
　　極座標のXZの角度は本来はX軸方向だが、アプリ起動時のカメラの向きに合わせてZ軸方向を0度にした
　　GUIでの角度の数値の小数第２位以降は誤差ですが、表示桁数を減らすと余計に誤差が大きくなるので小数４桁表示しています



############
## 備考002
############
　右ペインのWin32ダイアログに黒い枠表示が付いてしまう件
　　ウインドウの背景色は本来はプログラムごとにいじるものではないらしい
　　WindowsのユーザがWindowsの設定画面を使ってテーマと背景色を設定するのが本来のやり方とのこと
　　設定の仕方としてはWindows11においては以下のようだった
　　　設定-->アクセシビリティ-->コントラストテーマ-->夜空-->適用する
　　上記設定をするとWindows11全体としてウインドウの背景色が黒になる
　　ショートカットでテーマのオンオフも可能
　　　左Alt + 左Shift + PrintScreenでテーマをオンオフ





2024/02/23
　Testフォルダのモデル更新
　　新しいVRoidのモデルはStdシェーダで表示しても顔の中央に白いラインが出ないので、今後は新しいVRoidのモデルを使用する
　　2/22のモーキャプ＠夕暮れキッチンのモデルを新規
　　スカートに剛体設定してスカートのシミュをオンに設定
　　ジャンプした際にスカートががめくれないようにするにはこちらではDispAndLimitsメニューのSpeedを0.5に.　

　Rigの軸がドラッグ開始姿勢に依存していた問題解決
　　ジョイントドラッグのIKはうまくいっていたがRigで問題が出ていた
　　Rigの軸としてNodeX, NodeY, NodeZのどれかを選ぶことで動作が安定
　　ただしfbxのジョイントに適切な初期姿勢が設定されていることが前提
　　初期姿勢が設定されていない場合にNodeX, NodeY, NodeZを指定するとボーン軸ではなくグローバルXYZの回転になってしまう
　　新しいVRoidのモデルではうまくいっているように思う(詳しくは調べてはいない)



2024/02/22夜
　ショートムービー
　モーキャプ＠夕暮れキッチン
　https://youtu.be/pMRaTOw5B38




2024/02/22
　AdditiveIK 1.0.0.9 release
　　1.0.0.8からの変更点
　　　不具合修正
　　　　ノーマルマップを小さく表示するとモアレが出る不具合修正
　　　　ノーマルマップだけMipMapを0に固定していたのが原因
　　　AdditiveIKの方向性としてトゥーンベースに
　　　　全てのシェーダ(PBR, Std. Toon)において拡散色のシェーディング時にHSV_Toonを参照するように.
　　　　黒くなるシェーディングではなく
　　　　色相を保ちながらまたは色相を変化させながらHSVのVが小さくなるシェーディングが可能.
　　　　ベースとなるToon設定としてグラデーションとパワートゥーンを追加.
　　　　顔の陰が綺麗に出るようにNormalY0チェックボックスを追加.
　　　　SpecularCoefスライダでスペキュラーの倍率をマテリアルごとに設定可能に.
　　　Q2Eul_Thresholdプレートメニューを追加
　　　　Retargetメニューの並びに配置.
　　　　リターゲット時、fbx入出力時と姿勢をオイラー角に変換する計算時に使用する閾値の調整が可能.
　　　Rigidプレートメニューの各項目の右にToDeeperボタンを追加
　　　　選択剛体の全ての子供の剛体に対してカレント値をコピペ.
　　　　例えば手の甲に物理パラメータ設定をしてToDeeperボタンを押すと子供の指剛体全部にコピペされる.
　　　ドキュメント追加
　　　　Documsnts/TroubleShooting/0_HowToSettingsAboutShaders.docx
　　　　Documsnts/TroubleShooting/0_ThresholdSettingForFlipMotionCorrection.docx

　　　RC2: 
　　　　ウインドウ小モードにおける各種ダイアログの大きさ調整. 見切れすれすれのものが多数あったので対応.
　　　　Q2Eul_ThreasholdプレートメニューにDefaultValueボタンを追加.　数値が分からなくなった時用.
　　　　法線マップとメタルマップのサンプラーのフィルターをMIP_POINTに変更. ぼけ過ぎないように.
　　　　UV0とUV1の切り替えテストのためのUVSet決め打ちコードが残っていたのを修正.　fbxの元のものを読まないと正しく直らないことも有り.
　　　　ScreenShotフォルダの中身を新しいSSに更新.
　　　　TestフォルダのモデルのShader設定を更新.　体はStd.　顔だけToonLit2でY0フラグオン.　顔のセンターの法線の具合がStd.で光るので対策.
　　　RC3:
　　　　TestフォルダのSpringモデルとWinterモデルの顔シェーダの再調整
　　　release:
　　　　TestフォルダのSpringモデルとWinterモデルの顔シェーダの再調整
　　　　(DispAndLimitsプレートメニューのライト倍率(全てのライト対してに掛ける倍率)が違うと見え方がかなり変わるので、設定時にはライト倍率を確認)





2024/02/21午前
　【ショート】ピッチャーと棒【モーキャプ】
　　https://youtu.be/WG7QEvYetJg

　　

2024/02/20
　Rigidプレートメニューの各項目の右にToDeeperボタンを追加
　　選択剛体の全ての子供の剛体に対してカレント値を設定するボタン

　Retargetプレートの並びにQ2Eul_Thresholdプレートメニューを追加
　　リターゲット時、fbx入出力時と姿勢をオイラー角に変換する計算時に使用する閾値の調整が可能
　　例えばリターゲット結果の頭の向きが１８０度裏返ることが稀にありますが
　　Q2Eul_thresholdメニューのEndJoint閾値を調整する(オイラーグラフをみながら推定して変更する)ことで直ることが多いです
　　モーションキャプチャは測定値であり誤差も様々なので閾値も臨機応変に変える必要があります
　　設定した閾値の値はアプリ終了時に保存されて起動時に自動で読み込みます
　　それでも直らないことがありますが、その場合にはオイラーグラフをみながらLimitEulをオンにしてダイアログで制限角度を設定すると緩和されます




2024/02/19
　README.mdにシェーダまとめの図を追加

　ShaderプレートメニューにGUI追加
　　SpecularCoefスライダ：マテリアルごとにスペキュラー倍率を指定
　　NormalY0チェックボックス：トゥーンテクスチャ参照計算時の法線のY成分をキャンセルするかどうかのフラグ
　　　デフォルト値はスキンメッシュでオン、非スキンメッシュでオフ
　　　モデルの顔のシェーディングの際にきれいに陰色を付けるために法線のY成分を0として計算するためのもの


2024/02/18
　HSV_Toon改良
　　ShaderプレートメニューにPowerToonチェックボックスを追加
　　Gradationチェック時の色の補間もHSVで行うように.
　　PowerToonチェック時にはLow-->Base, Base-->Highの補間にpowを使用.
　　Gradationチェックをオフにした場合にはPowerToonチェックボックスは無効に.
　　プロジェクト保存と読み込み時にGradationとPowerToon設定も保存と読み込み.

    シェーダを好みに近づけていく作業
　　　キャラクター(VRoid)はベタ塗という路線において、リアルな背景アセットについてもおかしくないようにトゥーン化する必要がある.
　　　全てのシェーダをトゥーンベースに.
  　　Std.シェーダとPBRシェーダのライトループ中の拡散色計算にもHSV_Toonを使用.
　　　Std.シェーダは実質ライト８個(ライト色も反映)までのトゥーンシェーダ(HSV_Toon)になった.
　　　PBRシェーダはも同様に実質ライト８個(ライト色も反映)までのHSV_Toon.
　　　PBRシェーダの場合には法線マップが考慮されてSmoothCoefスライダー設定が有効.
　　　HSVToonシェーダ単体としてはトゥーンテクスチャ設定用なので白色ライト１個のトゥーンシェーダ.

　PBRの法線マップが小さい画面でモアレ表示になる不具合修正
　　法線マップだけLOD読み込み用の関数でLOD_0を指定して読み込んでいたため



2024/02/17
　HSV_ToonにGradation(グラデーション)追加
　　ShaderプレートメニューにGradationチェックボックスを追加
　　Gradationをオンにすると滑らかにトゥーン色を変化させる
　　変化のさせ方はまだ確定していない.　とりあえず線形補間からスタート.
　　初期状態でGradationオン.


2024/02/17
　AdditiveIK 1.0.0.8 release
　　1.0.0.7からの変更点
　　　能動的デストラクトとメモリリーク解消
　　　　Direct3Dオブジェクトをメンバに持つ自動変数、static変数、global変数の解放を能動的に行った
　　　　アプリ終了時に自動開放を待たずに能動的にデストラクトすることによりリークしていたメモリを把握出来て修正することが出来た
　　　　ダンプにおいてDebugDevice以外のRefcountが0になった(IntRefには何か書いてあるが問題ないらしい)
　　　　メモリリークは解決したようだ
　　　TOONシェーダ対応(HSV_Toon)
　　　　NOLIGHTシェーダをTOONシェーダに変更
　　　　Shaderプレートメニューでマテリアル名のボタンを押してToonを選択すると機能
　　　　TOON用のライトとしてはLightプレートメニューのライトの向きを使用
　　　　マテリアルの拡散色から自動的にTOONテクスチャを作成しdiffuseMapとしてシェーダで使用
　　　　設定画面
　　　　　Shaderプレートメニューで設定
　　　　　面の向きとToon用ライトの向きが同じ向きを向いているほどHiAddr,LowAddrのスライダーは右側にします
　　　　　HiAddrよりも向きが同じ方向の場合にはハイライト色、LowAddrよりも向きが違う場合には陰色、どちらでもない場合にはベース色を表示
　　　　　トゥーンの色の設定はHSVで行います
　　　　　HSVのHは色相で0から360の数値をとります.　Sは彩度で0から1、Vは輝度で0から1.
　　　　　Base色はHSVの数値そのものを指定.
　　　　　AddH, AddS, AddVはベース色のHSVに加える分(引くときはマイナスの数値を指定)の数値を指定.
　　　　　各設定項目にはGUIスライダー有り
　　　　　プロジェクト保存時に*.stfファイルにテキスト保存、プロジェクト読み込み時に自動読込
　　　PBR, StdのdiffuseMap参照の際にもHSV_Toonのテクスチャを参照
　　　PBRの法線修正
　　　　法線マップが無い場合には頂点法線を使用するように.
　　　　法線マップが無いメッシュにPBRシェーダを選んでもそれなりに表示されるように.
　　　NumKeyピッキング
        ShaderプレートメニューとDispGroupプレートメニュー時のピック処理修正
　　　　オブジェクトの中心がカメラから一番近いオブジェクトをピックしていました.
　　　　オブジェクトの形状によっては意図したオブジェクトがピック出来ないことがありました.
　　　　1-9の番号を押しながらピックすることでカメラから番号番目に近いオブジェクトをピックするようにしました.
　　　　処理の高速化のために距離の順番はカメラとオブジェクト中心との距離、見つかった時点ですぐに結果を返す仕様.
　　　　現在は非スキンメッシュだけがピック対象(これも高速化のため).
　　　1オブジェクトだけのテスト表示機能
　      DispGroupプレートメニューのTestボタンが機能していなかったのを修正
　　　Rigスプライトの画像ファイル更新
　　　　見やすく
　　　ZPreCullingをデフォルトでオフ
　　　　ZPreによる効果よりも不具合の方が多くなってきたため.
　　　RefPosの選択ジョイント軌跡表示修正
　　　　カレントフレームの選択ジョイント位置も軌跡に含めるように.
　　　TestフォルダのモデルのShader設定を修正
　　

    ###############################
　　###  HSV_Toon設定時の注意  ####
    ###############################
　　　HSV_ToonにはRGBとHSVの変換計算が関係しています
　　　Windowsに付いているペイントというソフトで色作成ボタンを押して
　　　色の種類をRGBからHSVに変えてから色の位置をいろいろクリックすると分かるのですが。
　　　HSVのSが0の場合にはHをどんなに変えても色は白です.
　　　fbxの拡散色として真っ白が設定されている場合、Sが0になっています.
　　　その状態から色を変えたい場合には、まずSとVを変えてからHを変えてください.
　　　


　RC2: HSV_Toonの修正
　　　色の境目ではない場所に細い筋が表示されていた不具合修正
　　　Testフォルダのモデルの設定を再修正
　RC3: メモリリーク解決
　　　AdditiveIK.cppにおいてID3D12DebugDeviceを使用してリークの詳細ダンプをした
　　　DirectXのCreate*関数で作成したオブジェクトにアロケート番号付きの名前をSetNameして調査
　　　ダンプにおいてdebugdevice以外のRefcountが0になった(IntRefには何か書いてあるが)
　　　メモリリークは解決したようだ
　RC4: HSV_Toonのライトの向きに関する修正
　　　Lightプレートメニューで有効にチェックしていないライト(の向きだけ)も選択可能に.
　RC5: ShaderプレートメニューのToonパラメータの数値テキストが見切れていたのを修正.
　RC6: ShaderプレートメニューとDispGroupプレートメニュー時のピック処理修正
　RC7: NumKeyピッキングの検索ループにおいて、同じオブジェクトを見つけた場合には階層数を足さずにcontinueするように.
　　　 DispGroupプレートメニューのTestボタンが機能していなかったのを修正





2024/02/14_1
　HSV_Toonの修正
　　シェーダでの法線の計算が間違っていたのを修正
　　BaseHSVの設定項目追加
　　HSV_Toon用のライトインデックス設定項目追加
　　Shaderメニューで全マテリアル設定を選んだ場合(見出し行のボタンを押した場合)の処理を修正
　PBR, StdのdiffuseMap参照の際にもHSV_Toonのテクスチャを参照
　PBRの法線修正
　　法線マップが無い場合には頂点法線を使用するように.
　Rigスプライトの画像ファイル更新
　　見やすく
　ZPreCullingをデフォルトでオフ
　TestフォルダのモデルのShader設定を修正
　　顔には陰が付かないように.




2024/02/13
　TOONシェーダ対応
　　NOLIGHTシェーダをTOONシェーダに変更
　　Shaderプレートメニューでマテリアルの名前のボタンを押してToonを選択すると機能
　　TOON用のライトとしてはLightプレートメニューの１番目のライトの向きを使用
　　マテリアルの拡散色から自動的にTOONテクスチャを作成しdiffuseMapとしてシェーダで使用
　　設定画面
　　　Shaderプレートメニューで設定
　　　面の法線(シェーダで少し加工)とライト向き(シェーダで少し加工)の内積をnlとして説明
　　　(nl + 1) / 2が　HiAddr以上の場合ハイライト色、HiAddrからLowAddrまでの場合拡散色、LowAddrよりも小さい場合陰色
　　　拡散色はfbxに指定してあるdiffuses色
　　　ハイライト色はdiffuse色をHSVに変換後AddH, AddS, AddVを施した色
　　　陰色はdiffuse色をHSVに変換後AddH, AddS, AddVを施した色
　　　各設定項目にはGUIスライダー有り
　　　プロジェクト保存時に*.stfファイルにテキスト保存、プロジェクト読み込み時に自動読込




2024/02/11
　AdditiveIK 1.0.0.7 release
　　1.0.0.6からの変更点
　　　不具合修正
　　　　LimitEulウインドウでCurrentBoneに対するFromCurrentMotionボタンを実行すると
　　　　　他のボーンの制限角度が０リセットされて動かなくなる不具合修正
　　　　　カレントボーンだけを初期化してからカレントボーンだけに値をセットするように.
　　　　　AllBoneボタンの処理はそのまま.
　　　　Brushesプレートメニューでアンドゥリドゥ時にウインドウが更新されない不具合を修正
　　　　BrushMethodのコンボボックスを変更してもアンドゥ用の保存がされていなかったのを修正
　　　　右ペインウインドウを開いたままリターゲットバッチを実行すると
　　　　　他のウインドウを表示した時に裏に残ったままになる不具合を修正
　　　　　リターゲットバッチ実行前に右ペインウインドウを閉じるように.
　　　　IKモードスプライト表示状態の初期値修正
　　　　　回転モードスプライトを初期状態でONに.
　　　　　(初期状態で回転モードになっていたが表示色がオフ色になっていた.)
　　　　アプリの終了処理を修正　　　


　　　クリック(ピック)＆セット　
　　　　DispGroupプレートメニュー選択時
　　　　マウス位置のメッシュ名をToolTip表示し、クリックしたモデルとメッシュを選択してGUIに反映
　　　　ただし背景だけ（スキンメッシュは未対応）

　　　　Shaderプレートメニュー選択時
　　　　マウス位置のマテリアル名をToolTip表示し、クリックしたモデルとマテリアルを選択してGUIに反映
　　　　ただし背景だけ（スキンメッシュは未対応）


　　　RefPos機能をDirectX12に対応させて復活
　　　　CameraAndIKプレートメニューのRefPosオンオフに対応.
　　　　スキンメッシュ(ボーンが入っているメッシュ)のみ対応.
　　　　複数残像を表示する機能ですがメッシュメモリは使いまわし、必要なメモリを残像１０個分アロケートします.
　　　　選択フレーム範囲を８分割して９個の残像フレームと１個のカレントフレームを表示します.
　　　　選択中のジョイントの軌跡を赤いソリッドコーンでインスタンシング表示. 動きが大きいほどコーンの大きさは大きい.
　　　　プレビューにも対応.
　　　　DispAndLimitsプレートメニューのRefPosAlphaで残像の透明度調整
　　　　DispAndLimitsプレートメニューのZCmpAlwaysチェックボックスでカレントフレームのZバッファ方式を切り替え


　　　RC2: クリック(ピック)＆セットの不具合修正
　　　　読み込みモデルによってはクリックしたメッシュやマテリアルに選択が切り替わらない不具合があったのを修正
　　　　pick構造体の初期化の値の問題だった
　　　RC3: クリック(ピック)＆セットに関する修正
　　　　メッシュやマテリアルをピックした際にモーション選択が変化してカメラ状態も変わる不便さをなるべく解消
　　　　ピック前後で選択モデルが同じ場合にはモデル選択関数を呼ばないように.
　　　RC4: 大きいサイズのfbxを読み込むと落ちやすい不具合が改善
　　　　GraphicsEngineのコンストラクタ記述によりConstantBuffer::CopyToVRAMで落ちなくなったようだ.
　　　　ただし1.0.0.7で１つのメッシュ当たりのビデオメモリ消費量が増えたので、大きいfbx読み込み時にビデオメモリ不足で落ちることはあります.
　　　RC5:
　　　　大きいfbx読み込み時にエラーで落ちる不具合には２つ原因があったので修正.
　　　　１つ目はメッシュタイプとシェーダ定数タイプの組み合わせミス(リファクタリング時のミス).　症状としてはConstantBuffer::CopyToVRAMで例外が出て落ちる.
　　　　２つ目はビデオメモリ不足. 症状としてはDescriptorHeapのCommit失敗ダイアログが出て落ちる.
　　　　以前読み込めていたものを読み込むことが出来るようにするために、RefPosの表示数を10個から4個に減らしビデオメモリの節約をした.
　　　　プロジェクト保存前にGUIを閉じるように修正.
　　　　ConstantBufferとDescriptorHeapをダブルバッファからシングルバッファに変更.
　　　　ConstantBufferとDescriptorHeapへのセットは計算関数からではなく、事前作成したものに対して描画関数から呼ぶのでメモリ節約のためにシングルにした.



2024/02/08
　アプリの終了処理を修正

　RefPos機能をDirectX12に対応させて復活(その２)
　　選択ジョイントの軌跡を赤いコーンでインスタンシング表示
　　軌跡のコーンは動きが大きいほど大きく表示


2024/02/07
　RefPos機能をDirectX12に対応させて復活(その１)
　　CameraAndIKプレートメニューのRefPosオンオフに対応.
　　調整機能は後で.
　　スキンメッシュ(ボーンが入っているメッシュ)のみ対応.
　　複数残像を表示する機能ですがメッシュメモリは使いまわし、必要なメモリを残像１０個分アロケートします.
　　選択フレーム範囲を８分割して９個の残像フレームと１個のカレントフレームを表示します.
　　プレビューにも対応.

2024/02/06
　プレビュー時はピックをスキップするように.
　　ただしカメラ操作はプレビュー中も可能に.

　プレビュー中は右クリック処理をスキップ.
　　ただしカメラのツイスト処理はプレビュー中も可能に.

　IKモードスプライト表示状態の初期値修正
　　回転モードスプライトを初期状態でONに.
　　(初期状態で回転モードになっていたが表示色がオフ色になっていた.)

2024/02/04
　DispGroupメニューとShaderメニューのピックよりもGUIのピックを優先


2024/02/03
　DispGroupプレートメニュー選択時
　マウス位置のメッシュ名をToolTip表示し、クリックしたモデルとメッシュを選択してGUIに反映
　ただし背景だけ（スキンメッシュは未対応）

　Shaderプレートメニュー選択時
　マウス位置のマテリアル名をToolTip表示し、クリックしたモデルとマテリアルを選択してGUIに反映
　ただし背景だけ（スキンメッシュは未対応）

　メモリの節約のために消していたデータの一部を消さないでpick処理に使用
　ただし背景だけ

　シャドウマップとPreZ処理でRGBAすべてに出力していたのにRGのフォーマットを指定していた部分で警告が出たので修正
　RGBAとして処理


2024/02/02
　未使用ファイル未使用クラスのダイエット
　　CModelクラスとModelクラスが存在するなど混乱の元なので使っていないものは削除しました.
　　レイトレーシングについても速い環境が手に入ってからということで削除.

　右ペインウインドウを開いたままリターゲットバッチを実行すると
　他のウインドウを表示した時に裏に残ったままになる不具合を修正
　　リターゲットバッチ実行前に右ペインウインドウを閉じるように.

　LimitEulウインドウでCurrentBoneに対するFromCurrentMotionボタンを実行すると
　他のボーンの制限角度が０リセットされて動かなくなる不具合修正
　　カレントボーンだけを初期化してからカレントボーンだけに値をセットするように.
　　AllBoneボタンの処理はそのまま.

　Brushesプレートメニューでアンドゥリドゥ時にウインドウが更新されない不具合を修正

　BrushMethodのコンボボックスを変更してもアンドゥ用の保存がされていなかったのを修正





2024/02/01
　AdditiveIK 1.0.0.6 release
　　1.0.0.5からの変更点
　　　不具合修正
　　　　カメラアニメ選択後にカメラの無いモデルを選択してプレビューすると
　　　　カメラアニメが再生されない不具合修正
　　　　最後に選択したカメラアニメが有効.
　　　　カメラの無いモデルのモーション編集中にもカメラアニメが動くように.


　　　ShaderプレートメニューのEmissionチェックボックスの隣にEmissiveScaleスライダーを追加
　　　Emissionに対して0%から100%まで倍率を指定
　　　fbxに既に設定してあるマテリアルのemissiveに対して作用.

　　　DispAndLimitsプレートメニューのEditRateの値の範囲を0倍から50倍までに.(変更前は０から１)
　　　CameraAndIKプレートメニューの移動モード時にもEditRateを考慮(回転モードは以前から対応しているが9.9度以上のステップにはならないリミッター有)
　　　広いステージをスプライトドラッグで移動する場合にも速やかに移動可能に.

　　　Shiftキーを押しながらスケールドラッグでXYZ全軸に対してスケール処理

　　　ToolButtonのモーションの補間機能がスケールに対応していなかったのを修正
　　　スケール対応
　　　対応前は例えば全体を５倍したモデルのフレーム範囲を補間した場合に
　　　補間区間のモデル倍率が１倍になってしまっていた.
　　　対応後は５倍されたまま姿勢が補間される.

　　　カメラアニメ計算時の時間を丸めないdoubleに.
　　　カメラに合わせてモデルのモーションを付ける際に
　　　モデルだけ補間されてカメラが補間されない場合に、モデルが画面上を行ったり戻ったりするようにみえる不具合解消のため.




2024/01/31
　ToolButtonのモーションの補間機能がスケールに対応していなかったのを修正
　　スケール対応

　カメラアニメ選択後にカメラの無いモデルを選択してプレビューするとカメラアニメが再生されない不具合修正
　　最後に選択したカメラアニメが有効.
　　カメラの無いモデルのモーション編集中にもカメラアニメが動くように.

　カメラアニメ計算時の時間を丸めないdoubleに.
　　カメラに合わせてモデルのモーションを付ける際に
　　モデルだけ補間されてカメラが補間されない場合に、モデルが画面上を行ったり戻ったりするようにみえる不具合解消のため.
　　


2024/01/30
　ShaderプレートメニューのEmissionチェックボックスの隣にEmissiveScaleスライダーを追加
　　Emissionに対して0%から100%まで倍率を指定
　　fbxに既に設定してあるマテリアルのemissiveに対して作用.

　DispAndLimitsプレートメニューのEditRateの値の範囲を0倍から50倍までに.(変更前は０から１)
　CameraAndIKプレートメニューの移動モード時にもEditRateを考慮(回転モードは以前から対応しているが9.9度以上のステップにはならないリミッター有)
　　広いステージをスプライトドラッグで移動する場合にも速やかに移動可能に.

　Shiftキーを押しながらスケールドラッグでXYZ全軸に対してスケール処理


2024/01/28
　使用例動画
　【モーキャプ】VRoidでプロのアセットを飛んでみた【編集ツール】
　 https://youtu.be/R0MsXt8plYg


2024/01/27
　AdditiveIK 1.0.0.5 release
　　1.0.0.4からの変更点
　　　不具合修正

　　　　既知の問題005の解決
　　　　　１メッシュに複数マテリアルが設定してあるfbxの書き出しに関する不具合修正.
　　　　　修正前の症状としては
　　　　　マテリアル番号オブジェクトが２つ出来て１つ目が未設定になりUnityでは読めるがMayaでは表示が指定通りでは無かった.
　　　　　修正後は
　　　　　UnityでもMaya2024でも指定通りの表示になった. 
　　　　　マテリアル番号オブジェクトが２つあるfbxを読み込んだ場合には書き出し時に２つ目を書き出すようにした.
　　　　　古いAdditiveIKで保存したfbxはver1.0.0.5で読み込んで保存し直すことでMaya2024でも正常に読み込めます.

　　　　既知の問題006の解決
　　　　　症状としては
　　　　　AdditiveIKで出力したfbxをMaya2024.2で読み込むとバインドポーズに関する警告が出てモーションが大きく変質する不具合.
　　　　　Maya2023.3では無警告で正常に読み込み正常に再生できる.
　　　　　解決方法としては
　　　　　古いAdditiveIKで保存したfbxはver1.0.0.5で読み込んで保存し直すことでMaya2024でも正常に読み込めます.

　　　　Testフォルダのモデルを1.0.0.5で読み込んで保存し直し

　　　　Hand_Closeリグで手を握った状態から開こうとするとうまくいかない不具合修正
　　　　　設定ファイル*.rigを更新
　　　　　親指の回転軸をNodeYに変更(変更前はCurrentY)



　　既知の問題
　　　問題006 (1.0.0.5 RC2で解決　RC3, RC4でリファクタリング)
　　　AdditiveIKで出力したfbxをMaya2024.2で読み込むとバインドポーズに関する警告が出てモーションが大きく変質する不具合.
　　　Maya2023.3では無警告で正常に読み込み正常に再生できる.
　　　###  1.0.0.5 RC2で解決  ###





2024/01/22
　既知の問題005が解決した
　　１メッシュ複数マテリアルのVRoidを読み込み保存してMaya2024で読み込んでもOK
　　これから他のものについてもテストしていく




2024/01/21
　AdditiveIK 1.0.0.4 release
　　1.0.0.3からの変更点
　　　不具合修正
　　　　BrushParamsプレートメニューでTopPosスライダー操作直後のIK中に、
　　　　3dwndのポーズの表示が変化しないことがある不具合を修正

　　　DispGroupの挙動を修正
　　　　グループごとに不透明はカメラから近い順、半透明はカメラから遠い順にソートしてから描画
　　　　Treeのグループ番号を大きい値に設定するだけで、ステージのTreeの影付き透過表示がうまくいくようになった

　　　メッシュ名右クリックのSimilarチェック時に
　　　メッシュ名先頭にPrefabがあった場合には２番目の'_'までをパターンとする

　　　Shadowプレートメニューのbias値の最大値を0.03に変更(変更前は0.01)

　　　対称コピーに関する修正
　　　　実際に有効な使用方法としてはRootBone:SymDirAndSymPosAndSymScaleだけとも言えるので
　　　　他のメニューはグレーアウト
　　　　部分的にペーストしたい場合には
　　　　上段カエルショートカットボタンの中のペーストボタンを"右"クリックして対象を絞って対称ペーストする

　　　IK操作中は30fps以上のマウス移動に対する処理をしないように修正
　　　　IKの後処理が重くなり過ぎないようにするため。
　　　　表示のfpsは今回の修正によっては制限を受けない

　　　Rigクリックだけで右ペインにクリックしたRigの設定画面を出すように.
　　　　設定中のRigと操作中のRigを一致させることにより、誤保存を回避、操作も効率的に。

　　　Test/3_Winter2_1モデルのRig設定を修正
　　　　このモデルはTestフォルダの中の他のVRoidよりも新しいVRoidで出力したモデル
　　　　新しいVRoidにはローカル軸が保存されるようになったようだ
　　　　それを踏まえて、新しいVRoidのリグの設定時には、軸の種類としてNodeX,NodeY,NodeZを選ぶと良い
　　　　特に足の部分のリグにはNodeX,NodeY,NodeZを選ばないとうまくいかないことが多い


　　備考
　　　ノーマルマップテクスチャの表示について
　　　テクスチャにはMipMapの処理を入れてある
　　　MipMapが本当に機能しているかどうかについてはまだ調べ切っていない
　　　PBR表示の際のノーマルマップテクスチャについては遠くのテクスチャにモアレが出ることがある
　　　PBRをオフにすると通常のテクスチャに対してはモアレは出ない
　　　ノーマルマップを施しているメッシュについてはLOD(詳細度切替機能)を使って
　　　遠くのオブジェクトに対してはノーマルマップ無しのモデルに置き換えるというのが良いと思っている




　　既知の問題
　　　問題005 (### 2024/01/22 　1.0.0.5に向けた修正にて解決 ###)
　　　１メッシュに複数マテリアルが設定してあるモデルの場合
　　　AdditiveIKで読み込んでから保存すると
　　　Unityではきちんと１メッシュに対して複数マテリアルが読み込まれるが
　　　Mayaではメッシュに１つのマテリアルしかアタッチされていないことがある
　　　という問題が起きています(Mayaでもマテリアル自体は読み込まれています)
　　　解決に時間が掛かりそうなのと他の不具合修正分を早く出したいので
　　　問題005は未解決ですが 1.0.0.4を出します





2024/01/20
　DispGroupの挙動を修正
　　グループごとに不透明はカメラから近い順、半透明はカメラから遠い順にソートしてから描画
　　　Treeのグループ番号を大きい値に設定するだけで、ステージのTreeの影付き透過表示がうまくいくようになった

　　メッシュ名右クリックのSimilarチェック時に
　　メッシュ名先頭にPrefabがあった場合には２番目の'_'までをパターンとする

　Shadowプレートメニューのbias値の最大値を0.03に変更(変更前は0.01)

　対称コピーに関する修正
　　実際に有効な使用方法としてはRootBone:SymDirAndSymPosAndSymScaleだけとも言えるので
　　他のメニューはグレーアウト
　　部分的にペーストしたい場合には
　　上段カエルショートカットボタンの中のペーストボタンを"右"クリックして対象を絞って対称ペーストする




2024/01/19
　不具合修正
　　BrushParamsプレートメニューでTopPosスライダー操作直後のIK中に、
　　3dwndのポーズの表示が変化しないことがある不具合を修正

　IK操作中は30fps以上のマウス移動に対する処理をしないように修正
　IKの後処理が重くなり過ぎないようにするため。
　表示のfpsは制限を受けない




2024/01/17
 動画作成
　【DirectX12】AdditiveIK新機能【モーキャプ編集】
　　VRoidとモーキャプをプロのアセットに盛り付けるツール
　　AdditiveIK(アディティブアイケー)
　　のアップデートのお知らせ

　　EditMot + DirectX12 でAdditiveIKとしてリスタート
　　DirectX12に対応し、魔導書２冊を導入して表示のテコ入れをしました。
　　主に新機能の紹介として次の９つの項目をざっくり説明しています。
　　１、LaterTransparent(モデル内半透明描画順序：まゆ毛透過)
　　２、Shader(シェーダー設定)
　　３、WorldPos(モデル位置設定)
　　４、DispGroup(モデル横断半透明描画順序)
　　５、Shadow(シャドウ設定)
　　６、Retarget(Rokokoモーションキャプチャをリターゲット)
　　７、BulletPhysics(物理シミュ設定)
　　８、LOD(詳細度切替設定)
　　９、AlphaMarks(マークの明るさと透明度設定)

　　https://youtu.be/oKGY62YosSg





2024/01/12
　AdditiveIK 1.0.0.3 release
　　1.0.0.2からの変更点
　　　不具合修正
       １メッシュに複数マテリアルがある場合に　面のマテリアル番号設定に問題があったのを修正
　　　　LaterTransparent設定ウインドウに　Albedoテクスチャ名がエントリーされていなかった不具合修正
　　　　　AlbedoでもNormalでもMetalでもないテクスチャ名だけがエントリーされていた不具合だった
　　　　　(修正前はVRoidではうまくいっていた)
　　　　BrushParamsプレートメニューのTopPosのテキスト表示更新に関わる不具合を修正
　　　　　フレーム選択変更時にTopPosのGUI表示が更新されていなかった
　　　　右ペインのウインドウのスクロールバードラッグのキャプチャとリリースに関して修正
　　　　　スクロールバードラッグ中に　画面外でマウスを離した場合に　挙動がおかしくなる不具合が直った
　　　　モデルを追加読み込みするとモーションスピードがスライダーの値と異なってしまう不具合を修正
　　　　　DispAndLimitsプレートメニューのSpeedスライダーの設定どおりになった

      ２つまでのマルチUVに対応
　　　　Albedo, Normal, Metal丸ごと一緒にUVSet0とUVSet1を切り替えるように.
　　　　DispAndLimitsプレートメニューに UVSetコンボボックスを追加
　　　インスタンシング表示
　　　　リグと剛体をインスタンシング表示(１モデルに対する１回の描画で複数個表示)
　　　　フォントとボーンマークは1.0.0.1からインスタンシング表示
　　　ボーンマークの明るさ、リグ(Rig)の透明度、剛体(Rigid)の透明度を設定可能に.
　　　　DispAndLimitsプレートメニューのスライダーで設定
　　　Rigの設定(ジョイント右クリック->Rig名->Settingメニューで出る)の回転軸の追加
　　　　CurrentX, CurrentY, CurrentZ,
　　　　ParentX, ParentY, ParentZ,
　　　　GlobalX, GlobalY, GlobalZ,
　　　　NodeX, NodeY, NodeZ
　　　　上記９種類に増やした
　　　　足の付け根UpperLegの前後回転軸はParentYとした
　　　　Testフォルダのrigファイルを更新
　　　　古い設定はCurrent*として扱う　　　
　　　マニピュレータの計算の修正
　　　　Hipsの特別扱いを止めて　Hips自身の回転を考慮するようにした
　　　　Rigの足の付け根(UpperLeg)の回転が　体全体の回転後も設定どおりに曲がるようになった
　　　テクスチャアドレッシングモードの読み込みと表示への適用と保存
　　　　サンプラーステートにも適用
　　　テクスチャ命名規則を少し修正(_Baseが加わった)
　　　　Albedoまたはalbedoまたは_Baseが名前にテクスチャをAlbedoMapとする
　　　　Normalまたはnormalが名前につくテクスチャをNormalMapとする
　　　　Metalまたはmetalが名前につくテクスチャをMetalMapとする
　　　VRoidに対する剛体作成の修正
　　　　VRoidの足の横に平行して作成されるCoatSkirt用のボーンに対しては自動で剛体を作成 "しない" ように修正
　　　ジョイントマークを修正
　　　　選択時は赤、非選択時は黄色に. 明るさ調整はスライダーで.
　　　モーションスピードの初期値を1.0に変更
　　　　変更前は3.0

　　　外部ライブラリのバージョンアップ(差し替え)
　　　　DirectXTK12をJun2023からDec2023に差し替え
　　　　DirectXTexをDec2023に差し替え

　　　モデル更新
　　　　Test/3_Winter2_1のモーションを修正
　　　　　全フレームのHipsのスケールを初期化
　　　　　スケール値に不具合を引き起こす値が入っていたようで
　　　　　Mayaで服のテクスチャが表示されなかったり　IK時に軸がブレたりした
　　　　　スケール初期化で直った


2024/01/11
　BrushParamsプレートメニューのTopPosのテキスト表示更新に関わる不具合を修正
　　フレーム選択変更時にTopPosのGUI表示が更新されていなかった
　モデルのインスタンシング表示に対応
　　ただし非スキンメッシュで１メッシュにつき１マテリアルのモデルに限る
　　インスタンシングには表示最大個数があり256個以上ある場合には１つも表示しないようにしています.
　　モデルごとの制限数なので人物ごとにfbxファイルを分けて読み込むと制限に収まると思います.
　リグの表示をインスタンシング方式に変更
　　CameraAndIKプレートメニューのRigボタンを押したときに表示されるリグに関する変更
　　アプリ起動の高速化
　　　アプリ起動時にリグを１００個読み込んでいたのが　４個の読み込みになった
　　球、リングX、リングY,リングZそれぞれリグについて24個までの制限. (個数は暫定)
　剛体マークをインスタンシング表示
　　剛体マークのオンオフはDispAndLimitsプレートメニューのDispRigidMarkチェックボックスで.
　　DispRigidMarkにチェックを入れても表示されない場合は剛体が作成されていない可能性が高い.
　　剛体を作成するには下段カエルボタンでRigidParamsメニューを出し
　　Valid/Invalidにチェックを入れてその右にあるToAllボタンを押すと一括作成されます.
　　　



2024/01/09
　Rigの設定(ジョイント右クリック->Rig名->Settingメニューで出る)の回転軸の追加
　　CurrentX, CurrentY, CurrentZ,
　　ParentX, ParentY, ParentZ,
　　GlobalX, GlobalY, GLobalZ,
　　NodeX, NodeY, NodeZ
　　上記９種類に増やした
　　足の付け根UpperLegの前後回転軸はParentYとした
　　Testフォルダのrigファイルを更新
　　古い設定はCurrent*として扱う
　マニピュレータの計算の修正
　　Hipsの特別扱いを止めて　Hips自身の回転を考慮するようにした
　　Rigの足の付け根(UpperLeg)の回転が　体全体の回転後も設定どおりに曲がるようになった
　右ペインのウインドウのスクロールバードラッグのキャプチャとリリースに関して修正
　　スクロールバードラッグ中に　画面外でマウスを離した場合に　挙動がおかしくなる不具合が直った
　モデルを追加読み込みするとモーションスピードがスライダーの値と異なってしまう不具合を修正
　　DispAndLimitsプレートメニューのSpeedスライダーの設定どおりになった


2024/01/08
　マルチUVの使い方を修正
　　Albedo, Normal, Metal丸ごと一緒にUVSet0とUVSet1を切り替えるように.
　　DispAndLimitsプレートメニューに UVSetコンボボックスを追加
　LaterTransparent設定ウインドウに　Albedoテクスチャ名がエントリーされていなかった不具合修正
　　AlbedoでもNormalでもMetalでもないテクスチャ名だけがエントリーされていた不具合だった


2024/01/07
　２個までのマルチUVに対応
　　ただし用途は限定　１つ目のUVはalbedoテクスチャ　２つ目のUVはノーマルマップとメタルマップ用
　　マルチUV対応で　ノーマルマップの模様ががカメラ距離で伸び縮みする不具合解消
　１メッシュに複数マテリアルがある場合に　面のマテリアル番号設定に問題があったのを修正
　テクスチャアドレッシングモードの読み込みと表示への適用と保存
　　サンプラーステートにも適用
　テクスチャ命名規則を少し修正(_Baseが加わった)
　　Albedoまたはalbedoまたは_Baseが名前にテクスチャをAlbedoMap
　　Normalまたはnormalが名前につくテクスチャをNormalMap
　　Metalまたはmetalが名前につくテクスチャをMetalMap
　DirectXTexをDec2023に差し替え


2024/01/05
　DirectXTK12をJun2023からDec2023に差し替え.
　　MiniEngine直下に置いていたd3dx12.hも更新
　　d3dx12.hのwarningが出なくなった.
　　遠くのテクスチャの画質が良くなったような気がする?

　既知の問題と対処法
　　問題004
　　　ジョイントの方向(いわゆる初期姿勢)として　X180, Y90, Z0が設定されているfbxの書き出しが変質する不具合がある。
　　　書き出し時だけ問題が出る。読込とリターゲットはうまくいく。
　　　X180, Y90, Z0の初期姿勢が設定されているモーションに対しては
　　　読み込み後に普通の軸のモデルにリターゲットしてから保存してください。





2024/01/04
　AdditiveIK 1.0.0.2 release
　　1.0.0.1からの変更点
　　　不具合修正
　　　　ボタンを押してもShader設定ダイアログが出ないことがある不具合修正
　　　　Rigの設定が意図せず重複して片方を選べなくなる不具合修正
　　　　シャドウの向きを修正
　　　　マニピュレータの軸(計算と表示共に)がparent側に１階層分ずれていたのを修正
　　　　　体全体を９０度回転した場合に足の付け根のRigの軸が設定と異なる現象を追いかけていたら発覚
　　　　　IK操作、Rig操作とRigの設定に影響
　　　　　軸の種類はDispAndLimitプレートメニューのAxisKindコンボボックスで
　　　　　Current, Parent, Global, Nodematから選択可能. 
　　　　　今回の修正をする前の振る舞い再現はAxisKindでParentを選択すれば可能(Rigの設定が昔のままの場合).
　　　　　IK操作の軸が操作中にブレないことを再確認
　　　LOD機能追加　ProjAndLODプレートメニュー追加
　　　MipMap対応
　　　　テクスチャ読み込み時に全レベルMipMapを作成して転送
　　　　サンプリングステートでMipを有効に
　　　VRoid特有のジョイント名がある場合には　シェーダー設定がAUTOのときにNOLIGHTを適用してトゥーン風に表示
　　　ブラシ設定のRepeatsのスライダーの最大値を100に.(変える前は10)
　　　起動時の初期値を変更
　　　　HighRpmを最初から有効に.
　　　　4Kモード時には　ZprepassCullingを最初から有効に.
　　　ツールショートカットボタンのModelWorldMat設定ウインドウにカメラ位置、カメラ注視点にモデルを置くボタンを追加
　　　シャドウのbiasスライダーの最小値を0に.(変更前は0.001)
　　　Testフォルダにモデル追加　
　　　　Test/3_Winter2_1
　　　トラブルシューティング追加
　　　　Documsnts/TroubleShooting/AboutSettingsOfLOD.docx
　　　　Documsnts/TroubleShooting/AboutSettingsOfShader.docx
　　　　Documsnts/TroubleShooting/AboutSettingsOfShadow.docx
　　　　Documsnts/TroubleShooting/DarkNoiseOn3DScreen.docx
　　　　Documsnts/TroubleShooting/HowToImproveJaggedImageQuality.docx
　　　　Documsnts/TroubleShooting/Partially180DegreesDifferent.docx




2024/01/02
　Testフォルダにモデル追加
　　Test/3_Winter2_1
　　VRoid製のモデルです  ３万数千ポリゴンです
　VRoid特有のジョイント名がある場合には　シェーダー設定がAUTOのときにNOLIGHTを適用してトゥーン風に表示
　ブラシ設定のRepeatsのスライダーの最大値を100に.(変える前は10)
　トラブルシューティング追加
　　Documsnts/TroubleShooting/AboutSettingsOfLOD.docx
　　Documsnts/TroubleShooting/AboutSettingsOfShader.docx
　　Documsnts/TroubleShooting/AboutSettingsOfShadow.docx
　　Documsnts/TroubleShooting/DarkNoiseOn3DScreen.docx




2024/01/01
　MipMapに対応
　　とりあえず対応しました
　　何回もテストをしましたが正しく出来ている確信はまだ無いです
　　Stdシェーダーはきれいになったと思います　しかし、PBRの遠くのざらざらしているノーマルマップはまだ縞模様になったりしています




2023/12/30
 前述問題002に対応
　　ProjAndLODプレートメニュー追加
　　プロジェクションとLODのパラメータを設定可能に
　　プロジェクションとLODの設定はプロジェクトファイル(*.cha)保存時に保存、プロジェクトファイル読み込み時に読み込み
　　効果について
　　　少し試してみて感想
　　　LODで高速化の効果を出すのは結構大変(データ作成やシーンとしての最適化が難しい)
　　　それでもLOD0, LOD1のクリッピング距離を最低値に近づけると多少効果はあった
　　　プロジェクションパラメータを絞り込む方が目にみえて効果がある
　　　例えばFov(視野角)をシーンが欠けない程度に小さくする
　　　例えばnearを出来るだけ大きく、farを出来るだけ小さく(near < farの範囲で)
　　　####!!!!  4KモードにおいてはDispAndLimitsメニューのZPrePassCullingがとても効果的  !!!!####
　　　DispAndLimitsメニューでDispBoneMarkをオフにしても効果有
　　　DispAndLimitsメニューでHighRpmにしてからUpdateThreadsスライダーを調整
　　　上記パラメータ設定にての合わせ技にて
　　　当方の環境(古めの８コアPC+RTX2080)では４Kモード(ウインドウ大モード)でアセットシーンがどれも33fps程になった
　　　最近のゲーミングPCでなら60fpsを越えるものと思われる　(とにかく重い処理をしているのだからしょうがない)
　12/30 その２
　　ProjAndLODメニューのFOV(視野角)の設定がカメラの設定に適用されていなかったのを修正
　　(クリッピングにだけ反映されていた)
　　FOVは焦点距離に関係する. 小さくするほど描画は速くなるが絵の奥行き感が減る.
　　視野内判定ChkInViewを最適化して少し高速化.
　12/30 その３
　　起動時の初期値を変更
　　　HighRpmを最初から有効に.
　　　4Kモード時には　ZprepassCullingを最初から有効に.
　　ProjAndLODメニューのFOV(視野角)のスライダーの最大値を179degreeに.

　　前述の既知の問題001, 002, 003について対応済とする
　　　問題001
　　　　 ShaderParamsDlgProcの問題だった。WndProcを回すべきところで回っていなかったのを修正
　　　　解決
　　　問題002
　　　　直しながら症状をみたが　計算による遅さというよりも描画そのものの重さのようだ
　　　　思いついた対策はしたが　とりあえずここまでとする
　　　　当方のビデオカードはRTX2080で今でも速い部類のようだが　現行のRTX4070は２倍速いらしい
　　　　現状でも４Kモードでもなんとか30fps出るので　開発環境についてはゆっくり考える
　　　問題003
　　　　Rig設定ウインドウを出すときに　右ペインウインドウ全てを閉じるようにして解決
　　
　　



2023/12/27 既知の問題と対処法について
　問題001(2023/12/30解決)
　　カメラ操作用スプライトをマウスでドラッグし、
　　右ペインのメニューボタン上でマウスを離すと
　　右ペインウインドウの設定ボタン類を押しても無反応になる
　対処方
　　右ペインのメニューボタン上ではマウスを離さない
　プログラム修正予定　：　有

　問題002(2023/12/30解決)
　　アセットの表示が重すぎる
　原因
　　表示詳細度切り替え用のLODオブジェクト全てを
　　重ねて表示している状態
　対処法
　　DispGroupメニューで
　　非表示にしたいオブジェクトにグループ番号を付けてから
　　非表示ボタンを押す
　プログラム修正予定　：　有

　問題003(2023/12/30解決)
　　Rigの設定でRigの名前が既存Rigの名前と同じになり
　　選択不能になる
　原因
　　Rigの設定ウインドウが開いている状態で
　　他のRigの設定ウインドウが開いてしまい
　　保存時に同じ内容になる
　対処法
　　右ペインのXボタンで
　　Rig毎に手動でウインドウを閉じてから
　　次のRigウインドウを開いて設定する
　プログラム修正予定　：　有




2023/12/24
AdditiveIK 1.0.0.1 release




2023/12/23
AdditiveIK 1.0.0.1 RC6(リリース候補6)
　１段目と２段目のプレートメニュークリックで出る右ペインウインドウが重なって表示されていた不具合修正
　iniファイルのファイル名修正
　Testフォルダのモデルデータのまゆ毛透過をLaterTransparentメニューで設定
　TestフォルダのSpring1の髪の毛がまだ少し肩に食い込んでいたので調整
　ファイルオープンダイアログのTestフォルダのパスが古かったのを修正




2023/12/22
AdditiveIK 1.0.0.1 RC5(リリース候補5)
　ShaderTypeウインドウ、ShaderTypeParamsダイアログの挙動修正

AdditiveIK 1.0.0.1 RC4(リリース候補4)
　ShaderTypeダイアログがスクロール出来ていなかったのを修正.
　ShaderTypeParamsダイアログにEnableEmissionチェックボックスを追加.
　　色の計算にEmissionを含める場合にはEnableEmissionにチェックを入れる.
　　EnableEmissionの初期値はfalse.
　マニピュレータの色調整.
  fps数字表示位置を少し下に移動.



2023/12/21
AdditiveIK 1.0.0.1 RC3(リリース候補3)
　デバッグビルドで　レンダー時にバリアの警告が出ていた問題について修正
　README.mdに使い方を追記




2023/12/19
AdditiveIK 1.0.0.1 RC2(リリース候補2)
　ダイアログの最初の出現位置をセンターにしつつ　操作中に元の位置に戻らないように.
　Rigボタンを押したときのRigの表示. Rigは球、RingX, RingY, RingZの４種類あり　それぞれ24個までの制限に.
　準備中のウインドウ領域が白くならないように.



2023/12/18
AdditiveIK 1.0.0.1 RC1(リリース候補1)
　Shadowパラメータを８スロット分設定可能に.
　Shaderのライトスケール最大値を5.0に.
　ダイアログのセンターに配置し直す機能はデスクトップの(0, 0)に表示しようとした場合にだけ.
　プレビュー中はプレートメニューを非表示に.
　Documents/TroubleShooting追加

　機能していない設定画面もありますが　年内に一度リリースしておきたいので　いったんここで区切ります




2023/12/17
ピクセルシェーダ内の計算が有効なライトの個数分だけループするように.
HDRP対応
　ライトスライダーの上限値を3.0に. Shaderのライト倍率の上限値も3.0に.
HDRP Bloomエフェクト追加
　色の値が1.0を越えた部分にブルームがかかり　周りに淡く広がりを持つ表示になります
　シェーダーをStdにして　ライトを1.0以上にすると　効果が掛かりやすい
README.mdのスクリーンショット更新



2023/12/15
Shadowプレートメニュー追加
　設定はアプリ終了時にtempフォルダに保存し　起動時に自動読込
DispAndLimitsメニューに　Free fpsチェックボックス追加
　FreeFpsをオンにするとfpsは大きくなりますが　
　可変周波数対応モニタ以外でオンにすると　ティアリングが起こることがあります
Shadowメニューに　EnableShadowチェックボックス追加
　シャドウ表示をオンオフ出来ます



2023/12/14
デプスシャドウ機能を追加
　テストとしてカメラから選択モデルのHipsジョイントの方向へシャドウ用のライトを向けています
プロジェクト保存時に　Shaderメニューのsmoothcoefも保存
デプスシャドウのスクリーンショットをREADME.mdに追加
デプスシャドウリファクタリング　必要不要を試行錯誤して判断しメモリの不要な多重化をやめた




2023/12/10
MetalSmoothMapの　rにmetalcoefを　aにsmoothcoefを掛けて調整
　ShaderメニューのMetalCoefスライダーとSmoothCoefスライダーで設定
　手持ちのアセットで試したところ　smoothCoefの方が影響が大きい　smoothが大きいほど白く小さいほど拡散色が出る
ShaderTypeParamsDlgでの設定値をShaderTypeWndにも反映
ツールボタンショートカットアイコンのMaterialRate設定の内DiffuseRateとSpecularRateをシェーダに反映
　モデル単位でDiffuseとSpecularに倍率を掛けることが可能
　AUTO, PBR, STD, NOLIGHTに対して効果有



2023/12/09
ZPrepassクリッピングをDispAndLimitsメニューのオプションに.
　シーンによって効果がある場合と　マイナス効果になる場合があったので必要に応じて.
PBR時NormalMapが無い場合には　GetNormalMap()はblackMapを返すように.
　PBRにはnormalMapは必須という前提だがそれが無い場合の対応.
　whiteMapを返すと法線の向きが変わってしまうのでblackMapを返すことに.
シェーダ定数の転送は　シェーダファイル毎描画フレーム毎に１回にしてみた
　fpsに変わりはなかった


2023/12/08
Shaderプレートメニュー追加
　Shaderの設定をマテリアルごとに設定する仕様に変更.
　Shaderメニューのウインドウの見出し行のボタンで全マテリアルに対しての設定も可能.
　マテリアルごとにシェーダータイプ、メタル係数、ライトスケールx8個の設定が可能.
　プロジェクトファイル保存時に他のファイルと共に*.stfファイルとして保存、プロジェクト読み込み時に自動読込
ライトパラメータのシェーダへの転送が十分ではなかったのを修正
デフォルトのメタル係数を0.7から0.25へ変更
アプリのアイコンを変更(再起動しないと変更が反映されないこともあるようです)
README.mdのスクリーンショットを更新


2023/12/06
Lightプレートメニューの設定をシェーダーに反映.
ライトの数は８個まで.
矢印キーによるジョイント階層ウインドウの選択移動機能を復活


2023/12/05
ZPrepassレンダーを導入. カラー描画前にZバッファを構築する方法. 画面手前に遮蔽物があるほど描画が高速化.
ZPrepassレンダー時には半透明メッシュはZバッファに書き込まないように.
ZPrepassは4KTVモードでは遮蔽面積が大きいため効果があるが2KTVモードではZ書き込みコストの方が効果よりも大きい
ZPrepassは4KTVモードのときだけ有効にした.
シェーダーとパイプラインについてリファクタリングし　DispParamsプレートメニューのShaderTypeでAuto, PBR, STD, NOLIGHTを切り替え可能に.
法線マップを設定していないモデルに対してPBRを選択すると　法線が０となり黒い表示になることに注意
ShaderTypeでAUTOを選んだ場合のシェーダー設定は以下
　スキンメッシュについては　[Albedo無しまたはNormal有またはMetal有]->PBR,　[Albedoだけ有またはテクスチャ１つも無し]->NOLIGHT
　非スキンメッシュについては　[Albedo無しまたはNormal有またはMetal有]->PBR,　[Albedoだけ有またはテクスチャ１つも無し]->STD
スキンメッシュと非スキンメッシュそれぞれのShaderTypeに対して　不透明、半透明、半透明常時上書きの設定があり自動設定



2023/12/04
PBR対応開始
//############
// UnityAssetをUnityでfbxエクスポートする場合、全てのマテリアルのシェーダーをStandardにするとfbxにテクスチャ名が出力される
// それ用のEditorスクリプトをみつけてきて使っています
//############
テクスチャ無しの場合とノーマルマップまたはメタルマップがある場合にPBR、それ以外の場合にStandardで描画
プロジェクト保存時　fbxのPBR用テクスチャ(albedo, normal, metal)も保存
描画はモデルを横断してDispGroupNo順に行っている　DispGroupNo == 1以外の描画時には強制的に半透明描画
//############
//pMesh->GetNode()に対してGetMaterial(i)を呼んでマテリアル情報を取得すると不正な情報が入っていた
//マテリアル名に本来のマテリアル情報とは異なるtypo_2という名前, テクスチャにtype_2.pngが入っていた
//pMesh->GetNode()はマテリアル情報のためには使わないことに.
//############


2023/12/02
もう少し前準備として　不透明半透明のパイプライン切り替え　ボーンマトリックス更新最適化
プロジェクト保存時にfbxのテクスチャが保存されなくなっていたのを修正
Testフォルダをgit add. モデルはVRoid.


2023/12/01
描画を綺麗にする前に目立った不具合に対応
MaterialBankをモデル(fbx, mqo)ごとに持つように修正
マテリアル番号の重複によるマテリアルずれ解消
マニピュレータ不具合解消
ボーンマトリックスの転送を毎回の描画のマテリアルごとに１回に絞り少しだけ高速化


2023/11/30
MaterialBankを追加することにより大きい背景fbxも読み込めるようになった
ただし１つのfbxにつきボーン数は1000個までという制限付き
デスクリプタヒープの数を減らすことにより背景を読めるようになったのだが
マテリアルごとに全部のボーン姿勢を転送しなくてはならなくなり重くなってしまった
マニピュレータの常時上書き設定は一時的に効かなくしている
明日は背景を綺麗に表示するために修正する予定(予定)


2023/11/29
DescriptorHeapに関するリファクタリング
大きい背景読み込み時に4038個目のDescriptorHeap作成でE_OUTOFMEMORYになる症状は変わらず
背景の描画をきれいにしたかったのだが　どうするか試しながら考える


2023/11/28
プレートメニューを２段構成に.
１段目は常時固定メニュー. ２段目はカエルボタンで変化.
１段目のメニューに対するGUIは右ペインウインドウに表示.
１段目と２段目のメニューに関わる作業を行き来するに便利なようにしたつもり.
１段目のCameraAndIKは他のメニューとは独立してトグル.
１段目のCameraAndIK以外は１段目の他のメニューをオンにしたときにオフになる.
２段目のプレートをオンにすると１段目のCameraAndIK以外はオフになる.


2023/11/27
レンダリングエンジンにフォント表示を追加
ツールチップを表示
線だけで構成されたメッシュの表示にも対応
地面データとして線で出来た格子と軸を表示


2023/11/26
選択ジョイントの位置にマニピュレータを表示
マウスホバーでマニピュレータをハイライト表示
物理プレイボタンと物理ベイクボタンをプレイヤーボタンに追加
レンダリングエンジンにスプライト描画処理を追加.
ジョイント位置にスプライト表示. マークは白、セレクトツリーは赤.


2023/11/25
魔導書のSpriteクラスを拡張してインスタンシングに対応させたInstancedSpriteクラス新規
同じスプライトを違う場所違う大きさで描画可能
InstancedSpriteでfpsとアンドゥバッファ位置を表示
GUIに関しては現在のウインドウに重ねて表示できるものがみつからないため　右ペインに通常通り表示する予定に変更
なるべくクリック回数が増えないように段階を追って改善していくつもり
関節部ドラッグでとりあえずAdditiveIK出来るようにしました.　ブラシパラメータ設定などはGUIを準備してから.


2023/11/23
デバッグビルドで実行終了時に表示されるメモリリークが気になってリファクタリング
メモリリークは無くなった?


2023/11/22
スプライトGUIを魔導書のSpriteクラスで.
プロジェクトやfbxを読み込むとプレートメニューが出ます.
下の方のカエルボタンでメニュー変更. 上の方のカエルボタンでショートカットボタンを変更.
Documents/ModifyAboutGrimoireSpriteClass.docx追加
Documents/CoexistenceOfConventionalMaterialsAndPBR.docx追加
カメラ操作を有効に. CameraAndIKプレートをクリックしてボタンを出し、３つのカメラボタンドラッグでカメラ操作.
モーションのプレビューが出来るようになりました.
モーション付きモデルを読み込み後にタイムラインのプレイマークのボタンでプレビュー.


2023/11/20
Texture設定の無いメッシュ描画時には白いalbedoテクスチャを使用
マテリアルのdiffuse色のテクスチャを作成してalbedoテクスチャと乗算して描画
このようにすることで　古いマテリアル形式と将来対応するPBRとが共存出来る可能性
4KTV接続時にアプリウインドウ大と小を選べるように


2023/11/19
Texture表示が可能になった
透過テクスチャを有効に
透過テクスチャ遅延描画順機能(LaterTransparent)を有効に


2023/11/18
DirectX12による表示開始
とりあえず　白いシルエットでモデルを表示
VRoidモデルはシルエット表示できた
仕組みとしてはテクスチャに対応しているのだが　シェーダーでテクスチャを使うと何も表示されなかった
4000個くらいメッシュがあるfbxを読み込むとアウトオブメモリエラーだった
次回はテクスチャを表示したい


2023_11_14
もの凄い作り直しをしようとしていましたが　考えた結果　表示とUIの挿げ替えをすることに
MameBake3Dの表示をPBRとカスケードシャドウに対応させて　UIはimguiで表示するための作業をしていく 予定
とりあえずDX12用のファイルを足して　DX11をコメントアウト　してビルドして起動可能に
まだモデルを表示できない状態


2023_11_12
まずはAdditiveIKのレポジトリを作成
MameBake3D + HLSシェーダーの魔導書(DirectX12)の描画　+ DirectX12の魔導書のDX12文法 + bullet physicsからスタートする予定
ビルドは出来ますがまだ動きません　これからです.








