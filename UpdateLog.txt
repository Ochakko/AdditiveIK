AdditiveIK UpdateLog
https://github.com/Ochakko/AdditiveIK


2025/04/06
　AdditiveIK 1.0.0.42 RC1(リリース候補1)
　　1.0.0.41からの変更点
　　　ファイルオープン履歴ファイルが保存されないことがある不具合を修正
　　　　ファイル書き出しに関わる終了処理が足りていなかったのが原因だった
　　　　
　　　プレートメニューから呼び出されるダイアログのApplyボタンを無しに.
　　　　OrgWindowにエディットボックスが含まれる場合にApplyボタンが必要だったが
　　　　エディットボックスを閉じる際に値を適用することによりApplyボタンが不要に.
　　　　エディットボックスを閉じる際に呼ばれるリスナー関数を追加.

　　　OWP_EditBoxの入力エラー対応

　　　IKパラメータをDispAndLimitsプレートメニューのGUIで設定可能に.
　　　　IKRate : 大きくするとジョイントドラッグ時のIKスピードが速くなりますが精度は落ちます。
　　　　IKMaxDeg : 大きくするとジョイントドラッグ時のIKスピードが速くなりますが精度は落ちます。
　　　　PosConstTimes : 大きくすると位置コンストレイント時の計算回数が多くなります。計算回数が多いほど位置が定まりやすくなりますが計算が重くなります。
　　　　設定値はiniファイルを使用して自動で読み書き


2025/04/05
　OWP_EditBox修正
　　ソフトキーウインドウ右下のXを押さないで　他のエディットボックスをクリックした場合にも
　　選択変更前のエディットボックスの入力値をアプライするためにcallExitDialogListenerを呼ぶ

　ファイルオープン履歴ファイルが保存されないことがある不具合を修正
　　バッファのフラッシュ、ファイルの終了とSleepなどについて対応したところ直ったようだ。

2025/03/30
　プレートメニューから呼び出されるダイアログのApplyボタンを無くしました
　　EditBoxへの入力数値適用タイミングをEditBoxの右下のXボタンを押したときに変更(今までは別ボタンとしてのApplyボタンを押したタイミングだった)

　DispAndLimitsプレートメニューのダイアログにGUI追加
　　IKRate : 大きくするとジョイントドラッグ時のIKスピードが速くなりますが精度は落ちます。
　　IKMaxDeg : 大きくするとジョイントドラッグ時のIKスピードが速くなりますが精度は落ちます。
　　PosConstTimes : 大きくすると位置コンストレイント時の計算回数が多くなります。計算回数が多いほど位置が定まりやすくなりますが計算が重くなります。

　IKRate, IKMaxDeg, PosConstTimesの設定値をiniファイルに保存読み込み(アプリ終了時とアプリ起動時)

　EditBoxの入力エラー対応


2025/03/23
　マウスLボタンを押した瞬間にジョイントが動いてしまうのを防止

2025/03/22
　AdditiveIK 1.0.0.41 release
　　1.0.0.40からの変更点
　　　マルチスレッド・アディティブIKの動作の改善
　　　　IK最大角度を導入.
　　　　マニピュレータ中央ドラッグ時、マウス左ボタンを押している間はマウス位置に近づき続けるように.
　　　　
　　　位置コンストレイントの修正
　　　　位置コンストレイントにもIK最大角度を導入し、計算回数を増やした.
　　　　
　　　　
2025/03/22
　マルチスレッドAdditiveIK修正
　　ジョイント中央をドラッグした時の処理を修正
　　　マウスの左ボタンを押している間はマウスのターゲット位置までIK計算をするように.
　　　タイマーでマウスの動きにゆっくりついてくる動きに変更.
　　　
2025/03/20
　マルチスレッドAdditiveIKを更に修正
　　PostIKフラグを位置コンストレイントスキップフラグにリネームして値を編集
　　位置コンストレイントを複数ボーンまとめて実行するのをやめて、それぞれのボーンのIK中に行うように.
　　指定軸IKにおける一度に回転する角度の上限値を10.0degreeから8.0degreeに変更.

2025/03/08
　AdditiveIK 1.0.0.40 release
　　1.0.0.39からの変更点
　　　マルチスレッド・アディティブIKの動作の改善
　　　　フレーム範囲をセレクトしてジョイントをドラッグした際にカレントフレーム部分が凹んだり出っ張ったりしていたのを修正
　　　　追加回転計算部分改良
　　　　スレッド実行時用の条件保存部分改良
　　　　１度に回転可能な最大角度調整(描画速度に依存しないように)
　　　　
　　　フットリグサンプル修正
　　　　足が地面から浮きすぎていたのを修正
　　　　Test/Test_FootRig_7
　　　
　　　MOAプレイ中はアンドゥ準備処理をスキップするように.
　　　

2025/03/08
　マルチスレッドAdditiveIKのリファクタリング　その５
　　マニピュレータ中央ドラッグと　軸指定ドラッグのどちらについても　カレントフレームでオイラーカーブが凸凹する不具合が　ほぼ解消
　　一度に動かす角度の最大値の部分においてDEGとRADが混ざる間違いをしていたのを修正
　　
　マルチスレッドAdditiveIKのリファクタリング　その６
　　軸指定ドラッグの更なるリファクタリング
　　マニピュレータ中央ドラッグと同じ数式で処理できるように修正
　　
　　
2025/03/06
　マルチスレッドAdditiveIKのリファクタリング　その４
　　
　　マニピュレータ軸指定IKの軸が修正により合わなくなっていたので対応
　　　
　　マニピュレータ中央ドラッグ処理は修正を採用(そのまま)

2025/03/04
　マルチスレッドIKのリファクタリング　その３
　　3/3の修正で姿勢計算がAdditiveではなくなってしまっていたのを修正


2025/03/03
　マルチスレッドIKのリファクタリング　その２
　　オイラー角のカーブのカレントフレーム部が凹んだり出っ張ったりする症状を直すためのリファクタリング
　　症状緩和にしかなりませんでした
　　以前ドキュメントに書いた気がしますが、マウスドラッグをゆっくりすることで症状が出なくなります
　　アプリウインドウ上部の一番左のスライダーEditRateスライダーの値を小さくすることも有効
　　計算ステップに依存する問題のようだ
　　

2025/03/02
　マルチスレッドIKのリファクタリング
　　IK履歴の構造体にできるだけ条件を保存して、スレッド実行時にはその条件で実行するように.
　　
　MOAプレイ中はアンドゥ用の処理をスキップ
　

2025/02/23
　AdditiveIK 1.0.0.39 release
　　1.0.0.38からの変更点
　　　不具合修正
　　　　fbxの入出力の度にモーションフレーム長が短くなっていく不具合を修正
　　　　fbxを読み込んでMOAの設定をしないでプロジェクト保存するとエラーで落ちる不具合を修正

　　　ジャンプ機能開発開始
　　　　モーション名にJumpを含ませることによりジャンプモーションとして認識
　　　　MOA2.0のジャンプモーション対応
　　　　FootRigのジャンプモーション対応
　　　　サンプル
　　　　　Test/2_B2Stair_1　

　　　サンプル修正
　　　　フレーム長が短くなる前のfbxに差し替え
　　　　B2_eng.fbxをリターゲットに使うことを想定して全モーションの０フレーム目を初期化
　　　　　Test/1_MOA_B2_6
　　　　　Test/2_B2Stair_1　

　　　Hipsボーンかどうかの判定関数を修正
　　　　Hipsという文字列が含まれるジョイントが複数階層連続して存在する場合には一番親のHipsを返すように.

　release: B2_eng.fbxの歩くモーションを微妙に調整


2025/02/23
　不具合修正
　　fbxの入出力の度にモーションフレーム長が短くなっていく不具合を修正
　　fbxを読み込んでMOAの設定をしないでプロジェクト保存するとエラーで落ちる不具合を修正
　　
　サンプルのフレーム長が短くなる前のfbxに差し替え
　B2_eng.fbxをリターゲットに使うことを想定して全モーションの０フレーム目を初期化
　　Test/1_MOA_B2_6
　　Test/2_B2Stair_1　

　Hipsボーンかどうかの判定関数を修正
　　Hipsという文字列が含まれるジョイントが複数階層連続して存在する場合には一番親のHipsを返すように.

2025/02/16
　ジャンプ機能開発開始
　　モーション名にJumpを含ませることによりジャンプモーションとして認識
　　MOA2.0のジャンプモーション対応
　　FootRigのジャンプモーション対応

2025/02/11
　AdditiveIK 1.0.0.38 release
　　1.0.0.37からの変更点
　　　不具合修正
　　　　MOA2.0実装の変更により操作中にエラーで落ちる不具合が出ていたのを修正
　　　　　リターゲット中にエラー終了するのを修正
　　　　　モーション削除中にエラー終了するのを修正
　　　　　モーション削除後にプロジェクト保存するとエラー終了するのを修正
　　　ゲームコントローラSonyDualSense接続時の描画速度低下を回避
　　　　DualSenseを接続してモーションを再生すると描画速度が低下していた
　　　　例えば120fpsが83fpsにまで落ちていた
　　　　現在バイブレーション機能を使用していないのでアプリケーションとしてのデバイスへの書き込みをスキップしたところ
　　　　描画速度が低下しなくなった

　　　MocapWalkLoop機能追加
　　　　全体移動が含まれている歩くモーキャプループモーションをその全体移動を活かしながら再生しキャラクターを移動させます
　　　　SonyDualSenseの左アナログスティックで歩くことを想定
　　　　MocapWalkLoop機能はMOA2.0機能の一部です　　
　　　　左アナログスティックの入れ方具合で歩くスピードを変えるように.
　　　　表示速度が変わっても曲がる度合が保たれるように.

　　　　ドキュメント
　　　　　Documents/TroubleShooting/0_AboutMocapWalkLoop.docx

　　　プロジェクト保存時にカメラ位置と向きを保存して読み込み時に復元するように

　　　オカルト部部長モデル(B2_eng.fbx)へbvhモーションをリターゲットする際の設定ファイル追加
　　　　Test/RetargetSettingFileExample/B2eng_bvh.rtg

　　　サンプルモデル修正
　　　　MOA2.0設定とMocapWalkLoop設定例
　　　　　Test/1_MOA_B2_6
　　　　MOA2.0設定とMocapWalkLoop設定とFootRig設定の組み合わせ例
　　　　　Test/2_B2Stair_1　

　　　ショートムービー
　　　　SonyDualSenseでリアルタイム階段接地
　　　　https://youtu.be/WTpdyVGKlcs


2025/02/10 その４
　MocapWalkLoop機能追加
　　全体移動が含まれている歩くモーキャプループモーションを前提にして移動させます
　　SonyDualSenseの左アナログスティックで歩くことを想定
　　MocapWalkLoop機能はMOA2.0機能の一部です　　

　　左アナログスティックの入れ方具合で歩くスピードを変えるように.

　　スティックでの回転の中心をモーションのHips位置に.
　　表示速度が変わっても曲がる度合が保たれるように修正.

　　サンプルモデル修正
　　　Test/1_MOA_B2_6

　　ショートムービー
　　　アナログスティックとモーキャプループモーションで歩いてみた
　　　https://youtu.be/Qgioc00XN2A


2025/02/09
　不具合修正
　　MOA2.0実装の変更により操作中にエラーで落ちる不具合が出ていたのを修正
　　　リターゲット中にエラー終了するのを修正
　　　モーション削除中にエラー終了するのを修正
　　　モーション削除後にプロジェクト保存するとエラー終了するのを修正
　
　サンプルモデル更新
　　Test/1_MOA_B2_3　
　　　RokDeBone2で出力したfbxのジョイント名を英語に.
　　　歩くモーキャプをリターゲットしてモーション追加.

　リターゲットファイル追加
　　Test/RetargetSettingFileExample/B2eng_bvh.rtg
　　　Test/1_MOA_B2_3のB2_eng.fbx用のリターゲットファイル


2025/02/02
　ゲームコントローラSonyDualSense接続時の描画速度低下を回避
　　DualSenseを接続してモーションを再生すると描画速度が低下していた
　　例えば120fpsが83fpsにまで落ちていた
　　現在バイブレーション機能を使用していないのでアプリケーションとしてのデバイスへの書き込みをスキップしたところ
　　描画速度が低下しなくなった



2025/01/25
　AdditiveIK 1.0.0.37 relase
　　1.0.0.36からの変更点
　　　MOA2.0のゲームパッド対応
　　　　PCにSonyDualSenseを接続してMOAプレートメニューで設定してプレイ
　　　サンプル更新
　　　　Test/1_MOA_B2_3


2025/01/19
　MOA2.0をゲームパッドSonyDualSesnseに対応させました
　　PCにつないだSony DualSenseに対応

　ゲームパッドの設定をしたテストモデル
　　Test/1_MOA_B2_3

2025/01/16
　README.mdの絵の差し替え

2025/01/13
　README.md更新

2025/01/13
　AdditiveIK 1.0.0.36 release
　　1.0.0.35からの変更点
　　　MOA2.0(MotionAccelerator)の搭載
　　　ドキュメント　　　
　　　　Documents/TroubleShooting/0_MOA2.docx
　　　サンプル更新
　　　　Test/1_MOA_B2
　　　ショートムービー更新
　　　　MOA2.0フリーズビッグモード
　　　　https://youtu.be/GFEmF8dnV_M

　RC2:
　　RokDeBone2で出力したばかりのfbxを読み込む際にフレーム長を２倍に(60fpsで).
　　　AdditiveIKで保存した後は変化はありません。
　　　RokDeBone2で出力したfbxのモーションフレーム長が読み込み時に1/2になっていたので対応。
　　MOA2.0を処理するSetNewPoseByMoa()関数をコメントを付けて書き直し
　　MOA再生中にフレーム番号がMOAによる処理以前の値に戻る不具合を修正
　　　MOA処理呼び出し元にフレーム番号を返しました。
　　MOA再生中のタイムライン処理修正
　　　DispAndLimitsで"GraphSkipOnMOA"を選んでいるときだけ処理を省略、それ以外の場合はタイムライン描画
　　MOA読み込み時のモーションループフラグに関する修正
　　　モーション読み込み時に自動的にループをオン
　　　MOAの再生時にループをオフ、再生終了時にループフラグを再生前の状態に復元
　RC3:
　　ショートムービー更新
　　　モーションアクセラレータ2.0
　　　https://youtu.be/l3JZnAI50YI
　RC4:
　　MOA修正
　　　キーボード連打に対応
　　　MOAの分岐設定が働いていなかった不具合修正
　　　設定のコツはモーションに対するイベント番号を分岐ごとに変えることにより１つのキーの連打でいろいろに動く
　　MOAフリーズモードをフリーズビッグモードに変更
　　　間違えが面白かったので　間違えが間違えとして正しく動くようにして採用
　　サンプル更新
　　　Test/1_MOA_B2　
　RC5:
　　MOAのフリーズビッグモード倍率調整
　　ショートムービー更新
　　　MOA2.0フリーズビッグモード
　　　https://youtu.be/GFEmF8dnV_M
　　Documents/TroubleShooting/0_MOA2.docxを更新
　release:
　　RokDeBone2で作ったfbxを読み込んだ場合に、書き出すときにフレーム長が1/2になっていた不具合を修正
　　Test/1_MOA_B2のfbxはフレーム長が1/2になっているが、動画と同じ見栄えにするためにそのままに.


2025/01/05
　MOA(MotionAccelerator)について作業(その６)

　　MOAのモーションの変わり目を補間するように。
　　　ターゲット姿勢との間を補間します
　　MOAのモーション変化時にタメを作るモード追加
　　　MOAのダイアログにFreeze for a moment when changing motionというチェックボックスを追加
　　　チェックを入れると動きの変わり目で少しの間フリーズします。
　　　この設定はまだ実験的なのでファイルに保存はしていません。

　　Test/1_MOA_B1のサンプルを更新　　　

　　ショートムービー
　　　MOA2.0 AdditiveIKのモーションアクセラレータ
　　　https://youtu.be/3aYcuhKP9MI

　　## 予定(To Do) ##
　　　使い方のドキュメント


2025/01/04
　MOA(MotionAccelerator)について作業中(その５)

　　MOAのPlayとStopの実装(モーション変化時にブレンド無し)
　　　Test/1_MOA_B1のプロジェクトを読み込んだ後に
　　　MOAプレートメニューを押して右ペインのダイアログのPlayボタンを押すとMOA再生モードになります
　　　キーボードの０から９とA,Bボタンで動くサンプルです

　　Test/1_MOA_B1のサンプルを更新　　　

　　ショートムービー
　　　MOA(MotionAccelerator) at AdditiveIK
　　　https://youtu.be/2O1zKXg-GXw

　　## 予定(To Do) ##
　　　使い方のドキュメント
　　　MOAのPlayとStopの実装(モーション変化時にブレンド有り)<---次のバージョン以降？？


2025/01/03
　MOA(MotionAccelerator)について作業中(その３)
　　プレートメニュー(MOAプレート)で設定画面表示
　　fbxファイル名に.moa拡張子を付けて保存読み込み(プロジェクトファイル読み書き時)
　　RokDeBone2で出力したmoaファイルの読み込みに対応
　　　プロジェクト保存後に所定の位置にfilename.fbx.moa形式の名前にして置けばRokDeBone2のmoaファイルも読み込み可能
　　Testフォルダにサンプルを追加
　　　1_MOA_B1というフォルダです
　　　moaの再生テスト用(再生機能はこれから作成)
　　　B.fbxはぼおんさん著作のbucho.sigファイルをfbxにしたものです。
　　　

　　## 予定(To Do) ##
　　　MOAのPlayとStopの実装(モーション変化時にブレンド無し)
　　　MOAのPlayとStopの実装(モーション変化時にブレンド有り)
　　　使い方のドキュメント


2025/01/02
　MOA(MotionAccelerator)について作業中(その１)
　　途中経過をコミット
　　まずはクラスを揃えてデバッグビルドでビルドが通るように。

　　## 予定(To Do) ##
　　　プレートメニューで設定画面表示
　　　fbxファイル名に.moa拡張子を付けて保存、読み込み
　　　MOAのPlayとStopの実装(モーション変化時にブレンド無し)
　　　MOAのPlayとStopの実装(モーション変化時にブレンド有り)

2024/12/14
　AdditiveIK 1.0.0.35 release
　　1.0.0.34からの変更点
　　　履歴ファイルと設定ファイルの保存場所をAppData/Local/Programs/OchakkoLAB/AdditiveIKに変更
　　　　AppData/Local/Tempフォルダに保存していましたが、アップデートなどでファイルが頻繁に消えるようになったので対応。
　　　　(特に履歴ファイルの内容としてchaファイル名が記述されているとすぐに履歴ファイルが消えるようになったので対応。)
　　　　昔の保存場所から新しい保存場所にコピーするボタン(Copy HistoryFiles From TempFolderボタン)をファイルを開くときのダイアログに追加。

　　　FootRig1.2.0
　　　　ver1.2.0
　　　　前バージョンまでは足の基準点がつま先１点だった
　　　　ver1.2.0からは足の基準点をつま先とカカトの２点にした
　　　　足の裏へのオフセットもつま先Offset1とカカトOffset2の２つ用意しGUIも対応
　　　　GUIによるパラメータの設定により以前より格段に足が地面に潜らなくなった
　　　　＊まだ地面にもぐることはある。より改善するためには３点以上必要。しかしカメラが足の高さから足をクローズアップするシーンはあまりない、重くなり過ぎないように２点のままにしておく。
　　　
　　　Pick処理修正
　　　　メッシュ内で一番近いピック座標を求める処理をシェーダーの外に出した
　　　　シェーダは並列処理なので、シェーダデータの配列の同一インデックスにアクセスしないようにするため.
　　　　ピックの不具合解消
　　　　FootRigのGPUオプションの不具合も解消

　　　物理設定修正
　　　　Test/Test_FootRig_7_2更新
　　　　Test/0_VRoid202406_Cam004更新


2024/12/14
　履歴ファイルと設定ファイルの保存場所をAppData/Local/Programs/OchakkoLAB/AdditiveIKに変更
　　AppData/Local/Tempフォルダに保存していましたが、アップデートなどでファイルが頻繁に消えるようになったので対応。
　　(特に履歴ファイルの内容としてchaファイル名が記述されているとすぐに履歴ファイルが消えるようになったので対応。)
　　昔の保存場所から新しい保存場所にコピーするボタン(Copy HistoryFiles From TempFolderボタン)をファイルを開くときのダイアログに追加。
　　
　dbg.txtファイルとiniファイルについてもAppDataに保存.



2024/11/10
　FootRig修正
　　足の位置の最終修正時の計算を修正
　　　高い方の地面に低い方の足(つま先orフット)の位置を合わせるように.
　　　階段上り下り時にも足がほとんど潜らなくなった(FootRigメニューで数値を調整する必要はある)

　Test/Test_FootRig_7_2更新



2024/10/20
　FootRigDlgのOffsetのラベル修正
　　ドキュメント内のFootRigDlgのスクリーンショット更新
　　　Documents/FootRig_TechSpec.docx
　　　Documents/TroubleShooting/0_HowToSettingFootRig.docx


2024/10/17
　FootRig1.2.0
　　ver1.2.0
　　前バージョンまでは足の基準点がつま先１点だった
　　ver1.2.0からは足の基準点をつま先とカカトの２点にした
　　足の裏へのオフセットもつま先Offset1とカカトOffset2の２つ用意しGUIも対応
　　GUIによるパラメータの設定により以前より格段に足が地面に潜らなくなった

　Test/Test_FootRig_7_2更新

　FootRig仕様書も更新
　　Documents/FootRig_TechSpec.docx

　ショートムービー
　　リアルタイムFootRig 1.2.0 at AdditiveIK
　　https://youtu.be/VH21YgC-jvA



2024/10/16
　Try and Omit about PickingShader.
　　ピック処理においてマルチスレッドシェーダ処理時には同じ変数へのアクセスが出来ない
　　そのため全ての面に対する当たり判定はシェーダ(GPU)で出来るが、その中で一番近い当たりを探すのはCPUでしている
　　その一番近い当たり探しをスレッド数１のシェーダでした場合に高速化するかどうかを試した
　　ローポリとミドルポリで試したが処理は速くならなかった
　　今回の試行はオミットするが、何かに使える時が来るかもしれないのでコメントアウトして残しておく
　　
　FootRigの修正
　　足の位置のオフセットをYだけでなくZも指定可能に.
　　Zオフセットはモーション前に適用し、Yオフセットはモーション後に適用する.
　　ゲーム用に速く表示しようとしてやっているが、バウンダリー同士の当たり判定が必要かどうか試しながら決めていく予定.
　　
　Test/Test_FootRig_7_2追加
　　ローポリ階段モデルを歩く




2024/10/10
　Pick処理修正
　　メッシュ内で一番近いピック座標を求める処理をシェーダーの外に出した
　　シェーダは並列処理なので、シェーダデータの配列の同一インデックスにアクセスしないようにするため.
　　ピックの不具合解消
　　FootRigのGPUオプションの不具合も解消

　ゲームコントローラの終了処理忘れを修正
　　アプリ終了時にゲームコントローラの終了処理　　　


2024/10/09
　ショートムービー
　階段に足が潜らないFootRig⚡
　https://youtu.be/yc2aLPMbkaw


2024/10/07
　FootRig修正
　　ブレンド率に0.0以外を指定した場合のブレンド計算を修正
　　　GUIのラベルをBlendRateにしたので、blendrateと1.0-blendrateを逆にした


2024/10/06
　FootRig修正
　　階段を歩く動画で足が階段にめり込んでいた症状に対して改善策
　　　FootRigメニューのGUIにBlendRate of ModelWMスライダーを追加
　　　モデルの高さを１回前のモデルの高さとブレンドする際のブレンド率を設定可能に.
　　　足がめり込んでいた直接の原因はモデルの高さのブレンドにあった
　　　なぜブレンドが必要かという根本的原因としては、地面に隙間があってそこに落ちてがくがくすることがあったっため
　　　今後は、FootRigの当たり判定用地面として隙間が空いていないデータを用意し、高さのブレンド率は通常0.0にする


2024/10/01
　SonyPlayStation用のゲームコントローラDualSense対応復活
　　https://github.com/sonichope/DS4HidInput (MIT LICENSE)を使用
　　キャラクターの移動やモーション切り替えのテストに使用する予定
　　以前のようにアプリのGUI操作のためには使わない予定


2024/09/25
　AdditiveIK 1.0.0.34 relase
　　1.0.0.33からの変更点
　　　VRM1.0限定のfbx内包テクスチャ対応
　　　　VRM1.0をfbxにしてもテクスチャは別ファイルとしては出力されない
　　　　VRM1.0をfbxにするときにUnity3Dの出力オプションでEmbedTextureをオンにして
　　　　fbxにvrmファイルを内包する
　　　　内包したvrmファイルからテクスチャを読み込む
　　　　　
　　　　ドキュメント
　　　　　Documents/TroubleShooting/DisplayedInBrightRedWhenLoadingFBX.docx

　　　FootRig設定の初期値(未設定時の数値)を変更
　　　　VRoidに対してFootRigを使用する際に足を曲げ過ぎないような設定に.




2024/09/24
　ドキュメント追加
　　Documents/TroubleShooting/DisplayedInBrightRedWhenLoadingFBX.docx


2024/09/23
　VRM1.0のVRoidをUnity3Dでfbx形式で出力したものを読み込めるように.
　　今まで通りに読み込むとテクスチャファイルが無いので真っ赤になってしまう。
　　VRM1.0をfbxにするときにUnity3Dの出力オプションでEmbedをオンにした場合
　　fbxにvrmファイルが埋め込まれる
　　埋め込まれたvrm1.0ファイルからテクスチャだけ読み込んで機能補間
　　vrm1.0読込にはsyoyoさんのtinygltfを使用
　　3rd_LINCENSEフォルダにtinygltf追加、README.mdにtinygltfの記述を追加

　　VRM1.0からコンバートしたfbxを含むプロジェクトの保存に対応
　　


2024/09/21
　FootRig設定の初期値(未設定時の数値)を変更


2024/09/18 その２
　README.mdに1.0.0.33(リリースしました)のスクリーンショットを追加

2024/09/18
　AdditiveIK 1.0.0.33 release
　　1.0.0.32からの変更点
　　　FootRig(フットリグ)バージョンアップ
　　　　FootRigのバージョンを1.0.0から1.1.0にアップ
　　　　　足の曲げ方を調整可能に.
　　　　　height difference maxの値を小さくするほど足をたくさん曲げて接地.
　　　　　height difference maxの値に互換性が無くなったので設定し直しが必要
　　　　GPU当たり判定オプションを追加
　　　　　GPU Collisionにチェックを入れてApplyボタンを押すと当たり判定をコンピュートシェーダで計算
　　　　　地面として指定したfbxの面の数が多いほど何倍にも高速化
　　　　　地面のメッシュの面数が少ない場合はGPUオプションで遅くなることもあります
　　　　RigStepの設定が効くように修正
　　　　　指定したdegree * リグで設定した倍率の角度ずつ回転
　　　　　一度に曲がる最大角度は約10.0度
　　　　Hop Y per step設定項目を追加
　　　　　坂を上るほどしゃがんでしまうような動きなるのを防ぐために、ステップごとに(上方向に)ホップ
　　　　モデル削除時にFootRigDlgのCModelをキーにするデータも消すように修正
　　　　　不要データで重くならないように削除
　　　　ドキュメント
　　　　　Documents\TroubleShooting\0_HowToSettingFootRig.docxを追加(使い方：インストーラにも同梱)
　　　　　Documents\FootRig_TechSpec.docxを更新(仕様：OSSのみ)
　　　　FootRigのテストシーン更新
　　　　　Test/Test_FootRig_7を更新

　　　既知の問題13への対応
　　　　マテリアルとしてPhong以外が割り当てられているfbxを読み込んでも落ちなくなった
　　　　しかしPhong以外のマテリアルの場合は読み込み後にAdditiveIKのShaderメニューでマテリアルの再設定が必要
　　　　Documents/TroubleShooting/00_KnownIssue.docx更新

　　　Pickシェーダ修正
　　　　今までは最初にみつかった当たりの面の情報を返していたが
　　　　今回からはメッシュの中の一番近い当り面の情報を返す
　　　　ただし数字キーを押しながらのNumPick機能についてはそのまま(メッシュの中心との距離でソート).

　　　LimitEulオン時の物理シミュに関わる修正
　　　　昔の仕様のためのif文が残っていたのを修正

　RC2:
　　Documents\TroubleShooting\0_HowToSettingFootRig.docxに追記





2024/09/17
　FootRig修正
　　RigStepの指定が効くように.
　　　最大約10degreeまでのリミッター付きで指定通り回転
　　　Rigの設定で倍率を指定している場合には　回転角度=RigStep * rigmultで回転
　　　RigStepに何を設定しても2.8degreeのずつ回転していたのを修正

2024/09/16
　FootRigの仕様をver1.1.0にバージョンアップ
　　足の曲がり具合を調整しやすくしたバージョン
　　Documents\FootRig_TechSpec.docxを更新
　　Documents\TroubleShooting\0_HowToSettingFootRig.docxを追加
　　Test/Test_FootRig_7を更新
　　FootRigDlgのgpuinteractionをgpucollisionに表記変更

2024/09/15
　Pickシェーダ修正
　　今までは最初にみつかった当たりの面の情報を返していたが
　　今回からはメッシュの中の一番近い当り面の情報を返す
　　ただし数字キーを押しながらのNumPick機能についてはそのまま(メッシュの中心との距離でソート).

　FootRigの地面の高さ計算部分をシェーダで計算可能に.
　　FootRig設定ウインドウにGPUIntaractionチェックボックスを追加
　　チェックを入れてApplyボタンを押すと地面との当たり判定をコンピュートシェーダで行う
　　地面のポリゴン数が多いほどGPUに切り替えた方が速くなる
　　(地面のポリゴン数が少ない場合にはGPUにしない方が速い)

　　大きいシーン読み込み時にメモリ不足で落ちないように
　　原則としてシェーダでの当たり判定(DispGroupメニューとShaderメニューも)はスキンメッシュ(ボーン入りメッシュ)だけですが
　　FootRig設定でGPUIntaraction指定した地面データに対してもシェーダで判定を行う

　　プロジェクト保存時と読み込み時に　FootRigDlgのGPUInteraction設定を保存読み込み

2024/09/14
　既知の問題13への対応
　　マテリアルとしてPhong以外が割り当てられているfbxを読み込んでも落ちなくなった
　　しかしPhong以外のマテリアルの場合は読み込み後にAdditiveIKのShaderメニューでマテリアルの再設定が必要
　　Documents/TroubleShooting/00_KnownIssue.docx更新


2024/09/13
　wallscrapingikflagを引数にして処理ごとに指定可能に.

　README.mdに1.0.0.32のスクリーンショット追加

　FootRigの角度制限をもう一度試したが以下の理由で採用せしない、仕組みだけ残しておく
　　LimitEul角度制限のオンオフに対応　制限オンの時には強制的に壁すりIKもオン
　　しかし、limiteulオフで計算した方が綺麗に動く
　　limiteulオンで足を上げると足を戻す動作の変化が大きくなり(速くなり)綺麗にはみえなかった
　　Rigの動作範囲は確認可能であり、FootRigの設定で制限した方が綺麗に動くのでそうすることに
　　角度制限に対応したが、FootRigに関してはUpdate関数内でlimitdegflag = falseに上書きして使用する

　LimitEulオン時の物理シミュに関わる修正
　　SetWorldMat()内において物理シミュ中もChkMovableEul()で制限角度チェックをするように修正
　　物理に対して自前の角度制限を行っていなかった昔のif文が残っていたので修正


2024/09/12
　モデル削除時にFootRigDlgのCModelをキーにするデータも消すように修正
　　不要データで重くならないように削除


2024/09/10
　AdditiveIK 1.0.0.32 release
　　1.0.0.31からの変更点
　　　FootRig(フットリグ)機能追加
　　　　モーションしている足を自動的に曲げて地面に接地
　　　　FootRigプレートメニュークリックで右ペインに設定ウインドウを表示
　　　　角度制限、物理シミュのと併用可能
　　　　FootRigの設定は拡張子(*.fri)のファイルに保存(モデルを横断するのでプロジェクトフォルダ直下に)
　　　　　friファイルの入出力はプロジェクト保存時と読み込み時に行う
　　　　テストモデル追加
　　　　　Test/Test_FootRig_7

　　　物理シミュ修正
　　　　Kinematic剛体のSetBtMotionを修正
　　　　　揺れ物以外はモーションそのままの姿勢に.
　　　　　多少乱れにくくなったのでBullet設定のRigidSpeedの値を大きく出来るようになった
　　　　物理シミュ中のIK操作処理に関わる関数を修正
　　　　　ただし物理IK機能は休止中

　　　不具合修正
　　　　カメラのパン操作修正
　　　　　パンの際にAlwaysLockがオフにならない症状が出ていたので修正
　　　　カメラグラフモードにて　最終フレームまで選択ボタン　を押した際に最後まで選択されないことがある不具合を修正
　　　　　プレイヤーボタンの　｜｜ボタンを押したときの処理の修正
　　　　　
　　　既知の問題に追記
　　　　Documents/TroubleShooting/00_KnownIssue.docx

　　　テストモデル修正
　　　　Test/0_VRoid202406_Cam004　の物理とリグの設定を修正


　ヒント
　　FootRigについて
　　　AdditiveIKによるCustomRigが設定済のモデルでしか機能しない
　　　あらかじめ足を持ち上げるためのRigをCustomRigDlgで設定しておく
　　　FootRig設定ウインドウにおいて　Rigの選択よりも前にJointの選択をする
　　　RigのコンボボックスにはJointコンボボックスで選択したジョイントに関連付いているRig名しか表示されない
　　　Rigが設定されているJointは左ペインのツリービューの項目名が緑色で表示されている

　ヒント
　　FootRig機能を有効にしている場合には
　　モデル全体の位置を地面より高い位置(1000よりは低く)にModel'sPosAndDirショートカットボタンで設定しておくこと.
　　Model'sPosAndDir設定はchaファイルにモデルごとにテキスト出力されている.
　　地面より低い位置からスタートするとしゃがむ姿勢になったり地面の下にもぐることがある.

　ヒント
　　FootRigは地面指定したモデルとレイの当たり判定を使用しています
　　通常のゲームにおいては　地面として指定するのは　非表示のローポリデータです
　　表示用の詳細モデルの上を歩かせると　ショートムービー[歩きの足を自動で曲げて階段上り]のように
　　階段の隙間に落っこちて動きがガクガクすることがあります
　　

　ショートムービー
　　歩きの足を自動で曲げて階段上り
　　　https://youtu.be/IV9gZEhIi5E

　　FootRigで接地して歩く
　　　https://youtu.be/TJjTwD0gioI

　　OXの風景
　　　https://youtu.be/HZxVflJui40


　RC2:
　　モデルを削除するとアプリが落ちる不具合を修正
　　　FootRigのUpdate()で削除済のモデルを参照していたのが原因
　　　Update()時などに削除済かどうかを確認するように修正
　　プロジェクト読み込み時にModel'sPosAndDir設定が効かなくなっていたのを修正
　　　FootRigのUpdateが走り、ワールドマトリクスが補間されて途中位置までしか移動していなかったのが原因
　　LimitEulオン＋BtSimuオン＋FootRigオンの時に足のエンドジョイントが動きに付いてこないことがあったのを修正
　　　UpdateModelWMFootRig()処理はFootRigに対してのみ行うように修正
　　　UpdateModelWMFootRig()内でbtmatもセットするように修正
　　FootRigのモデル全体位置のブレンド率を調整

　RC3:
　　ショートムービーを追加して古いリンクを変更
　　README.mdのショートムービーリンクも更新

　RC4:
　　不具合修正
　　　プレイヤーボタンの　｜｜ボタンを押したときの処理の修正
　　ヒント追記
　release:
　　Documents/FootRig_TechSpec.docxのFootRig仕様書に使用上のヒントを追記してバージョン1.0.0とした.
　　Documents/TroubleShooting/00_KnownIssue.docxに既知の問題14追記



2024/09/09
　FootRig機能修正
　　CustomRigDlgでの設定結果をFootRigDlgに反映するように.

　　仕様に追記
　　　Documents/FootRig_TechSpec.docx更新

　　テストモデルアップデート
　　　ヘアなどの物理設定を修正
　　　Test/Test_FootRig_7



2024/09/08
　FootRig機能修正
　　角度制限機能(LimitEul)を有効にできるように.
　　　LimitEulオンの時にはFootRig以外を角度制限
　　　FootRigに関してはリグの指定と高さの閾値でリミット済とする
　　　理由
　　　　FootRigは変動が大きいためLimitEulを適用すると可動フレームで止まりパタパタしすぎる
　　　　ブレンドしてもパタパタし過ぎる
　　テストモデルに制限角度を設定してアップデート
　　　Test/Test_FootRig_7
　　RigControlFootRig()呼び出しループを関数化
　　FootRig中のUpdateMatrix用のupdateboneをrigの内容をみて決めるように修正
　　２回目のFootRig()呼び出し前にhigherとlowerの比較をして必要に応じて入れ替えて呼び出し

　　(注意)
　　FootRig機能を有効にしている場合には
　　モデル全体の位置を地面より高い位置(1000よりは低く)にModel'sPosAndDirショートカットボタンで設定しておくこと.
　　Model'sPosAndDir設定はchaファイルにモデルごとにテキスト出力されている.
　　地面より低い位置からスタートするとしゃがむ姿勢になったり地面の下にもぐることがある.




2024/09/07
　FootRig機能修正
　　物理との併用時に物理オフ時の挙動と同様に足を曲げるようになった.
　　　うまくいっていなかった原因は、UpdateCurrentWM(), UpdateParentWM()などにおいて物理オンの時にworldmatを変更していなかったことが原因
　　　物理オンの場合にはBtMatだけでなくworldmatも変更するように修正して直った.
　　　もう１つ原因はRigControlFootRig()中のSaveSRT()をコメントアウトしていたが必要だったことが原因.
　　　RigControlFootRig()の回転軸は元に戻した.


2024/09/06その２
　FootRig機能修正
　　物理と併用時のRigControllFootRig()の回転軸を修正
　　　足が変な風には曲がらなくなった
　　　乱れなくなったのでFootRigの足を曲げる部分のブレンドが必要無くなった
　　　物理オフの時とは挙動が変わって、モデル位置がすぐに変わってしまいなかなか足が曲がらない


2024/09/06
　FootRig機能修正
　　FootRigのチェックボックスがオンの場合には設定ウインドウを出していなくてもFootRigを機能させるように.
　　FootRigと物理シミュの併用に対応
　　　物理シミュ時に非物理時と同様にFootRigで曲げると変化が急すぎてどうしても乱れる
　　　物理シミュ時には１回前の結果とブレンドして乱れないようにしたが、足を曲げたいときに曲がりにくく、急斜面で足が地面に潜ることがある
　　　物理シミュ時には地面の傾斜がきついところは歩かせないようにする必要有
　　モーションにFootRigの結果が残る不具合がまだ出ていたので修正
　　
　　テストステージアップデート
　　　Test/Test_FootRig_6_2
　　　FootRig実行の影響を受けていないfbxに戻した

　物理シミュ修正
　　Kinematic剛体のSetBtMotionを修正
　　　モーションそのままの姿勢に.
　　　乱れにくくなったのでBullet設定のRigidSpeedの値を大きく出来るようになった


2024/09/04その２
　FootRig機能(その３)仕様修正実装修正
　　FootRigをゆっくり再生すると元モーションのグラフがジャギーになる不具合修正
　　　フレーム時間を丸めていなかったことによる不具合
　　FootRig再生時に前回の結果とブレンドするように修正
　　出来るだけ低い方の地面に接地して高い方の足をFootRigで曲げるように修正
　　　hdiffmaxの値を大きくしてFootRig()の２回目を呼ぶことにより高い方の足が曲がりやすく
　　条件文をすり抜けて足が地面に潜るケースにも対応
　　急すぎる斜面を歩くと足が滑る感じになるがそれは採用

　　テストステージアップデート
　　　Test/Test_FootRig_6_2

　　仕様修正
　　　Documents/FootRig_TechSpec.docx更新


2024/09/04
　FootRig機能(その２)仕様修正実装修正
　　良さそうな具合？になってきた

　　テストステージアップデート
　　　Test/Test_FootRig_6_2

　　仕様修正
　　　Documents/FootRig_TechSpec.docx更新

　　　　
　ショートムービー
　　FootRigで接地して歩く
　　https://youtu.be/TJjTwD0gioI

2024/09/03
　FootRig機能(その１)
　　とりあえず実装
　　右ペインにFootRigウインドウを表示していてかつEnableFootRigにチェックが入っているときのみ動作
　　
　　もっと急激な段差のステージで試してデバッグする必要がありそう


2024/09/02
　FootRig機能作成時のテスト用プロジェクト作成
　　Test/Test_FootRig_6/Test_FootRig_6.cha
　　FootRig機能作成はこれから取り掛かる

　不具合修正
　　モデルを削除してからプロジェクトを保存すると落ちていた
　　　FootRigファイルを保存する際にモデル削除を確認するように修正

　　カメラのパン操作修正
　　　パンの際にAlwaysLockがオフにならない症状が出ていたので修正


　FootRigDlgのレイアウトを少し修正
　　途中までしか表示されていないラベルがあったので修正

　仕様書更新
　　図１を差し替え
　　Documents/FootRig_TechSpec.docx


　既知の問題に追記
　　Documents/TroubleShooting/00_KnownIssue.docx


2024/09/01
　FootRigの設定の保存読み込み
　　プロジェクト保存読み込みと一緒に保存読み込み
　　モデルをまたいで設定するのでプロジェクトフォルダ直下に保存(*.fri)
　　機能実装時の試行錯誤を楽にするために先にGUIを作ったところ　FootRigはまだ機能していない


2024/08/30
　FootRigの右ペインウインドウ
　　FootRigプレートメニュークリックで設定ウインドウを右ペインに表示
　　まだGUIだけでFootRigとしては機能していない
　　設定の保存読み込みもまだ

　　ヒント
　　　Rigが設定済のモデルでしか機能しない
　　　あらかじめ足を持ち上げるためのRigを設定しておく
　　　FootRig設定ウインドウにおいて　Rigの選択よりも前にJointの選択をする
　　　RigのコンボボックスにはJointコンボボックスで選択したジョイントに関連付いているRig名しか表示されない
　　　Rigが設定されているJointは左ペインのツリービューの項目名が緑色で表示されている


2024/08/29
　FootRigのプレートメニュー
　　とりあえずメニューから
　　Retarget, LimitEul, Q2Eul_Thresholdメニューの並びの右側にFootRigメニューを配置
　　まだメニューだけ

2024/08/28
  FootRigの仕様書ver0.0.1
　　歩くモーションをするモデルの足の高さ調整のための仕様
　　仕様の通り実装してみてから 仕様も修正していく
　　Documents/FootRig_TechSpec.docx

2024/08/26
　ショートムービーのリンクをREADME.mdに追加
　　OXの風景
　　https://youtu.be/HZxVflJui40

2024/08/23
　AdditiveIK 1.0.0.31 release
　　1.0.0.30からの変更点
　　　カメラ回転を更に修正
　　　　カレントカメラの正面に対してXYZ軸で回転したい場合と、グローバル軸で回転したい場合(特にY軸回転)があるので対応.
　　　　DispAndLimitsの回転軸コンボボックス指定がGLOBAL指定かそれ以外の指定かをみて回転するように.
　　　　GLOBAL軸で回転する場合　：　カメラがX,Z軸で回転して地面が傾いている状態からY軸回転するときに傾いた地面に水平に回転可能.
　　　　GLOBAL軸以外で回転する場合　：　カメラの正面に対してのXYZ軸で回転可能.
　　　　0_AboutCameraAnim.docx更新


　　　カメラツイストのリセットをカメラアニメにも反映
　　　　カメラツイストのリセットが グラフモードがCamera以外の場合にしか効いていなかったのを修正
　　　　カメラ回転アイコン右ダブルクリック時にグラフモードがCameraになっている場合にはカメラアニメのツイストをリセット
　
　　　AlwaysLockにチェックを入れている場合
　　　　カメラ移動操作とAlwaysLockは連動して働いていたが、カメラ回転操作とAlwaysLockは互いに独立していた
　　　　カメラ回転操作時にもAlwaysLockにチェックしている場合にはAlwaysLockと連動するように修正

　　　ソフトキーパッド修正
　　　　アルファベット付ソフトキーにL/S(大文字小文字切り替え)ボタン追加
　　　　クリア(CL)とバックスペース(BS)ボタンを押しやすく
　　　　レイアウトをみやすく


　(*)やることの予定はまだまだたくさんあるのですが、カメラの基本操作が修正によりまとまった感があるのでいったん区切ってリリースします.

　RC2:
　　カメラの回転軸をGLOBALとそれ以外で場合分け.
　　回転軸はDispAndLimitsメニューの軸の種類コンボボックスで指定.
　　0_AboutCameraAnim.docx更新
　RC3:
　　軸がGLOBALではない場合のカメラ回転をテスト＆修正
　　軸がGLOBALの場合のカメラ回転をテスト＆OK
　RC4:
　　オープンダイアログのTestフォルダのパスが1.0.0.30のままだったのを修正



2024/08/21
　ソフトキーパッド修正
　　アルファベット付ソフトキーにL/S(大文字小文字切り替え)ボタン追加
　　クリア(CL)とバックスペース(BS)ボタンを押しやすく
　　レイアウトをみやすく


2024/08/20
　カメラ回転を更に修正
　　カメラの回転軸が回転前の姿勢の軸になっていなかったのを修正.
　　Documents/AdditiveIK_A4_20240818.jpegの仕様の通りの回転軸に.
　　
　カメラツイストのリセットをカメラアニメにも反映
　　カメラツイストのリセットがグラフモードがCamera以外の場合にしか効いていなかったのを修正
　　カメラ回転アイコン右ダブルクリック時にグラフモードがCameraになっている場合にはカメラアニメのツイストをリセット

　
　AlwaysLockにチェックを入れている場合
　　カメラ移動操作とAlwaysLockは連動して働いていたが、カメラ回転操作とAlwaysLockは互いに独立していた
　　カメラ回転操作時にもAlwaysLockにチェックしている場合にはAlwaysLockと連動するように修正


2024/08/18
　TechnicalSpecsのリンクをREADMEに追加
　　https://ochakkolab.jp/diary_win.html#AdditiveIK_2024_08_18

　ドキュメント追加
　　AdditiveIKについてA4一枚で説明
　　Documents/AdditiveIK_A4_20240818.jpeg

　ショートムービー
　　カメラがくるっと周った後の編集について
　　https://youtu.be/VrAYFkpyVwc


2024/08/16
　AdditiveIK 1.0.0.30 release
　　1.0.0.29からの変更点
　　　不具合修正
　　　　右ペインウインドウソース見直しによりGUI<-->設定値のやりとりの間違いを４つ程修正
　　　　　ShaderウインドウのLowAddrとHiAddrの値
　　　　　LimitEulウインドウのY最大値とX最大値
　　　　　Q2Eul_Thresholdウインドウのエンドジョイント値と非エンドジョイント値
　　　　　ShadowウインドウでGUIの値を設定値に反映させるために呼び出す関数を間違えていたのを修正

　　　　スキンメッシュのピック修正
　　　　　バウンダリーの粗い判定と面の詳細判定の２段階にしていたのだが
　　　　　粗い判定時のバウンダリー(非InfScope)がモーションを反映していなかったためにピック出来ないことがあった
　　　　　モーションに全体移動が含まれているとピックがずれていた
　　　　　とりあえず面の詳細判定のみをシェーダで行う方式に.

　　　　カメラ回転処理を修正
　　　　　既にカメラアニメが付いている場合に180度回転したフレームにおいてマウスドラッグと反対側に回転する不具合が出ていた
　　　　　ボーン回転時の処理と同様にスードローカル(疑似ローカル)のやり方で対応
　　　　　0_AboutCameraAnim.docxの使用してのメモ(今回対応した不具合に関する注意の記述)の部分を修正

　　　　カメラグラフモードにてAlwaysLockオンの状態でカレントモデルを変更した場合に
　　　　　Lock情報が残っていてカメラ操作(虫眼鏡アイコンドラッグ)が効かなくなることがある不具合を修正
　　　　　モデル変更時にLock情報を初期化(１回前の状態を保存している変数も初期化)

　　　　カメラの操作のアンドゥリドゥが効かないことがある不具合を修正

　　　　カメラ移動操作の際にAlwaysLockにチェックが入っている場合の処理を修正
　　　　　ジョイント方向を向くように


　　　カメラドリー履歴にカメラupvec情報を追加
　　　　昔の履歴のupvecはY軸として扱う
　　　　新しい履歴のupvecは数値としては編集せず(数値として直感的ではないため)に画面の状態を保存して復元する
　　　　つまり、GUIはそのままでカメラのupvecに対応
　　　　ドキュメント更新
　　　　　00_KnownIssue.docxの問題0012に解決済マーク追記

　　　カメラツイスト操作をカメラアニメに反映するように.
　　　　カメラツイストアニメ編集が可能に.
　　　　カメラ回転アイコン右ドラッグでカメラツイスト
　　　　ドラッグ量ｘブラシウェイトの分、カメラアニメをツイスト
　　　　カメラグラフモードになっていない場合にはインフォウインドウに情報出力

　　　カメラアイコンドラッグ時にカメラグラフモードになっていない場合に
　　　　グラフモードを変えるようにインフォウインドウに情報を出力

　　　カメラグラフモードをオンにした場合には
　　　　強制的にカメラアニメ(再生)スイッチもオンにするように修正


　　　フォグの計算を修正
　　　　フォグの計算式が最小距離と最小高さを考慮できていなかったのを修正


　ヒント
　　カメラのupvec編集はカメラ回転アイコンを右ドラッグ
　　カメラ回転アイコンを右ダブルクリックでupvecリセット


　ヒント
　　カレントモデル変更時にカメラターゲットウインドウのカメラ距離スライダーが最大値(20000)より振り切ってしまう場合
　　虫眼鏡アイコンドラッグが効かないことがあります
　　その場合には、カメラ距離スライダーを小さい値にすると操作可能になります

　ヒント
　　フォグやDOFなどの最小距離と最大距離の設定があるエフェクトについて
　　　フォグもDOFも実際の効果に影響する値の範囲は0から1つまり値の幅は1
　　　画面上の効果は次式(軽い計算式)で計算
　　　画面上の効果 = 値の幅1 x (頂点とカメラの距離 - 最小距離) / (最大距離 - 最小距離)
　　　つまり画面上には 1 / (最大距離 - 最小距離)ずつしか変化が生じない
　　　よって最大距離 - 最小距離が数百くらいになるように設定すると　効果を確認しやすい
　　　まず最小距離を決めてから最大距離は最小距離に数百を足したものにすると簡単
　　　(最大距離 - 最小距離)が10000もあると　最小距離における効果は0.0001であり　効果が分かり難い


　メモ
　　Impulseメニュー、GrandPlaneメニュー、DampAnimメニュー(の機能)については現在メンテナンスしていない
　　　ImpulseとGrandPlaneはラグドール機能の試験中に使用し、ラグドール機能休止と共に未メンテナンスに.
　　　DampAnimメニューは今よりも物理シミュが乱れて使えなかった頃に乱れを収めるために使用していたが現在未メンテナンスに.


　RC2:
　　UpdateLog.txt(本テキスト)にヒントを追記

　RC3:
　　カメラの操作のアンドゥリドゥが効かないことがある不具合を修正

　　カメラ移動操作の際にAlwaysLockにチェックが入っている場合の処理を修正
　　　ジョイント方向を向くように

　RC4:
　　カメラ回転処理を修正
　　　既にカメラアニメが付いている場合に180度回転したフレームにおいてマウスドラッグと反対側に回転する不具合が出ていた
　　　ボーン回転時の処理と同様にスードローカル(疑似ローカル)のやり方で対応
　　　0_AboutCameraAnim.docxの使用してのメモ(今回対応した不具合に関する注意の記述)の部分を修正



2024/08/11
　DofウインドウをCDofDlgにクラス化

　OnFrameShaderTypeParamsDlg()の中身をCShaderParamsDlgクラス内に移動.

　OnFrameSkyParamsDlg()の中身をCSkyParamsDlgクラス内に移動.
　　CSkyParamsDlgのメンバを使うべきところにCShaderParamsDlgのメンバを使っていた部分を修正
　　コピペして未編集のミス




2024/08/10
　ShadowウインドウをCShadowDlgにクラス化

　ImpulseウインドウをCImpulseDlgにクラス化

　GPlaneウインドウをCGPlaneDlgにクラス化

　DampAnimウインドウをCDampAnimDlgにクラス化

　Q2Eul_ThresholdウインドウをCThresholdDlgにクラス化

　FogウインドウをCFogDlgにクラス化


　不具合修正
　　Shadowウインドウで設定したパラメータを適用するために呼び出す関数を間違えていた
　　　シャドウカメラ更新用の関数を呼ぶべきところをライト変更用の関数を呼んでいた
　　　コピペして修正していなかったミス

　　Thresholdウインドウにて閾値をダイアログに表示する際にエンドジョイントと非エンドジョイントの値が入れ替わっていた
　　　入れ替わっていた文字列を取得して閾値にセットしていたことにもなる　ぐるぐる＠...


　メモ
　　Impulseメニュー、GrandPlaneメニュー、DampAnimメニュー(の機能)については現在メンテナンスしていない
　　　ImpulseとGrandPlaneはラグドール機能の試験中に使用し、ラグドール機能休止と共に未メンテナンスに.
　　　DampAnimメニューは今よりも物理シミュが乱れて使えなかった頃に乱れを収めるために使用していたが現在未メンテナンスに.



2024/08/09
　ShaderTypeParamsウインドウをCShaderParamsDlgにクラス化
　
　SkyウインドウをCSkyParamsDlgにクラス化

　RetargetウインドウをCRetargetDlgにクラス化

　AngleLimitウインドウをCLimitEulDlgにクラス化


　不具合修正
　　ShaderParamsダイアログのLowAddrスライダーの値としてHiAddrスライダーの値を渡していた記述ミスを修正

　　スキンメッシュモデルの位置を原点以外にした場合にピック出来なくなっていたのを修正
　　　非スキンメッシュについては既に解決済だった

　　LimitEulダイアログのY軸最大角度の値にX軸最大角度の値を渡していた記述ミスを修正


2024/08/08
　DispGroupウインドウをCDispGroupDlgにクラス化

　LaterTransparentウインドウをCLaterTransparentDlgにクラス化

　ShaderTypeウインドウをCShaderTypeDlgにクラス化
　　(ShaderTypeParamsウインドウについてはこれから)


2024/08/07
　BlendShapeウインドウをCBlendShapeDlgにクラス化

　LightsウインドウをCLightsDlgにクラス化


2024/08/06
　RigidWnd(剛体設定ウインドウ)をCRigidParamsDlgにクラス化

　DispAndLimitsウインドウをCDispLimitsDlgにクラス化

　BulletウインドウをCBulletDlgにクラス化

　ProjLODウインドウをCProjLodDlgにクラス化



2024/08/05
　カメラドリー履歴にカメラupvec情報を追加
　　昔の履歴のupvecはY軸として扱う
　　新しい履歴のupvecは数値としては編集せず(数値として直感的ではないため)に画面の状態を保存して復元する
　　つまり、GUIはそのままでカメラのupvecに対応

　ドキュメント更新
　　00_KnownIssue.docxの問題0012に解決済マーク追記


　カメラツイスト操作をカメラアニメに反映するように.
　　カメラツイストアニメ編集が可能に.
　　カメラ回転アイコン右ドラッグでカメラツイスト
　　ドラッグ量ｘブラシウェイトの分、カメラアニメをツイスト
　　カメラグラフモードになっていない場合にはインフォウインドウに情報出力



　ヒント
　　カメラのupvec編集はカメラ回転アイコンを右ドラッグ
　　カメラ回転アイコンを右ダブルクリックでupvecリセット




2024/08/04
　浮動小数に対してmin(), max()を呼び出していた部分を修正
　　曖昧警告が出ることがあった.
　　fmin(), fmax()を使うように修正.
　　AdditiveIK/AdditiveIKのファイルとAdditiveIKLib/CPP以下のファイルとAdditiveIKLib/IINCLUDE/OrgWindow.hに対して修正


2024/08/03
　カメラグラフモードにてAlwaysLockオンの状態でカレントモデルを変更した場合に
　　Lock情報が残っていてカメラ操作(虫眼鏡アイコンドラッグ)が効かなくなることがある不具合を修正
　　モデル変更時にLock情報を初期化(１回前の状態を保存している変数も初期化)

　カメラアイコンドラッグ時にカメラグラフモードになっていない場合に
　　グラフモードを変えるようにインフォウインドウに情報を出力

　カメラグラフモードをオンにした場合には
　　強制的にカメラアニメ(再生)スイッチもオンにするように修正



　ヒント
　　カレントモデル変更時にカメラターゲットウインドウのカメラ距離スライダーが最大値(20000)より振り切ってしまう場合
　　虫眼鏡アイコンドラッグが効かないことがあります
　　その場合には、カメラ距離スライダーを小さい値にすると操作可能になります



　お知らせ
　　1.0.0.29のVector様での公開は８月７日（水）夕予定
　　８月１４日（水）の更新はお休みです
　　1.0.0.30のVector様公開は８月２１日を目標にします




2024/08/03
　AdditiveIK 1.0.0.29 release
　　1.0.0.28からの変更点
　　　カメラアニメを編集可能な条件を変更
　　　　当初の仕様ではカメラアニメスイッチがカメラアニメ再生スイッチで
　　　　カメラグラフモードがカメラアニメ編集+再生スイッチだった
　　　　しかしグラフモードがボーンの場合に　カメラ履歴を選択しても　画面が変わらずに　
　　　　なぜか分からなくなるようなことを　作者としても何度も感じた
　　　　再生と編集のスイッチを厳密に運用するよりも　
　　　　直感操作に少し寄せた方が良いと判断して　編集可能条件を以下のように変更
　　　　
　　　　１，カメラ履歴セレクト、カメラコビーペーストボタン、OnceLockボタン、AlwaysLockチェックに対しては
　　　　　　カメラアニメスイッチオン　または　カメラグラフモードの場合に　カメラアニメを編集
　　　　２，カメラ回転スプライト、カメラパンスプライト、カメラドリースプライト、XYZスプライトのドラッグに対しては
　　　　　　カメラグラフモードの場合に　カメラアニメを編集
　　　　３，間違えた操作に対しては、アンドゥボタンで巻き戻し

　　　カメラアニメIK回転処理を修正
　　　　カメラをツイスト(upvecを編集)してからLock2Jointにチェックを入れた場合にもうまくいくように.

　　　カメラアニメのカメラ距離編集について修正
　　　　カメラを回転した後でカメラ距離を編集してもうまくいくように.

　　　カメラドリー履歴の復元についての変更と修正
　　　　カメラアニメスイッチがオンの場合にもグラフモードがカメラモードでない場合でも
　　　　カメラ履歴を選択すれば画面に反映されるように修正
　　　　

　　　Lock2Joint機能を拡張
　　　　OnceLockボタンとAlwaysLockチェックボックスの２種類サポート
　　　　両方ともカメラアニメスイッチがオンまたはカメラグラフモードの場合にカメラアニメに対しても作用

　　　　OnceLockボタン
　　　　　カメラアニメが無い場合
　　　　　　ボタンを押した直後に１回カメラを選択ジョイントに向ける処理を行う

　　　　　カメラアニメがある場合(カメラアニメスイッチがオンまたはカメラグラフモードの場合)
　　　　　　選択フレーム範囲のカメラアニメに反映
　　　　　　ウェイトブラシの比率分だけ選択ジョイントの方向にカメラを向ける
　　　　　　OnceLock時のジョイントの位置はapplyframeにおけるジョイントの位置


　　　　AlwaysLockチェックボックス
　　　　　カメラアニメが無い場合
　　　　　　チェックが付いている間、モーションプレビュー時にカメラを選択ジョイントへ向ける

　　　　　カメラアニメがある場合(カメラアニメスイッチがオンまたはカメラグラフモードの場合)
　　　　　　選択フレーム全体に渡ってウェイト1.0(100%)で選択ジョイントの向きを向く
　　　　　　ジョイントの位置はジョイントのモーションを反映
　　　　　　モデルを注視し続けるカメラアニメの作成が容易に.


　　　Documents\Troubleshooting/00_KnownIssue.docxを追加
　　　　既知の問題をドキュメント化

　　　Documents/TroubleShooting/0_AboutCameraAnim.docx修正
　　　　新機能について追記
　　　　一部仕様変更について追記


　　　ショートムービー
　　　　fbxカメラ基本編集機能の修正と確認
　　　　https://youtu.be/rb1UI_p5Acc


　RC2:
　　カメラアニメ編集可能条件を変更(上述)
　　0_AboutCameraAnim.docx修正
　RC3:
　　カメラアニメ編集機能をテストした際の動画リンクをREADME.mdのExplaining Movieの欄に追加
　　README.mdのスクリーンショット１枚交換





2024/08/01
　カメラ履歴選択をカメラアニメにペーストする機能のテストと修正
　　カメラの親ノードやカメラノードに初期の向きと位置が設定してある場合にペースト結果が正しくなかった不具合を修正
　　グラフモードがカメラモードになっていない場合にペーストされていなかったのを修正
　　グラフモードがカメラモードになっていない場合に違うフレームにペーストされることがあった不具合を修正


　Lock2Joint機能を拡張
　　OnceLockボタンとAlwaysLockチェックボックスの２種類サポート
　　両方ともカメラアニメがあればカメラアニメスイッチやグラフモードに関わらずカメラアニメに対しても作用

　　OnceLockボタンは押した直後だけ機能
　　　カメラアニメがある場合にはウェイトブラシの比率分だけ選択ジョイントの方向にカメラを向ける
　　　OnceLock時のジョイントの位置はapplyframeにおけるジョイントの位置

　　AlwaysLockボタンは押した直後にカメラアニメに作用し、その後はモーション再生時にジョイントを注視し続ける
　　　カメラアニメがある場合には選択フレーム全体に渡ってウェイト1.0(100%)で選択ジョイントの向きを向く
　　　AlwaysLockボタン時のジョイントの位置はフレーム選択範囲のジョイントのモーションを反映
　　　モデルを注視し続けるカメラアニメの作成が容易に.


　既知の問題0012
　　カメラ履歴にカメラのupvecを保存していないので、カメラ履歴を選択する直前のupvecによって履歴復元状態が少し変わってしまう
　　(カメラのツイスト回転が変化することがある)
　　スケジュール的に対応できるのはもう１つ次のバージョン(1.0.0.30)以降


2024/07/31
　カメラアニメを編集してからプロジェクトの保存読み込みテストして問題解決
　　読み書き読み書き読みテスト＋Mayaで読込テスト＋Unityで読み込みテスト
　　　保存読み込みをするとカメラの移動成分が変質することがあった
　　　原因部分はLock2Jointチェック時のRow(1)にupvecをセットする部分だった
　　　upvecセット部分をコメントアウトで　解決


　カメラアニメ回転処理時もLock2Jointと同じ計算順序に.



2024/07/30
　カメラアニメIK回転処理を修正
　　カメラをツイスト(upvecを編集)してからLock2Jointにチェックを入れた場合にもうまくいくように.

　カメラアニメのカメラ距離編集について修正
　　カメラを回転した後でカメラ距離を編集してもうまくいくように.

　Documents/TroubleShooting/0_AboutCameraAnim.docxの使用してのメモの記述を修正
　　
　ツイストしてからのLock2Jointの処理を更に改善
　　修正した計算順序でY軸をセットしただけで改善


2024/07/29
　カメラアニメとカメラ履歴の関係を変更
　　カメラアニメスイッチがオンの場合にカメラ履歴を操作した場合に履歴操作をカメラアニメに反映するように.
　　　カメラアニメスイッチがオンの場合に履歴選択に対する反応が無いのは分かり難かった.
　　　カメラ履歴操作をカメラアニメ編集にも使えるようにした.


2024/07/26
　AdditiveIK 1.0.0.28 release
　　1.0.0.27からの変更点
　　　GUIをみやすく(その２)
　　　　全右ペインウインドウをOWP(オルグウインドウパーツ)化
　　　　　今回新たにOWP化した右ペインウインドウは
　　　　　コピー履歴、カメラドリー履歴、LaterTransparent
　　　　　コピー履歴とドリー履歴ウインドウはページング方式からスクロール方式に変更
　　　　　
　　　　既存のOWPウインドウについても使用しているものは文字を大きくレイアウトし直し
　　　　　RigidParams(剛体設定)ウインドウ、Shader(シェーダ)ウインドウ、Skyウインドウ
　　　　　字を大きくしてスクロール方式に.

　　　　セレクト項目にオレンジアンダーライン
　　　　　ラジオボタンとリストボックスには選択項目に常にアンダーライン
　　　　　チェックボックスに対してはオプションでアンダーライン
　　　　　排他的チェックのためのGUIや選択を目立たせたい場合に使用
　　　　
　　　　ソフトキーを数字だけ入力用とアルファベット入力用の２種類に.
　　　　　エディットボックスをクリックで２種類の内の適切なソフトキーを表示

　　　　リストボックスクラス新規

　　　　ドロップダウンで出るメニューの高さの最大値を設定
　　　　　項目数が多い場合にも見苦しくならないように.



　　　　ポップアップウインドウのOWP化についてはこれから着手予定
　　　　　コピー情報入力ウインドウ(疑似モーダル)は済





2024/07/26
　モーションコピー情報入力ポップアップウインドウをOWPで作り直し
　　疑似モーダル
　　対称コピー、カメラコピーにも対応

　ドロップダウンリストの高さの最大値を指定
　　項目数が多い場合に長すぎるリストが格好悪かったので修正
　　最大400ピクセルに



2024/07/25
　OWP_EditBox, OWP_Label, OWP_CheckBoxAの文字列バッファ長を引数に.
　　OWP_EditBoxを使用して入出力する情報の中には(メモ欄など)、ファイル入出力時に文字数が決まっているものがあるので準備


　DollyHistoryDlg(カメラ履歴ウインドウ)をOWPで作り直し
	

2024/07/24
　GUI修正
　　CopyHistoryDlgの右ペインウインドウをOWPで作り直し
　　　文字を大きくみやすく.
　　　ページング方式をやめてスクロール方式に.

　　CopyHistoryDlgの調整
　　　MostRecentチェック時にはリスト選択不可に.
　　　ウインドウを作り直した後にコンボボックスの以前の選択状態を復元

　　OWP_Button, OWP_CheckBoxA, OWP_Labelの修正
　　　setActive(flag)で非アクティブにした場合にはグレー表示してマウスイベントを受け付けないように.


　　OWP_CheckBoxAの修正
　　　作成時にunderlineflag引数を追加.　チェック時にアンダーライン.
　　　チェックボックスをラジオボタンの様に使用する場合や選択を目立たせたい場合にunderlineflagをオンに.

　　HISTORYELEMの==演算子修正
　　　commentメンバ以外の全メンバを比較して判定

　　StrMiscのDrawGdiText()を修正
　　　アンダーラインが下にはみ出すと消えなくなることがあったのでアンダーラインをもう少し上に描画

　　ソフトキーの描画を修正
　　　押したときに反転表示されるように修正

　　コピー履歴ウインドウを開いた状態でモーションコピーをした場合に
　　　履歴の選択がずれていたのを修正

　　コピー履歴をスクロールしてチェック-->他の右ペインウインドウを表示-->再びコピー履歴表示としたときにも
　　　履歴の選択がずれないように。選択項目が画面内に入るように。



2024/07/21
　GUI修正
　　スクロールウインドウの子供ウインドウにマウスホイールが伝達していなかったのを修正
　　　具体的症状としてはスクロールウインドウの子供のセパレータの子供のスライダーがホイールに反応していいなかった

　　Shader(シェーダ)メニューの右ペインウインドウ調整
　　　文字を大きくしてスクロールウインドウ対応

　　Skyメニューの右ペインウインドウ調整
　　　文字を大きくしてスクロールウインドウ対応

　　OWP_SoftAlNumKeyクラスを追加
　　　メモ欄用エディットボックス対応準備
　　　ソフトキーでアルファベットも入力可能に.
　　　OWP_EditBox作成時にonlunumkeyflag引数をtrueにすると数字だけのソフトキー、falseにすると数字とアルファベットのソフトキーと関連付け.
　　　アルファベットのキーの並びはキーボードの配列順に.

　　
2024/07/20
　GUI修正
　　DrawGdiText()関数を追加
　　　オレンジ色アンダーラインフラグ付き

　　StrMisc.h, StrMisc.cpp追加

　　RigidParams(剛体設定)メニューの右ペインウインドウ調整
　　　文字を大きくしてスクロールウインドウ対応
　　

2024/07/16
　GUI修正
　　行選択時に行全体をオレンジにしていたのをオレンジのアンダーラインに変更

　　名前取得時のインデックスチェックを修正

　　リストの名前取得時にデータが無い場合にNoData文字列を返すように


2024/07/15
　OWP_ListBoxクラス新規

　LaterTransparentメニューのウインドウをOWPで作り直し


　OWP_ListBoxの修正
　　枠の縁取り描画追加
　　コンストラクタにサイズに関わる初期ライン数引数を追加
　　マウスホイール対応


2024/07/13
　AdditiveIK 1.0.0.27 release
　　1.0.0.26からの変更点
　　　プレートメニューから表示するウインドウをOWPに.
　　　　右ペインに表示するウインドウに黒い枠が付かないようにOWPで作り直し
　　　　
　　　　ソフトキー付きエディットボックス新規
　　　　　エディットボックスクリックでソフトキーを表示
　　　　　ソフトキーボタンには３セットのコピペボタンも配置
　　　　　大きな閉じるボタンも配置

　　　　カラーボックスクラス新規
　　
　　　　コンボボックスクラス新規
　　　　
　　　　スクロール付きの場合はなるべく大きく、
　　　　１画面にまとめる時にはそれなりの大きさで.

　　　　Applyボタンは大きな色付きボタンに.
　　　　
　　　　LaterTransparentとカメラ履歴とコピー履歴ウインドウについては
　　　　次バージョン以降で対応予定

　　　大きなfbx読み込み時には、DispGroupプレートメニューを押した直後に数秒待ち時間があるので砂時計カーソルを表示

　　　起動後プロジェクトを読み込んだ直後にはショートカット一覧が表示されているように.
　　　修正前はLightsメニューが選択されるようになっていた

　　　Morphグラフモード時にジョイントドラッグした場合
　　　Infoウインドウにグラフモードを変えないとジョイントをドラッグ出来ないメッセージを出力
　　　ドラッグしてマウスを動かしている間メッセージを出力


　　　不具合修正
　　　　右ペインにショートカット一覧が表示されている状態で
　　　　他のウインドウを表示しようとしても表示されないことがある不具合を修正
　　　　　ウインドウの閉じ忘れが原因だった

　　　　Retargetプレートメニューでリターゲットの対応表設定時に
　　　　ボーン構造の間にeNullノードが混ざっている場合に設定が出来ないことがある不具合を修正

　　RC2:
　　　モデルパネルのモデル名の表示がはみ出さないように.
　　　　文字を大きくしたので長いモデル名の表示がdeleteボタンと被る場合があった
　　　　21文字までしか表示しないようにすることではみ出しを回避
　　RC3:
　　　InfoWindowの修正
　　　　1.0.0.27へ向けた修正部分の不具合
　　　　インフォウインドウに多くの出力をしていると処理が固まるほど重くなる不具合を修正
　　　　出力項目の色を管理するデータサイズが異常に大きくなっていたのが原因だった　　　　
　　　　具体的な症状としては、リターゲットバッチを実行すると処理が終わらなくなっていた
　　RC4:
　　　Retargetウインドウ(convboneウインドウ)のモデル名表示長修正
　　　　表示がはみ出すことがあったので表示文字数を21文字以下に.




2024/07/12
　FogメニューのウインドウをOWPで作り直し

　DOFメニューのウインドウをOWPで作り直し


2024/07/11
　ProjAndLODメニューのウインドウをOWPで作り直し

　ShadowメニューのウインドウをOWPで作り直し

　LimitEulerメニューのウインドウをOWPで作り直し

　Q2EulThresholdメニューのウインドウをOWPで作り直し



2024/07/10
　InfoWindow(３Dウインドウとロングタイムラインの間に位置するウインドウ)に関する修正
　　出力文字色をINFO(white), WARNING(blue), ERROR(red)の３種類に

　BulletメニューのウインドウをOWPで作り直し


2024/07/09
　SoftNumKey修正
　　数字キー以外の画像に色を付けて識別しやすく

　起動後プロジェクトを読み込んだ直後にはショートカット一覧が表示されているように.
　　修正前はLightsメニューが選択されるようになっていた

　Morphグラフモード時にジョイントドラッグした場合
　　Infoウインドウにグラフモードを変えないとジョイントをドラッグ出来ないメッセージを出力
　　ドラッグしてマウスを動かしている間メッセージを出力


　不具合修正
　　ショートカット一覧ウインドウが多重表示されることがある不具合修正
　　　１段目メニューのウインドウを閉じる際にショートカット一覧ウインドウを閉じ忘れていた　　

　　CustomRigウインドウとカメラ履歴ウインドウが表示されないことがある不具合修正
　　　ショートカット一覧ウインドウが表示されている状態から、CustomRigウインドウやカメラ履歴ウインドウを表示しようとしても表示されなかった
　　　ショートカット一覧ウインドウの閉じ忘れが原因
　　　ver1.0.0.26からの不具合



2024/07/08
　OWPウインドウを増やす前に、既存のOWPウインドウの大きさを調整
　　スクロール付きウインドウのGUIは出来るだけ大きく
　　スクロール無しで収める場合には収まるような大きさで.

　07/08夜中の変更項目書き忘れ
　　不具合修正
　　　LightsウインドウのRotWithViewチェックボックスのオンオフ状態の設定ミスを修正
　　　フラグ設定時にEnableLightsスライダー(RotWithViewスライダーではなく)を参照していた

　SoftNumKeyに閉じるボタンを追加
　　ウインドウ右上の閉じるボタンは小さいので、数字キーの最後に閉じるボタンを追加

　OWP_EditBoxの背景色をやや青み掛かった白に変更(変更前は真っ白だった)

　LightsウインドウのApplyボタン修正
　　他のGUIとの間に空白行を挿入、サイズは更に大きく

　上部常駐チェックボックスのBrush UとBrush Vチェックボックスのサイズ調整


　SoftNumKeyの-ボタンを符号反転ボタン+/-に変更
　　ワンボタンでエディットボックスの＋－を反転入力

　SoftNumKeyにコピーペーストボタンを追加
　　３個のコピーボタン(cp1, cp2, cp3)と３個のペーストボタン(ps1, ps2, ps3)
　　コピー情報はSoftNumKeyに保持するので、エディットボックスをまたいで使用可能

　SoftNumKeyの閉じるボタンを一番下段の一番右に配置し直し

　SoftNumKeyに背景画像追加



2024/07/07
　OWP_EditBox, OWP_ColorBoxクラスを追加
　　OWP_EditBoxは数値の入力用にクリックするとソフトウェアキーボードを出します
　　　ソフトウェアキーボードは数字と.と-とBackSpaceとClearのボタンを持ちます
　　OWP_ColorBoxは色の選択用にクリックするとColorDialogを出します

　LightsプレートメニューのWin32ダイアログをOWPで作り直し

　OWPウインドウのリストの文字を大きく
　　OWPウインドウの中のリスト表示(パラメータではなくリスト)に関わるGUIのラベル文字を15ポイントから20ポイントへ変更
　　具体的には　ShaderTypeウインドウ、BlendShapeウインドウ、DispGroupウインドウ、Retargetウインドウ、モデルパネル、モーションパネル、カメラパネルについて修正

　LightsウインドウのApplyボタンを大きく赤で表示

　大きなfbx読み込み時には、DispGroupプレートメニューを押した直後に数秒待ち時間があるので砂時計カーソルを表示


　不具合修正
　　Retargetプレートメニューでリターゲットの対応表設定時に　ボーン構造の間にeNullノードが混ざっている場合に設定が出来ないことがある不具合を修正



2024/07/06
　OWP_ComboBoxAクラスを追加

　DispAndLimitsプレートメニューのWin32ダイアログをからOWPで作り直し




2024/07/04
　AdditiveIK 1.0.0.26 release
　　1.0.0.25からの変更点
　　　モーフ(BlendShape)アニメ編集もアンドゥリドゥ対象に.
　　　　アンドゥリドゥまとめ
　　　　　今回の修正でアンドゥリドゥの対象は以下のようになった
　　　　　　ボーンモーションIK, フレーム範囲設定, ウェイトブラシ設定, カメラアニメ編集, 
　　　　　　モーフアニメ編集, モデル切り替え, モーション切り替え
　　　　　OWPスライダー(黒背景に横線と〇つまみのスライダー)についてはスライダーを右ダブルクリックで100万回スライダー設定をアンドゥ可能

　　　視野外モデル処理を修正
　　　　視野外モデルに対してもグラフを表示.
　　　　視野外モデルに対してもIK操作を可能に.

　　　プレビュー時のオイラーグラフ表示を修正
　　　　プレビュー時にも全範囲を表示　速度はほぼ変わらず
　　　　オイラーグラフの表示を高速化した分で全範囲を表示

　　　BlendShapeウインドウのターゲット名をボタン化
　　　　スライダーを動かさないでもボタンを押してグラフを確認可能に.

　　　ドキュメント追加
　　　　Documents/TroubleShooting/0_AboutUndoRedo.docx

　　　不具合修正
　　　　１段目プレートメニュークリックに対する処理を修正
　　　　　１クリック目でオンオフ可能に.
　　　　　１段目のプレートメニューをクリックすると１段目の選択がすべて外れてもう一度クリックでオンに出来る状態だった
　　　　　今回の修正の副作用として
　　　　　　BlendShapeプレートメニューから他のメニューに移る場合に、自動的にはボーングラフに戻らずにモーフグラフのままとなる
　　　　　　IK操作をする場合には手動でタイムラインの赤いカエルをクリックしてBoneグラフに設定する必要がある

　　　　BlendShapeプレートメニューを選択-->フレーム範囲指定-->ブレンド率編集-->モーション切り替え-->ブレンド率編集としたときに
　　　　　フレーム選択は維持されるが編集結果がカレントフレームにしか適用されない不具合を修正
　　　　　モーション切り替え関数内でブラシを作成し直して解決

　　　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　　　上記ファイルの絵を修正
　　　　　赤いカエルによるグラフ切り替えの絵の中のコメントが間違っていたのを修正
　　　　
　　　　カメラが入っているモデルにおけるペースト処理の修正
　　　　　ペーストボタンを右クリックして操作対象ボーンからHipsを除外した場合の挙動が仕様と違ったので修正
　　　　　例えば　Testフォルダの0_VRoid202406_Cam004を読み込み、操作対象スロットとしてNoHipsを選択してペーストした場合
　　　　　　元のモーションのHipsの位置を起点にして、元の位置と繋がるようにしてHipsの動きもペーストされる(仕様)
　　　　　Hipsの動きを全くペーストしたくない場合には、操作対象ボーンダイアログのTranslationチェックを外してペーストする(仕様)
　　　　　今回の修正で上記仕様通りになった


　RC2:
　　オープンダイアログのTestフォルダ参照ボタンのリンク先が
　　1.0.0.25のTestフォルダになっていたのを1.0.0.26のTestフォルダに修正
　　
　　オープンダイアログの参照ボタンの文言を調整

　　ドキュメント追加
　　　Documents/TroubleShooting/0_AboutUndoRedo.docx

　RC3:
　　カメラが入っているモデルにおけるペースト処理の修正
　　　ペーストボタンを右クリックして操作対象ボーンからHipsを除外した場合の挙動が仕様と違ったので修正
　　　例えば　Testフォルダの0_VRoid202406_Cam004を読み込み、操作対象スロットとしてNoHipsを選択してペーストした場合
　　　　元のモーションのHipsの位置を起点にして、元の位置と繋がるようにしてHipsの動きもペーストされる(仕様)
　　　Hipsの動きを全くペーストしたくない場合には、操作対象ボーンダイアログのTranslationチェックを外してペーストする(仕様)
　　　今回の修正で上記仕様通りになった
　　　
　　ドキュメントに追記
　　　Documents/TroubleShooting/0_AboutUndoRedo.docx
　　　上記ファイルにUndoとRedoのショートカットキーについて追記





2024/07/02
　モーフ(BlendShape)アニメ編集もアンドゥリドゥ対象に.

　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　上記ファイルの絵を修正
　　赤いカエルによるグラフ切り替えの絵の中のコメントが間違っていたのを修正

　１段目プレートメニュークリックに対する処理を修正
　　１クリック目でオンオフ可能に.
　　１段目のプレートメニューをクリックすると１段目の選択がすべて外れてもう一度クリックでオンに出来る状態だった

　

2024/07/01
　視野外のモデルに対してもIK操作可能に.
　　視野外モデルに対しても裏で何かしらのIK処理をする可能性はある
　　そのようなことをする際に視野外IKスキップ機能が謎バグになるような嫌な予感がした
　　1.0.0.25で視野外モデルのオイラーグラフを表示するようにしたことも考慮し、覚えているうちに対応


2024/06/30
　オイラーグラフのラインを一括描画、プレビュー中も全範囲表示
　　LineTo()を複数回呼び出す方法をやめて、Polyline()関数で一括描画することにより表示高速化
　　プレビュー時にも全範囲表示しても、以前の省略描画速度と同じくらいの描画速度に

　BlendShapeウインドウのターゲット名をボタン化
　　ターゲット名のボタンを押すとそのターゲットのブレンド率グラフを表示
　　モデル切り替え時、モーション切り替え時、BlendShapeウインドウ表示時にもセレクトイベント

　不具合修正
　　BlendShapeプレートメニューを選択-->フレーム範囲指定-->ブレンド率編集-->モーション切り替え-->ブレンド率編集としたときに
　　フレーム選択は維持されるが編集結果がカレントフレームにしか適用されない不具合を修正(IKは問題無かった)
　　モーション切り替え関数内でブラシを作成し直して解決




2024/06/28
　AdditiveIK 1.0.0.25 release
　　1.0.0.24からの変更点
　　　アンドゥリドゥをより便利に.
　　　　モデルセレクト、モーションセレクト、カメラセレクト、カメラアニメ編集についてもアンドゥリドゥ対象に.
　　　　モーフのアンドゥについては次回以降に.

　　　カメラアニメ専用のコピペスプライトボタン追加
　　　　コマンドショートカットボタンを２段にして１段目をカメラアニメ専用のボタンに.
　　　　カメラパネルで選択中のアニメに対して　コピー、ペースト、補間、初期化、平滑化コマンドボタンが機能
　　　　今まではモーションパネルでカメラアニメを選択してのコピペだったので人物が画面に入らない状態での操作になることが多かった
　　　　これからは、モーションパネルでどのアニメを選んでいてもカメラアパネルで選択中のアニメに操作を行うことが出来るので人物の動きをみながら操作可能

　　　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　　　上記ファイルに追記


　　　スプライトボタンを押したときの反転表示時間をfpsをみて決めるように.

　　　ShaderParamsダイアログのEmissiveスライダーの最大値を1.0から10.0に変更
　　　　
　　　選択中のモデルが視野外の場合にもオイラーグラフを表示するように.

　　　モーション切り替え時、モデル切り替え時、グラフ切り替え時にタイムラインの選択を引き継ぐように.
　　　　モーション長でクランプしつつ引き継ぐ

　　　README.mdに記述しているUnity3Dのバージョンを更新

　　　不具合修正
　　　　リターゲットの際にソースとデスティネーション両方を視野内に入れて実行しないと結果が正しくない不具合を修正
　　　　　使用方法的にコンテクストセーフのはずなのだが、念のためにモーションポイント取得時の再入問題に対してはCRITICALSECTIONで対策
　　
　　　　as grassにチェックを入れてfbxを読み込み後に、grass以外のモデルを削除した場合にメモリリークしていた不具合を修正
　　　　　モデル削除処理中の草配列の修正ミス

　　　　草と草でないモデルを読み込み後、草ではないモデルを削除すると草の表示が消える不具合を修正
　　　　　モデル削除処理中の草配列の修正ミス

　　　　読み込み直後に草モデルが選択されている場合にModel'sPosAndDirでクリックによる草の配置と削除が出来ない不具合を修正
　　　　　草が選択されている間はマニピュレータは表示されない
　　　　　１度も表示されないマニピュレータとの当たり判定で当りが返ってきていたために草の配置関数が呼ばれなかった
　　　　　草の選択中にはマニピュレータとの当たり判定としてはずれを返すようにして解決

　　RC2:
　　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　　上記ファイルに絵を追加
　　　ScreenShotsフォルダにスクリーンショット画像追加
　　　README.mdに記述しているUnity3Dのバージョンを更新
　　RC3:
　　　コピーヒストリーウインドウが右ペインに出ない不具合修正
　　　コマンド対象ボーンダイアログが出ない不具合を修正
　　　　OnModelMenu()をOnChangeModel()から呼び出すようにした際にforceflagの設定をミスしていたのが原因で
　　　　いくつかのウインドウが作成されていない状態だった
　　RC4:
　　　カメラが含まれていないモデルを読み込むとエラーで落ちる不具合を修正
　　　　アンドゥ処理修正時の不具合だった
　　RC5:
　　　s_tlarray(カレントモデルのタイムライン情報)の操作に関する不具合を修正
　　　　症状
　　　　　1.0.0.25RC4での不具合症状としては、リターゲット"バッチ"実行後にモーションパネルで削除しようとしたモーションと削除されるモーションがずれていた
　　　　原因
　　　　　操作前のタイムライン情報が適切でなかった
　　　　対策
　　　　　ファイル読み込み直後と　AddMotion()から呼ばれるAddTimeline()でのみ　s_tlarrayにpush_backしてs_chasceneに保存.
　　　　　AddMotion()での処理時には、s_chasceneから対象モデルのtlarrayを取得してから操作するように.
　　　　　ファイル読み込み前におまじないのようにs_tlarrayをs_chasceneに保存していた部分を削除.
　　RC6:
　　　"GUIからの"リターゲットがエラーで落ちる不具合を修正
　　　　RC5からの不具合
　　　　カレントモデル切り替え関数呼び出しにより　リターゲット設定が初期化されたことによるエラー
　　　　エラーで落ちないようにした後で　冗長な追加コードをコメントアウト
　　RC7:
　　　複数のカメラアニメがある場合に、カメラの補間ボタン、初期化ボタン、スムースボタンが効かない不具合を修正
　　　　複数のカメラアニメを持つfbxは各カメラ用のノードを持つ　それぞれのカメラ用ノードは自身のアニメのモーションポイントしか持っていない
　　　　カメラ用ノードにモーションポイントが無い場合にもエラーリターンしないで処理を続ける必要があった


　ショートムービー
　　屋根の上に飛べますか？
　　https://youtu.be/YLJxziIqBsQ










2024/06/26
　モデルセレクト、モーションセレクト、カメラセレクトについてもアンドゥリドゥ対象に.
　　大体うまくいっている
　　テストしたところ、ロールバックされた直後のアンドゥ番号が扱いにくい場合があった
　　連続してモデルを切り替えて連続してUndo、Redoする場合に上記アンドゥ番号について？？？となることがあった
　　詳しい検証はまだ
　　ちなみに画面左上のR数字はアンドゥ読み込みポイントでW数字はアンドゥ書き込みポイントであり、両方ともモデルごとの番号




2024/06/25
　選択中のモデルが視野外の場合にもオイラーグラフを表示するように.


2024/06/24
　カメラアニメ専用コマンドボタンにもマウスを当てたときにツールチップを表示

　カメラアニメ補間ボタンを押したときのコンテクストメニュー表示をスキップ

　カメラアニメ初期化ボタンを押したときにはコンテクストメニューの対応機能以外をグレーアウト


　カメラアニメ編集(XYZドラッグ、各コマンドボタン操作含む)のアンドゥリドゥ対応
　　選択中のモデルにボーンモーションとカメラアニメの両方のアンドゥデータを保存する方式に変更
　　復元時にも選択中のモデルのアンドゥデータを参照して復元
　　ボーンモーションとカメラアニメの内片方だけある場合にも機能

　　大体うまくいったところでコミット
　　　今後、モデルセレクト変更、モーションセレクト変更、カメラアニメセレクト変更についてもアンドゥ対象にする "予定"


2024/06/23
　モーション切り替え時、モデル切り替え時、グラフ切り替え時にタイムラインの選択を引き継ぐように.
　　モーション長でクランプしつつ引き継ぐ


　カメラアニメ専用のコピペスプライトボタン追加
　　コマンドショートカットボタンを２段にして１段目をカメラアニメ専用のボタンに.
　　カメラパネルで選択中のアニメに対して　コピー、ペースト、補間、初期化、平滑化コマンドボタンが機能
　　今まではモーションパネルでカメラアニメを選択してのコピペだったので人物が画面に入らない状態での操作になることが多かった
　　これからは、モーションパネルでどのアニメを選んでいてもカメラアパネルで選択中のアニメに操作を行うことが出来るので人物の動きをみながら操作可能

　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　上記ファイルに追記


　スプライトボタンを押したときの反転表示時間をfpsをみて決めるように.

　ShaderParamsダイアログのEmissiveスライダーの最大値を1.0から10.0に変更


2024/06/22
　不具合修正
　　リターゲットの際にソースとデスティネーション両方を視野内に入れて実行しないと結果が正しくない不具合を修正
　　　修正前のver1.0.0.24においてもsrcとdstの両方を視野内に入れてマルチスレッドリターゲットしたところ正常だったことに着目
　　　リターゲットのsrcとdstの "両方に" 強制的に視野内フラグをつけたところマルチスレッドでも問題は出なかった
　　　視野外の場合にいくつかの計算がスキップされることが原因だった

　　　使用方法的にコンテクストセーフのはずなのだが、念のためにモーションポイント取得時の再入問題に対してはCRITICALSECTIONで対策
　　
　　as grassにチェックを入れてfbxを読み込み後に、grass以外のモデルを削除した場合にメモリリークしていた不具合を修正
　　　モデル削除処理中の草配列の修正ミス
　　草と草でないモデルを読み込み後、草ではないモデルを削除すると草の表示が消える不具合を修正
　　　モデル削除処理中の草配列の修正ミス

　　読み込み直後に草モデルが選択されている場合にModel'sPosAndDirでクリックによる草の配置と削除が出来ない不具合を修正
　　　草が選択されている間はマニピュレータは表示されない
　　　１度も表示されないマニピュレータとの当たり判定で当りが返ってきていたために草の配置関数が呼ばれなかった
　　　草の選択中にはマニピュレータとの当たり判定としてはずれを返すようにして解決


2024/06/21
　ショートムービー
　　屋根の上に飛べますか？(1.0.0.24)
　　https://youtu.be/YLJxziIqBsQ




2024/06/20
　AdditiveIK 1.0.0.24 release
　　1.0.0.23からの変更点
　　　既知の問題0010に対する根本的対応
　　　　fbxファイルのEmissionTexture(EmissiveTexture)の読み書き表示に対応
　　　　fbxのリビジョン番号アップ

　　　パフォーマンス改善
　　　　メッシュの個数が多いfbx読み込み時にDispAndLimitsメニューのRigid(剛体)表示にチェックを入れていると
　　　　極端に表示が遅くなりオフにしたときの半分くらいの表示速度になっていたのを修正
　　　　
　　　スプライトボタンを押したときに反転色表示

　　　BlendShape出力時の名前は名前の中の最後の'.'以降の文字列を出力するように
　　　　BlendShape出力時にBlendShapeをコピーすると文字列が付加されて元の名前が変わってしまう
　　　　BlendShapeの名前に'.'を使わないことを前提に'.'以降を書き出して名前が変わらないように
　　　　fbxファイルのリビジョン番号アップ

　　　グラフモードをMorphにしている間はタイムラインのフレームを移動した際にブレンド率スライダーを更新
　　　　毎フレーム更新すると重いのでフレームが変わった場合に更新


　　　不具合修正
　　　　AdditiveIKでモデルのワールド座標を設定した後でPick&Setすると位置がずれる
　　　　　非スキンメッシュのマウスとの当たり判定関数がメッシュのローカル座標系での座標を返していた
　　　　　当たり判定後にグローバル座標系に直してから返すことに
　　　　　直る前の具体的な症状としては、地面を移動させてから地面に草を配置しようとすると草の位置がずれていた

　　　　カメラ編集結果がUndo出来ないことがある不具合を修正
　　　　　カメラ移動編集などがUndo対象になっていなかった


　　　　プレイヤーボタンのToTheLastボタン([| |]ボタン)がカメラアニメに対して効かないことがある不具合を修正

　　　　プロジェクト保存後とfbxファイル保存後に、アプリの各パネルの選択状態がずれないように
　　　　　直す前は、表示中のモーションとGUIで選択しているモーションが異なることがあった

　　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　　上記ファイルに追記


　　　Testフォルダのモデルをアップデート
　　　　EmissiveTexture対応版モデルとして0_VRoid202406_Cam004


　　RC2:
　　　初期化コードの修正し残していた箇所を修正



　ショートムービー
　　空の色は何色ですか？
　　https://youtu.be/0LkwVw9eubg








2024/06/17
　パフォーマンス改善
　　メッシュの個数が多いfbx読み込み時にDispAndLimitsメニューのRigid(剛体)表示にチェックを入れていると
　　極端に表示が遅くなりオフにしたときの半分くらいの表示速度になっていた
　　ChaVector2, ChaVector3, ChaVector4の初期化方法を変更
　　不要な初期化をコメントアウト
　　変更後もRigid表示オンで多少表示は遅くなるがかなり改善
　　Rigid表示オフ同士で比べた場合にも少し高速化

　プレイヤーボタンのToTheLastボタン([| |]ボタン)がカメラアニメに対して効かないことがある不具合を修正

　プロジェクト保存後とfbxファイル保存後に、アプリの各パネルの選択状態がずれないように
　　直す前は、表示中のモーションとGUIで選択しているモーションが異なることがあった


　(備忘録)
　　ChaVector3 scale;
　　scale = ChaVector3(1.0f, 1.0f, 1.0f);
　　上記のような初期化コードを構造体内に書き、各メッシュに構造体の配列を配置、全メッシュに対して初期化を実行すると
　　シーンによっては総負荷の50%近くが初期化に費やされた(アロケートしていた？)
　　scale.SetParams(1.0f, 1.0f, 1.0f);とすることで改善された
　　どこかでみてから問題コードが癖になっていたのだが、今回の修正で全箇所修正した
　　以後気を付ける　　



2024/06/16
　BlendShapes出力時の名前は名前の中の最後の'.'以降の文字列を出力するように
　　BlendShape出力時にBlendShapeをコピーすると文字列が付加されて元の名前が変わってしまう
　　BlendShapeの名前に'.'を使わないことを前提に'.'以降を書き出して名前が変わらないように
　　fbxファイルのリビジョン番号アップ

　　Test/0_VRoid202406_Cam004モデルを読み込んで保存し直したものに更新


　グラフモードをMorphにしている間はタイムラインのフレームを移動した際にブレンド率スライダーを更新
　　毎フレーム更新すると重いのでフレームが変わった場合に更新


　不具合修正
　　AdditiveIKでモデルのワールド座標を設定した後でPick&Setすると位置がずれる
　　　非スキンメッシュのマウスとの当たり判定関数がメッシュのローカル座標系での座標を返していた
　　　当たり判定後にグローバル座標系に直してから返すことに
　　　直る前の具体的な症状としては、地面を移動させてから地面に草を配置しようとすると草の位置がずれていた

　　カメラ編集結果がUndo出来ないことがある不具合を修正
　　　カメラ移動編集などがUndo対象になっていなかった




2024/06/15
　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　上記ファイルにカメラ編集機能を使ってみてのメモを追記
　

2024/06/14
　既知の問題0010に対する根本的対応
　　fbxファイルのEmissionTexture(EmissiveTexture)の読み書き表示に対応
　　fbxのリビジョン番号アップ


　Testフォルダのモデルをアップデート
　　EmissiveTexture対応版モデルとして0_VRoid202406_Cam004


　大きいfbx読み込み時にCreateIndexedMoiontPointReqの再帰処理がスタックオーバーフローしたので
　再帰処理を使わずにCreateIndexedMoiontPoint()するように修正


2024/06/13

　既知の問題0010について続報
　　

　　########
　　# 問題0010　対応予定有　VRoid最新版で問題解消
　　########
　　　症状
　　　　AdditiveIKにVRoid(fbx)を読み込み保存してUnity3Dに持っていくと
　　　　モデルが真っ白に表示される
　　　(中略)
　　　2024/06/13状況
　　　　pixiv様よりVRoidStudio1.28.2がリリースされました
　　　　まだ１つのモデルでしか確認していませんが
　　　　VRoid1.28.2とUniVRM0.122.0とUnityにより
　　　　出力したfbxにおいては
　　　　Emissionが黒い場合には？Emissionの係数が
　　　　黒として出力されるようになったようです
　　　　AdditiveIKとしての対応はこれからですが
　　　　今のところ、新しいVRoidStudioのfbxでは
　　　　問題0010は生じません




2024/06/11
　AdditiveIK 1.0.0.23 release
　　1.0.0.22からの変更点
　　　カメラアニメ編集機能

　　　　Documents/TroubleShooting/0_AboutCameraAnim.docx
　　　　　上記ファイルにカメラ編集機能について記述

　　　　対応機能
　　　　　回転、パン、ドリー、XYZ各軸の回転とパン
　　　　　コピーペースト
　　　　　補間
　　　　　スムージング
　　　　　アニメのフレーム長変更
　　　　　アンドゥリドゥ
　　　　　fbx入出力
　　　　fbxに記述されている既存のカメラアニメを編集可能(新規作成機能はまだありません)
　　　　
　　　fbxファイル書き出し時のリビジョン番号アップ

　　　Testフォルダにカメラアニメ付きモデル

　　　BlendShape(モーフ)ウインドウの項目名の表示文字数制限
　　　　メッシュ名12文字まで表示　ターゲット名は最後の . より後ろを表示
　　　　名前が長すぎるとラベル表示がスライダーの表示に被るので対策

　　　右ペイン上部のカメラターゲットウインドウのスライダーの幅を長く

　　　不具合修正
　　　　プロパティボタンでモーション名を変更する際に対象が１つずれていた
　　　　　インデックスとモーション番号の違いによる間違い
　　　　コピーペーストで選択フレーム範囲の最初のフレームにペーストが行われないことがある不具合を修正
　


　使い方ショートムービー
　　モーキャプ編集+fbxカメラ編集
　　https://youtu.be/_G4wev5w-4g



　
　RC2:
　　Documents/TroubleShooting/0_AboutCameraAnim.docxに絵を追加して説明文を修正
　　コピーペーストで選択フレーム範囲の最初のフレームにペーストが行われないことがある不具合を修正
　　BlendShapeプレートメニュー選択時にグラフはBlendShapeになっているがカエルボタンの横の文字がMorphになっていない不具合修正
　　BlendShapeプレートメニュー選択時に右ペイン表示がちらつく不具合修正
　　　状態カウンター設定の不具合によりBlendShapeウインドウの作成と破棄を繰り返していたのが原因
　　　1.0.0.23準備中に生じた不具合

　RC3:
　　BlendShapeプレートメニュー選択時に表示速度が極端に遅くなる不具合を修正
　　　ブレンド率操作をしたときだけスライダーを更新するように修正して解決
　　カメラモーション長を変更するとモデル表示が消える不具合を修正
　　　モーションパネルでカメラモーションをセレクト-->プロパティボタンでモーション長を短く-->プロパティボタンでモーション長を長く-->モデルの表示が消えるという症状
　　　カメラモーションにはボーンモーションを出力しないので、プレビュー時の計算で初期姿勢を返すように修正して解決
　　モーションパネルでカメラモーションセレクト-->カメラグラフ-->Lock2Jointで真っ黒表示になる不具合を修正
　　　Lock2Jointの処理時にモデルのジョイント位置を参照する　その際にモーションポイントが存在しないエラーになる
　　　モーションパネルでカメラモーションセレクト時には、Lock2Jointをオンにしようとしたときにダイアログを出して処理をキャンセルするようにして解決
　　カメラアニメが入っていないfbxやプロジェクトを読み込むと読み込み直後からPrepairUndo処理が走り続ける不具合を修正
　　　カメラアニメスイッチの状態をみてからカメラスイッチをオフにすることで解決
　　使い方ショートムービー作成追加
　
　RC4:
　　各モーションの先頭モーションポイントの管理方法を修正
　　　std::mapをstd::vectorのようにkeyとsizeに関連を持たせて使用していたのをやめて、普通にmapとして使用
　　非カメラモーションにとって関係するボーンとカメラモーションにとって関係するボーンを判定数する関数を追加して整理
　　上記２つの修正により、複数カメラアニメが設定してあるのfbxの読み込みと書き込みがうまくいくように.
　　fbxファイルのリビジョン番号アップ




　既知の問題007
　　ボーン数が多すぎるアセットを読み込むと、オブジェクトがカメラの近くにあっても表示が消えることがある問題
　　シェーダ定数の上限数を含むスペック表を入手できていない状態
　　ボーン数の上限は決めていて１つのfbxに対して1000個にしているのだが、それ以下で使用してもビデオカード(あるいはシェーダバージョン)のスペックを越えると？表示されなくなるようだ
　　対応策：
　　　大きいアセットを読み込んで表示が消える場合には、fbxのボーン入りのモデルを減らすなどしてからAdditiveIKに読み込む


　既知の問題008
　　症状
　　　保存読み込みを繰り返すとモーション長が段々短くなることがある
　　原因
　　　fbx入出力時に30fpsを想定している
　　　時間に対して30で割って整数にして30を掛ける　を繰り返すことによる丸め誤差
　　対策
　　　長いモーションについてはモーション長を30の倍数にする

　既知の問題009　解決済
　　BlendShapeプレートメニュー選択時に描画速度が極端に遅くなる不具合
　　　解決済


　既知の問題010
　　症状
　　　AdditiveIKにVRoid(fbx)を読み込み保存してUnity3Dに持っていくとモデルが真っ白に表示される
　　原因
　　　AdditiveIKがEmissionTextureに未対応なので、黒いはずのEmissionが白いEmissionとして表示されてしまう
　　対策
　　　UnityでマテリアルのEmissionTextureとしてVRoidのShader_NoneBlack.pngなどを設定し直す
　　　またはEmissionのチェックをオフにする
　　対応予定
　　　AdditiveIKとしての対応予定は有り






2024/06/09
　カメラアニメ編集機能の続き
　　カメラモーションに対しても通常モーションに対するコマンド処理を可能に.
　　　コマンドショートカットボタン(上段カエルボタンの横)をカメラアニメに対して使用する場合には、カメラアニメをモーションパネル(カメラパネルではなく)で選択してからボタンを押す
　　　コピーペースト対応
　　　　ペースト時にペーストボタンを右クリックしてダイアログを出し、ダイアログのPasteCameraにチェックを入れてOKボタンで機能
　　　プロパティボタン
　　　　カメラアニメの長さ、名前を変更可能
　　　補間ボタン
　　　　ブラシを選択しピーク位置を決めてから補間ボタンでカメラも補間
　　　スムージング
　　　　カメラ回転のスムージングに対応
　　　　スムージング時にはカメラ注視点を中心に回転
　　　fbxファイル書き出し時のリビジョン番号アップ
　　　　eCameraノードの回転アニメ出力を修正(カメラのアニメはeCameraノードの親のeNullノードにアタッチしてあることを想定)
　　　　カメラアニメ書き出し時にはモーフアニメとボーンアニメを書き出さないように.
　　　　カメラアニメ読み込み時にもモーフアニメとボーンアニメは読み込まれないのでそれらのモーションポイントは作成されない
　　　　カメラアニメに対してはボーンIK操作は出来ないように.
　　　
　Testフォルダにカメラアニメ付きモデル

　ドキュメントに追記
　　Documents/TroubleShooting/0_AboutCameraAnim.docxにカメラ編集機能について追記　　　


　不具合修正
　　プロパティボタンでモーション名を変更する際に対象が１つずれていた
　　　インデックスとモーション番号の違いによる間違い
　　
　　RefPosとモデル切り替えに関わる不具合を修正
　　　人型(草ではない)モデルを選択-->RefPosオン-->草モデルを選択 を実行すると人型モデルの表示が消える不具合修正
　　　RefPosは選択中モデルに対して機能する
　　　モデル切り替え時にRefPosフラグのリセットが出来ていなかったのが原因


　BlendShape(モーフ)ウインドウの項目名の表示文字数制限
　　メッシュ名12文字まで表示　ターゲット名は最後の . より後ろを表示
　　名前が長すぎるとラベル表示がスライダーの表示に被るので対策





2024/06/07
　カメラアニメ編集機能の続き
　　カメラアニメスプライトオンのときにLock2Jointにチェックを入れた場合の挙動を修正
　　　カメラアニメオンの場合にもカメラを選択ジョイントに向けるように.
　　　カメラアニメオンの場合には、Lock2Jointのチェックをオフからオンに変えたときに処理を行う
　　アンドゥ不具合修正
　　　赤いカエルでグラフモードを変えた場合にフレーム選択範囲の表示がずれる不具合修正
　　　　初期化と復元設定の間に１周ループをまわすことにより不具合解消
　　　アンドゥリドゥ時に選択ジョイントが復元されずにモデルの最初のジョイントに選択が移る不具合修正
　　　アンドゥ中にアンドゥ用の保存処理が行われてアンドゥバッファの最後にジャンプしてしまい元に戻れないことがある不具合を修正
　　カメラターゲットウインドウパラメータ、モーションID、カメラモーションID、カメラオンオフスイッチ状態、グラフモードもアンドゥリドゥ対象に.
　　カメラアニメが無いfbx読み込み時、グラフをカメラモードにして物理シミュプレイボタンを押すと姿勢が変化しない不具合を修正
　　
　右ペイン上部のカメラターゲットウインドウのスライダーの幅を長く

　

　### 予定 ###
　　Testフォルダのモデルにカメラアニメを設定
　　カメラアニメ編集操作に関するメモをドキュメント化
　　カメラアニメ編集操作のショートムービー作成
　　テスト＆不具合修正



2024/06/05
　カメラアニメ編集機能の続き
　　移動モード、拡大モード時のX,Y,Zスプライトドラッグに対応
　　カメラ用の回転、移動、ドリースプライトにも対応

　　(ヒント)カメラの移動量はアプリ上部常駐スライダーのEditRateで調整
　　　大きいシーン読み込み時にはカメラの移動量が小さすぎて機能していないかのように思えることがある

　　(ヒント)
　　　３Dウインドウのカメラアニメオンオフスプライトはプレビューに影響
　　　グラフの赤いカエルでCameraモードするとカメラ操作は既存のカメラアニメに反映される
　　　現在のところ、カメラアニメの新規作成機能は付いていないのでUnityでfbxにカメラアニメを設定したものを読み込んで編集する
　　

　　カメラアニメ編集のアンドゥリドゥ





2024/06/04
　カメラアニメ編集機能
　　既存のカメラアニメの編集に対応開始
　　グラフの赤いカエルを押してEditTargetをCameraにセットしフレーム範囲を選択し、回転モードでX,Y,Zスプライトをドラッグでカメラアニメを編集
　　右ペイン上部のLock2Selをチェックしてボーンをマウスで選択してから回転すると、選択ジョイントを中心にカメラが回転
　　右ペイン上部のDispTargetをチェックしてその横のスライダーでカメラ距離を設定してから回転すると、ターゲット位置を中心にカメラが回転
　　編集したカメラアニメはプロジェクト保存時にfbxに保存



　予定
　　移動モード、拡大モードに対応
　　カメラ用の回転、移動、ドリースプライトにも対応
　　右ペイン上部のカメラターゲット操作GUIを３Dウインドウの上部もしくは下部に移動し、カメラ距離スライダーの長さを長くする
　　カメラアニメ編集のアンドゥリドゥ




2024/06/03
　不具合修正
　　通常のボーンモーションの再生と編集が出来なくなっていたのを修正
　　　カメラアニメの修正中の不具合
　　　モーションの最初のフレームのキーを登録する部分の不具合だった
　　モーションがループするべき場合にループしていなかった不具合を修正
　　　ループフラグを参照せずに０セットしている箇所があった


　カメラアニメ編集機能追加に向けて準備の続き
　　ロングタイムラインに赤いカエルボタン追加
　　　ロングタイムラインのカエルボタンを押すたびに編集ターゲットがBone, Camera, Morphの順で切り替わる
　　　ロングタイムラインの内容を編集ターゲットに合わせて表示

　カメラグラフ表示時の姿勢計算修正
　　移動モード、スケールモード時のカメラグラフの数値修正
　　回転モードはそのまま



　予定
　　カメラアニメ編集機能





2024/06/02
　カメラアニメ編集機能追加に向けて準備
　　カメラアニメを自前データに読み込み
　　カメラアニメ再生時に自前データを参照
　　カメラアニメ書き出し時に自前データを参照して書き出し
　　

　　fbxにカメラはあるがカメラアニメが無い場合のカメラ初期位置がZeroPosになっていたのを修正
　　　カメラの姿勢はカメラアニメにだけ出力するようにして解決

　　カメラアニメ再生時のフレーム補間
　　　スピードスライダー1.0(倍速)未満の場合のプレビューも滑らかに

　　fbxファイルのリビジョン番号アップ
　　　前々回と前回のコミット時に変えるべきだったのだが、カメラアニメ出力が変わったのでリビジョン番号更新

　　カメラパネルで選択中のカメラアニメの最大フレームをカメラアニメの最大フレームとして設定
　　　変更前は、選択中のボーンモーションの最大フレーム数がカメラの最大フレーム数になっていた.
　　　ただし、タイムラインを範囲を選択してループ再生している場合にはボーンモーションと同時に選択範囲の最初のフレームへループする



2024/05/29
　MODELBOUND構造体にIsValid()追加
　　未設定バウンダリーのAddによる潜在的不具合対策

　不具合修正
　　RefPosとモデル切り替えに関わる不具合を修正
　　　人型(草ではない)モデルを選択-->RefPosオン-->草モデルを選択 を実行すると人型モデルの表示が消える不具合修正
　　　RefPosは選択中モデルに対して機能する
　　　モデル切り替え時にRefPosフラグのリセットが出来ていなかったのが原因
　
　BlendShapeプレートメニューの右ペインウインドウのラベル修正
　　ターゲット名だけだったのを "メッシュ名:ターゲット名" に変更
　　fbx入出力は変更なし



2024/05/28
　ショートムービー
　　あ、来た、こっちこっち
　　https://youtu.be/vQkHzFg4SjU



2024/05/26
　AdditiveIK 1.0.0.22 release
　　1.0.0.21からの変更点
　　　BlendShapeアニメ(モーフアニメ)対応
　　　　BlendShapeプレートメニューで右ペインに設定ウインドウ
　　　　モーフアニメの保存読み込みはfbxファイルにて行う
　　　　BlendShapeメニュー時にモーフターゲットのスライダーを操作するとオイラーグラフにブレンド率表示
　　　　ブラシによる複数フレーム編集対応
　　　　モーフアニメのAdditiveModeチェックボックスはまだ機能しない.
　　　　モーフアニメの新規は可能だが、形状の登録などには未対応、
　　　　あらかじめBlendShapeのベースとターゲットが設定されているfbxにだけ対応
　　　　(注意)
　　　　　昔のAdditiveIKで保存したfbxにはBlendShape情報が入っていません。
　　　　　VRoidをUnityでfbx出力したものにはBlendShape情報が入っています。
　　　　　VRoidをUnityでfbx出力したものを読み込むとモーフアニメ機能を使用できます。
　　　　　今回のバージョンから保存時にBlendShape情報も保存します。
　　　　　すでに編集済のモーションに関しましては
　　　　　編集済モーションをUnityで出力したfbxにRetargetプレートメニューによりリターゲットすれば引き続き使用できます。

　　　Testフォルダのモデル更新
　　　　1009_5フォルダのモデルをBlendShape設定済のVRoidに

　　　不具合修正
　　　　Model'sPosAndDirショートカットボタンで出るダイアログのApplyボタンが入力位置に対して効かなくなっていたのを修正
　
　　　　セパレータのサイズ計算を修正
　　　　　スクロールウインドウと組み合わせて使用時にコントロールのクリックが出来ないことがあった
　　　　　セパレータ縦分割時の不具合だった

　　　　Shaderプレートメニューのウインドウをスクロールした下の方のボタンを押せないことがあった不具合を修正

　　　　草の表示の不具合修正
　　　　　草のRefPos、草のボーンマーク、草のマニピュレータを表示しようとして潜在的エラーが生じていたのを修正
　　　　　草のLODについては応急処置としてLOD0だけを表示
　　　


　　RC2:
　　　BlendShapeメニューのウインドウのレイアウトを修正
　　　　上部に選択モデル名とモーフ距離スライダーを配置し、下部だけスクロール対象に.
　　　モーフ距離 x プロジェクションのfarよりもモデルがカメラの近くにある場合だけモーフ計算
　　　複数モデルを読み込んでいる場合のモデル切り替え時にBlendShapeウインドウの内容も切り替え
　　　OWP_SeparatorのautoResizeを修正
　　　Model'sPosAndDirショートカットボタンで出るダイアログのApplyボタンが入力位置に対して効かなくなっていたのを修正
　　
　　RC3:
　　　RC2にてスライダーとラベルの高さを合わせるために、OrgWindow名前空間のテキストの高さを15から20に変更していた
　　　方々でGUIの見切れが発生したのでテキストの高さの規定値を15に戻して必要に応じて20にするように.

　　RC4:
　　　FbxSdkのバージョンを2020.3.7から元のバージョン(2020.3.4)に戻しました
　　　　2020.3.4と同様に計算すると、カメラアニメの姿勢にnanが含まれてしまい表示が消える不具合が直らなかった
　　　　特に複数カメラアニメが存在する場合に不具合が起きた
　　　　キーが存在しないノードに関してFbxNode::Evaluate*の結果にnanが含まれてしまうようだった
　　　　カーブの有無で判定して回避しようとしたがまだうまくいかず時間切れ、FbxSdkのバージョンを元に戻して解決
　　　　(注意)ロールバックする際には、exeと同じフォルダのlibfbxsdk.dllも2020.3.4に戻す必要有
　　　　
　　RC5:
　　　Shaperプレートメニューのウインドウをスクロールした下の方のボタンが押せないことがあったのを修正

　　RC6:
　　　OWP_Separatorのonly1line引数の名前をcontentsSize引数に変更
　　　　OWP_WindowPartsを登録して使用する際にはtrueに設定する
　　　　LongTimelineのようなGDI表示の場合にはfalseに設定する
　　　　モーションパネルなどについてスクロール下方のボタンが押せない不具合解消

　　　Testフォルダのモデル更新
　　　　1009_5フォルダのモデルをBlendShape設定済のVRoidに

　　RC7:
　　　BlendShapeアニメ再生の修正
　　　　ブレンド率0.0のフレームに移動した場合に頂点の内容が変化しない不具合を修正.
　　　　バッファ更新のトリガーはブレンド率0.0かどうかのフラグではなくてブレンド率が変化したかどうかのフラグに.

　　RC8:
　　　草の表示の不具合修正
　　　　草のRefPos、草のボーンマーク、草のマニピュレータを表示しようとして潜在的エラーが生じていたのを修正
　　　　草のLODについては応急処置としてLOD0だけを表示

　　RC9:
　　　ボーンが１つもないfbx読み込みがエラーで落ちる不具合を修正
　　　　1.0.0.22準備中の不具合
　　　　ボーンが無くてもBlendShape(モーフ)アニメを読むためにアニメ読み込み関数を呼ぶようにしたが
　　　　ボーンアニメ読み込み部分をスキップできていなかった



　　ショートムービー
　　　モーキャプが目パチしてニヤけます
　　　https://youtu.be/cEIdXoRXC-E


  　ver1.0.0.4以降共通
　　　新機能の使い方まとめ動画
　 　　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　　https://youtu.be/oKGY62YosSg






2024/05/19
　BlendShape(モーフ)対応の続き
   ボーン無しモーフ付きfbxのモーフアニメ再生に対応

　BlendShapeプレートメニュー
　　BlendShape(モーフ)アニメをスライダーで編集
　　アニメ編集としては複数フレームに対してブラシと共に作用するが、グラフ表示としてはまだ対応していない
　　メインメニューバーのモーションメニューの新規モーション実行にも対応
　　ただし、BlendShapeのベースとターゲットの形状としての設定については、あらかじめ設定してあるfbxにしか対応しない


　不具合修正
　　OWPのスクロールウインドウが子供コントロールへメッセージを伝達するように修正
　　マウス左ボタンダウンしか伝達していなかった




2024/05/18
　BlendShape(モーフ)対応の続き
　　モーフアニメの再生が可能
　　　とりあえずCPU処理で再生してみた
　　　
　　モーフアニメを自前のデータに読み込んでアニメ再生時と書き出し時に参照



　　モーフアニメの編集はまだ出来ない



2024/05/17
　BlendShape(モーフ)対応開始
　　まずはBlendShapeが設定されているVRoid(fbx)の読み込みと書き出し
　　読み込んで書き出してもBlendShape情報が失われなくなった
　　VRoid(fbx)のFaceの57個のShapeの内、目と口にモーションを付けたものを読み書きテストOK(Maya2024で読込再生確認)

　　BlendShapeの再生と編集はまだ出来ない



　FBX SDKのバージョンを2020.3.4から2020.3.7へアップ

　BlendShapeが設定されているfbxを読み込んで保存した場合にメモリリークしていたのを修正
　　std::stringをメンバーに持つ構造体に対してZeroMemoryしていたのが原因だった
　　問題が起きた構造体にも初期化関数を追加





2024/05/16
　AdditiveIK 1.0.0.21 release
　　1.0.0.20からの変更点
　　　不具合修正
　　　　chaファイル以外から読み込んだfbxが全て草として扱われてしまう不具合を修正
　　　　chaファイル以外から読み込んだスキンメッシュ(ボーン入りのメッシュ)が表示されなくなっていた


　ショートムービー
　　クリック位置に草が生えるんです
　　https://youtu.be/_-YDEyL16G8


  　ver1.0.0.4以降共通
　　　新機能の使い方まとめ動画
　 　　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　　https://youtu.be/oKGY62YosSg





2024/05/15
　AdditiveIK 1.0.0.20 release
　　1.0.0.19からの変更点
　　　Pick&Setの高速化
　　　　詳細判定の前にバウンダリーで粗く判定
　　　　こちらでテストした一番遅い条件で比べて３倍速くらいになった
　　　　地面などのポリゴン数が多いメッシュとの判定が必要になると３倍速になってもまだ遅い
　　　　しかし、今回の修正でポリゴン数の多いメッシュを適切な領域の適当なポリゴン数のメッシュに分けておけば、より高速化可能

　　草(grass)に対応
　　　fbx読み込み時にload fbx as grassにチェックを入れるとインスタンシング表示の草として読み込み
　　　モデルパネルで草を選び、上段カエルボタンの行の ModelPosAndDirショートカットボタン のPick&Setオプションでクリック位置に草を配置
　　　草読み込みは複数回実行可能で１つの草fbxに対して２インスタンスは256個まで
　　　Remove grass positionチェックボックスでdistanceエディットボックスの数値よりも近い距離にある選択中の草モデルの位置を削除
　　　草がなびく方向は常にカメラに対して横方向.(シェーダになびく方向を指定可能なので、将来的にはイベントでモデル周囲の草を倒したりも可能)

　RC2:
　　カメラを動かすと視野内の草が視野外判定されて表示されないことがある不具合を修正
　　　草はローポリゴンのインスタンシング表示なので軽い
　　　草１つ１つに対して視野内判定計算しても軽くなるように思えない
　　　草の視野内判定は配置領域ごとに配置領域に対して行う必要がある
　　　現在はそれほど広いステージを扱っていないのでver1.0.0.20では全ての草を視野内として扱うことにした

　　草がFogの効果を反映していなかった不具合を修正

　RC3:
　　1種類(1つのfbxファイル)の草を256個以上配置できませんとダイアログを出しているが
　　256個に達した後で、removeにチェックを入れて数を減らす操作の際にも
　　配置できないことを通知するダイアログが出ていたのを修正




　ショートムービー
　　クリック位置に草が生えるんです
　　https://youtu.be/_-YDEyL16G8


  　ver1.0.0.4以降共通
　　　新機能の使い方まとめ動画
　 　　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　　https://youtu.be/oKGY62YosSg




2024/05/13
　ショートムービー
　　クリック位置に草が生えるんです
　　https://youtu.be/_-YDEyL16G8

　ModelWorldMatショートカットボタンのダイアログにRemove grass positionチェックボックスを追加
　　distanceエディットボックスの数値よりも近い距離にある選択中の草モデルの位置を削除

　モデルパネルで草を削除した場合にメモリリークしていたのを修正




2024/05/12
　草(grass)に対応
　　fbx読み込み時にload fbx as grassにチェックを入れるとインスタンシング表示の草として読み込み
　　モデルパネルで草を選び、上段カエルボタンの行のModelWorldMatショートカットボタンのPick&Setオプションで草を配置
　　現在草は１種類で草のインスタンスは２５６個まで



　　複数種類(複数回読込)の草(grass)に対応.

　　草がなびく方向が常にカメラに対して横方向になるように.




2024/05/11
　上段カエルボタンの行のModelWorldMatショートカットボタンを押して出すダイアログで
　　Pick&Set(with NumKey)にチェックを入れた場合は　マウスクリック位置に選択中のモデルを配置

　Pick&Setの高速化
　　詳細判定の前にバウンダリーで粗く判定
　　こちらでテストした一番遅い条件で比べて３倍速くらいになった
　　地面などのポリゴン数が多いメッシュとの判定が必要になると３倍速になってもまだ遅い
　　しかし、今回の修正でポリゴン数の多いメッシュを適切な領域の適当なポリゴン数のメッシュに分けておけば、より高速化可能




2024/05/07
　AdditiveIK 1.0.0.19 release
　　1.0.0.18からの変更点
　　　不具合修正
　　　　剛体の衝突判定設定が誤解を招くGUIだったのを修正
　　　　　RigidParamsプレートメニューのConflict, GConflictダイアログ修正
　　　　　以前のGUIはビットシフトの足し算結果とビットのインデックスとが混在していた
　　　　　GUIによる設定方法をビットのインデックス(何番目のビットか)に統一
　　　　　グループ番号のビットインデックス(複数可)が 衝突対象のビットインデックス(複数可)の中に１つでも含まれてる場合に 衝突当たり判定が有効になる
　　　　　自分自身と当たり判定するチェックボックスは廃止
　　　　
　　　　GUI初期化時にオブジェクトに対してデフォルト値が設定されてしまうことがあった不具合修正
　　　　　OWP GUIの初期設定時にcallListenerフラグがfalseになっていなかった箇所がまだあったので修正
　　　　　剛体パラメータGUI初期化時にフラグ指定が無かった
　　　　　OWP_RadioButtonのsetSelectIndex()にはcallListenerフラグ引数が無かった
　　　　　cameraDistの保存値が機能するようになった
　　　　
　　　　File-->Saveメニューでプロジェクト以外の個別ファイル保存を選択した場合に、存在しないファイル名を指定できなかった不具合を修正

　　　　File-->Saveメニューでプロジェクト以外の個別ファイル保存を選択した場合に、パス名がセットされない不具合を修正


　　パタパタカクカクしない物理角度制限
　　　制限角度を越えた場合にフラグを立てて制限自体は剛体速度をスケールすることにより行った
　　　
　　DispAndLimitsプレートメニューの中のBulletPhysics関連のスライダーをBulletPhysicsプレートメニューに移動
　　　

　　Test/1009_5フォルダの設定を更新
　　　通常の設定(default_ref.ref)とスカートを少し持ち上げておく設定(ForRapidMove.ref)の２種類用意
　　　メインメニューバーの剛体設定選択メニュー(Select Rigid Menu)で切り替える

　　ドキュメント追加
　　　Documents/TroubleShooting/0_AboutSetingsOfBulletPhysicsSimuAfterVer10019.docx
　　　ver1.0.0.19以降における物理設定について

　　ドキュメント修正
　　　Documents/TroubleShooting/WhyTheDispAndLimitsPlateMenuAlsoHasASliderForTheSameItem.docx
　　　なぜ同じ項目に対するスライダーGUIが複数存在するかについて



　RC2:
　　BulletPhysicsメニューのダイアログ文言修正
　　　"PhysicalLimitScale" --> "LimitRateScale"
　　　"VScaleOnLimitEul" --> "RigidSpeed"
　　　0_AboutSetingsOfBulletPhysicsSimuAfterVer10019.docx中の表記も修正
　　ColiIDDlg中の表記修正
　　　"bit%02d" --> "bit_%02d"



　ショートムービー
　　限界越えたら0.1倍速で動きます
　　https://youtu.be/ufPtA-CxVKU







2024/05/05
　不具合修正
　　剛体の当たり判定設定が誤解を招くGUIだったのを修正
　　　RigidParamsプレートメニューのConflict, GConflictダイアログ修正
　　　以前のGUIはビットシフトの足し算結果とビットのインデックスとが混在していた
　　　GUIによる設定方法をビットのインデックス(何番目のビットか)に統一
　　　グループ番号のビットインデックス(複数可)が 当たり対象のビットインデックス(複数可)の中に１つでも含まれてる場合に 当たり判定が有効になる
　　　自分自身と当たり判定するチェックボックスは廃止





2024/05/04
　DispAndLimitsプレートメニューの中のBulletPhysics関連のスライダーをBulletPhysicsプレートメニューに移動

　更に物理角度制限修正
　　角度制限時に剛体の速度を０にはしないで
　　BulletPhysicsプレートメニューのVScaleOnLimitEulスライダーの設定値で
　　元の速度をスケールしてセットするように修正
　　角度制限時の物理シミュのダイナミック具合の調整が可能(スカート突き抜けが起きない程度に値を小さくする必要はある)

　ドキュメント修正
　　Documents/TroubleShooting/WhyTheDispAndLimitsPlateMenuAlsoHasASliderForTheSameItem.docx


　ショートムービー
　　限界越えたら0.1倍速で動きます
　　https://youtu.be/ufPtA-CxVKU





2024/05/03
　更に物理角度制限修正
　　物理の姿勢に角度制限を施してボーンにセットした後で、その姿勢を物理にセットし直した
　　角度制限時には剛体の速度を０にしてみた(<--これが効いた)

　　Testフォルダの1009_5のモデルの剛体設定と制限角度を修正
　　　スカート剛体を大きくして足との間隔が広くなるようにした

　　テストしてみた結果
　　　スカートに関してパタパタする感じも無くなり足が突き抜けることも無くなった
　　　引き続きテストしながら調整していく

　　更にテストしてみた結果
　　　制限角度、RimitRateスライダー、PhysicalLimitScaleスライダー、BtMovableRateスライダーで大抵調整可能
　　　速い動きに対応可能にするためにPhysicalLimitScaleの初期値は0、BtMovableRateの初期値は100に設定した
　　　PhysicalLimitScaleを0、BtMovableRateを100に設定しても制限角度を越えるとフラグが立って速度設定が変わる
　　　速度設定が重要だったという現時点での結論




　Test/1009_5フォルダの設定を更新
　　通常の設定(default_ref.ref)とスカートを少し持ち上げておく設定(ForRapidMove.ref)の２種類用意
　　メインメニューバーの剛体設定選択メニュー(Select Rigid Menu)で切り替える



　ここまでのまとめメモ(物理角度制限について)
　　物理シミュの結果は表示速度依存
　　表示が遅いほど１フレーム当たりの変化が大きくなり制御が難しくなる
　　表示速度が速いほど速い動きを少ない乱れで再生可能
　　表示速度が遅い場合は　Speedスライダーでモーションスピードを遅くする
　　
　　物理シミュに対する角度制限において角度自体をダイレクトに制限するとパタパタカクカクするので剛体の速度で制御する
　　
　　物理剛体設定ファイルについては、ジャンプする場合と素早く走る場合とでは別設定が好ましい
　　設定を複数用意しておいてメインメニューバーの剛体設定選択メニュー(Select Rigid Menu)で切り替える
　　足を高く上げて走る場合にはスカート剛体を大きくしておいて、あらかじめある程度スカートを持ち上げておく設定にする






2024/05/02
　不具合修正
　　OWP GUIの初期設定時にcallListenerフラグがfalseになっていなかった箇所がまだあったので修正
　　　剛体パラメータGUI初期化時にフラグ指定が無かった
　　　OWP_RadioButtonのsetSelectIndex()にはcallListenerフラグ引数が無かった
　　　GUI初期化時にオブジェクトに対してデフォルト値が設定されていたものがまだあった
　　　cameraDistの保存値が機能するようになった


　SimpleWaterに関するGUIの最大値最小値を調整

　SimpleWaterのUVを修正


　物理角度制限修正
　　90fpsでうまくいくように設定したものを30fpsで再生した場合に　PhysicalLimitRateスライダーで調整してもまだ尚パタパタカクカクが目立っていた
　　同一マシンにおいても　モデル単体で設定してから重いシーンに置いて動かすことはあるので　対策が必要
　　遅い表示時のパタパタを緩和するための修正を試しているところ
　　LimitEulをオンにしている場合には　制限角度内の動きに対しても補間を適用してみた
　　効果はあった　LimitRateを大きめにして上記の補間を適用するとパタパタがかなり緩和した
　　制限角度内における移動率を設定するためのスライダーをDispAndLimitsメニューのBtMovableRateに設置
　　テストしてみた結果
　　　緩和にしかならない
　　　しかし今回のBtMovableRateスライダーは滑らかに動かすための緩和策にはなった(突き抜けるが)
　　　滑らかに動かすと足がスカートを突き抜けやすく、突き抜けないようにするとパタパタする
　　　表示が遅い場合にはSpeedスライダーを1.0より小さく設定して　ゆっくり動かすのが根本的解決策のようだ
　　　ゆっくり動かせない場合は　ゆっくり動かしながら物理をベイク(タイムラインプレイヤーボタンの赤丸ボタン)しておいて　通常速度で再生するのも有
　　　物理全てをベイクしないでスカートだけベイクするなども有だと思う
　　　
　　


2024/05/01
　AdditiveIK 1.0.0.18 release
　　1.0.0.17からの変更点
　　　不具合修正
　　　　OWP_SliderのsetValueにリスナーを呼ばないフラグを渡してもリスナーが呼ばれていた不具合を修正
　　　　　ダイアログの初期化時に項目のデフォルト値がオブジェクトに設定されたことがあった

　　ジャンプ中の前転にも対応
　　　IK回転操作時にDispAndLimitsプレートメニューのRotateTranslationにチェックを入れると移動成分も回転
　　　RotateTranslationにチェックを入れない場合は移動はそのままで回転だけ行う
　　　以前のバージョンにおいては、Hipsだけ特別扱いをしていてHipsの場合は強制的にRotateTranslationチェック状態と同じ処理だった
　　　ジャンプ中に前転する場合などHipsにおいてもHips以外と同様にRotateTranslationによる場合分けが必要だった
　　　よってHipsに対してもRotateTranslationチェックの有無で場合分けをした
　　　使い方は下記ショートムービーリンク参照


　　全バネ定数スケールスライダーを移動バネに対しても適用
　　　DispAndLimitsプレートメニューのSpringScaleスライダー操作時に回転バネだけでなく移動バネもスケールするように修正

　　Shaderプレートメニューから呼び出すShaderParamsダイアログを右ペインにはめ込み
　　　Skyプレートメニューから呼び出すダイアログも右ペインにはめ込み

　　SimpleWaterシェーダ対応
　　　PBR,NoSkin設定時のみ機能
　　　ShaderプレートメニューにSimpleWater(PBR,NoSkin)チェックボックスを追加
　　　水面(計算負荷の低い)を想定した機能
　　　法線マップをディストーションマップとしても使用
　　　海か川かを選択可能
　　　流れの向き(UV)、流れの速度、ディストーションスケール、ディストーションマップの２成分選択も可能
　　　プロジェクト保存時にシェーダタイプファイル(*.stf)に保存、プロジェクト読み込み時に読み込み




　ショートムービー
　　ジャンプ中にくるりと回ります
　　https://youtu.be/6wveLqMbsYA






2024/04/30
　不具合修正
　　OWP_SliderのsetValueにリスナーを呼ばないフラグを渡してもリスナーが呼ばれていた不具合を修正
　　　ダイアログの初期化時に項目のデフォルト値がオブジェクトに設定されたことがあった

　ShaderParamsダイアログとSkyParamsダイアログをOrgWindowで作り直して右ペインにはめ込み




2024/04/28
　ShaderプレートメニューにDistortion(PBR,NoSkin)チェックボックスを追加
　　水面(計算負荷の低い)を想定した機能
　　法線マップをディストーションとしても使用
　　ディストーション専用のテクスチャが必要かどうかテストしてから決める予定
　　DistortionFlag設定はまだファイルに保存していない
　　


2024/04/26
　ジャンプ中の前転にも対応
　　IK回転操作時にDispAndLimitsプレートメニューのRotateTranslationにチェックを入れると移動成分も回転
　　RotateTranslationにチェックを入れない場合は移動はそのままで回転だけ行う
　　以前のバージョンにおいては、Hipsだけ特別扱いをしていてHipsの場合は強制的にRotateTranslationチェック状態と同じ処理だった
　　ジャンプ中に前転する場合などHipsにおいてもHips以外と同様にRotateTranslationによる場合分けが必要だった
　　よってHipsに対してもRotateTranslationチェックの有無で場合分けをした

　全バネ定数スケールスライダーを移動バネに対しても適用
　　DispAndLimitsプレートメニューのSpringScaleスライダー操作時に回転バネだけでなく移動バネもスケールするように修正



　ショートムービー
　　ジャンプ中にくるりと回ります
　　https://youtu.be/6wveLqMbsYA

　README.mdのExplaining Movieにショートムービーリンク追加





2024/04/26
　AdditiveIK 1.0.0.17 release
　　1.0.0.16からの変更点
　　　不具合修正
　　　　右クリックによるブラシ選択時にジョイント選択が初期化されてしまっていたのを修正
　　　　　右クリックによるブラシ選択時にジョイント選択を復元
　　　　　左ペインのジョイント階層ツリーからジョイントを選択した場合にも対応

　　　VRoid読込時マニピュレータとグラフの軸が一致
　　　　プロジェクトファイル(*.cha)ファイルにDispAndLimitsレートメニューのBoneAxisを保存
　　　　chaファイルにBoneAxisタグが存在しない場合(古いchaファイルの場合)、１つでもVRoidモデルがあればボーン軸種類としてBONEAXIS_BINDPOSEを設定
　　　　モデル読み込み後は、DispAndLimitsプレートメニューのAxisKindコンボボックスにてボーン軸の種類を設定可能
　　　　軸の種類BONEAXIS_BINDPOSEについて
　　　　　VRoidやバインドポーズとしてボーンの向きが設定されているfbxファイル用
　　　　　オイラーグラフの軸とIK回転の軸(マニピュレータ軸)とボーンの軸が一致する
　　　　　Rigの軸指定の種類のNODE*とも一致するようになる
　　　　軸の種類BONEAXIS_CURRENTについて
　　　　　RokDeBone2出力のfbxやバインドポーズとしてグローバル軸が設定されているfbxファイル用
　　　　　IK操作をボーン軸で行うことが可能
　　　　　しかしオイラーグラフの軸とマニピュレータ軸は一致しない
　　　　オイラーグラフの軸の種類は常にBONEAXIS_BINDPOSE(今まで通り)
　　　　(今まではVRoid読み込み時にもBONEAXIS_CURRENTを指定していたので、オイラーグラフの軸とマニピュレータの軸が表示上異なっていた)

　　　　注
　　　　　軸の種類の違いにより、マニピュレータ軸とグラフの軸が一致しないことがありますが、それは表現方法の違いであり同一の姿勢を示しています。
　　　　　軸の種類の違いとは、どこから角度を測るかという違いであり、保持している元データとしては同一です。


　　　ブラシピーク位置設定方法変更
　　　　今まではTopPosスライダーでブラシの山のピークの位置を決めていた
　　　　これからは、オイラーグラフ上部のタイムラインを右クリックすることによりピーク位置を設定
　　　　ピーク位置は選択フレーム範囲内にクランプ

　　　上部常駐スライダ変更
　　　　TopPosスライダーの代わりに、ブラシミラーUチェックボックス、ブラシミラーVチェックボックス、ブラシリピートスライダを配置
　　　　ブラシ選択は3Dウインドウ右クリック、その他のブラシ設定項目は上部常駐GUIに配置したので、BrushParamsプレートメニューは取り除いた

　　　４段階LODに対応

　　　視野内判定高速化
　　　　シェーダ修正

　　　物理回転バネ定数全体をスケールするスライダーをDispAndLimitsプレートメニューに追加
　　　　EditScaleスライダーはアプリ上部の常駐スライダーと冗長なので取り除いて、新たにAngleSpringScaleスライダーを追加　

　　　RigidParamsプレートメニューのForbidRot(回転禁止)設定も自前の制限で復活
　　　　剛体は親ジョイントと子供ジョイントをつなぐ線分をベースに作成されますが、ForbidRot回転禁止は子供ジョイントに設定します.
　　　　回転禁止にチェックが入っている剛体は、前のフレームの姿勢へと制限

　　　自前の角度制限が動いたのでBulletPhysics側の角度制限はfree状態に設定

　　　DispAndLimitsプレートメニューのAngleSpringScaleスライダーの値もプロジェクトファイル(*.cha)に保存

　　　各ブラシの引数チェック部分変更
　　　　ブラシのリピート回数の上限を100に.

　　　ドキュメント追加
　　　　Documents/TroubleShooting/WhyTheDispAndLimitsPlateMenuAlsoHasASliderForTheSameItem.docx
　　　　(なぜ同じ項目についてのスライダーがDispAndLimitsプレートメニューにも存在するのかについて)

　RC2:
　　上部常駐スライダーの見出し文を修正
　　PlaceFolderWindowのShortCutKey一覧に追加した文を修正
　RC3:
　　プロジェクトオープンダイアログのTestフォルダへのパスが1.0.0.16になっていたのを1.0.0.17に修正.
　　上部常駐BrushRepeatsスライダーの最大値を100に.
　RC4:
　　CSChkInView高速化
　　　シェーダAdditiveIK_ChkInView.fx内のif文を配列参照に置き換えて高速化




　動画
　　念じながら走るのです
　　　https://youtu.be/S-2ycgp_xM4

　　20fpsで物理角度制限テスト
　　　https://youtu.be/sCNE9C_zWNA

  　ver1.0.0.4以降共通
　　　新機能の使い方まとめ動画
　 　　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　　https://youtu.be/oKGY62YosSg





2024/04/23
　物理回転バネ定数全体をスケールするスライダーをDispAndLimitsプレートメニューに追加
　　EditScaleスライダーはアプリ上部の常駐スライダーと冗長なので取り除いて、新たにAngleSpringScaleスライダーを追加　

　ドキュメントに追記
　　物理回転バネ定数全体スケールについての記述を追加
　　設定画面のスクリーンショットを追加
　　Documents/TroubleShooting/WhyTheDispAndLimitsPlateMenuAlsoHasASliderForTheSameItem.docx

　UpdateLog.txtの2024/04/22の軸の種類の説明を修正

　RigidParamsプレートメニューのForbidRot(回転禁止)設定も自前の制限で復活
　　剛体は親ジョイントと子供ジョイントをつなぐ線分をベースに作成されますが、ForbidRot回転禁止は子供ジョイントに設定します.
　　回転禁止にチェックが入っている剛体は、前のフレームの姿勢へと制限

　自前の角度制限が動いたのでBulletPhysics側の角度制限はfree状態に設定

　DispAndLimitsプレートメニューのAngleSpringScaleスライダーの値もプロジェクトファイル(*.cha)に保存




2024/04/22
　プロジェクトファイル(*.cha)ファイルにDispAndLimitsレートメニューのBoneAxisを保存
　　chaファイルにBoneAxisタグが存在しない場合(古いchaファイルの場合)、１つでもVRoidモデルがあればボーン軸種類としてBONEAXIS_BINDPOSEを設定

　　モデル読み込み後は、DispAndLimitsプレートメニューのAxisKindコンボボックスにてボーン軸の種類を設定可能

　　軸の種類BONEAXIS_BINDPOSEについて
　　　VRoidやバインドポーズとしてボーンの向きが設定されているfbxファイル用
　　　オイラーグラフの軸とIK回転の軸(マニピュレータ軸)とボーンの軸が一致する
　　　Rigの軸指定の種類のNODE*とも一致するようになる
　　軸の種類BONEAXIS_CURRENTについて
　　　RokDeBone2出力のfbxやバインドポーズとしてグローバル軸が設定されているfbxファイル用
　　　IK操作をボーン軸で行うことが可能
　　　しかしオイラーグラフの軸とマニピュレータ軸は一致しない
　　オイラーグラフの軸の種類は常にBONEAXIS_BINDPOSE(今まで通り)
　　(今まではVRoid読み込み時にもBONEAXIS_CURRENTを指定していたので、オイラーグラフの軸とマニピュレータの軸が表示上異なっていた)

　　追記
　　　軸の種類の違いにより、マニピュレータ軸とグラフの軸が一致しないことがありますが、それは表現方法の違いであり同一の姿勢を示しています。
　　　軸の種類の違いとは、どこから角度を測るかという違いであり、保持している元データとしては同一です。




　４段階LODに対応

　右クリックによるブラシ選択時にジョイント選択が初期化されてしまっていたのを修正
　　右クリックによるブラシ選択時にジョイント選択を復元


　ドキュメント追加
　　Documents/TroubleShooting/WhyTheDispAndLimitsPlateMenuAlsoHasASliderForTheSameItem.docx
　　(なぜ同じ項目についてのスライダーがDispAndLimitsプレートメニューにも存在するのかについて)







2024/04/18
　AdditiveIK 1.0.0.16 release
　　1.0.0.15からの変更点
　　　不具合修正
　　　　CameraDist常駐スライダーをホイールで動かした際に描画が更新されていなかったのを修正

　　　　Rigの修正
　　　　　1009_5モデルにおいてapplyframeが167となるように複数フレームを選択して足の青いリグを回転すると回転軸が設定と異なる不具合があった
　　　　　通常のマニピュレータ回転時には子供ジョイントの軸で親ジョイントを回転させる
　　　　　それに対してRig回転時には子供ジョイント軸で子供ジョイントを回転させる
　　　　　Rig回転のときの回転軸計算に通常マニピュレータ回転軸計算結果を使っていたというミス
　　　　　修正により複数フレーム選択時のリグ回転も正常になった
　　　　　ちなみに、
　　　　　Testフォルダのモデルに設定してあるリグは動作確認オンリーの目的で設定したものであり、
　　　　　実用的設定ではないので各自使いやすいように設定してください
　　　　　私はリグをあまり使わずにマニピュレータ(ジョイントを選択して回転)でやる派なので、今のところ


　　　物理角度制限復活
　　　　剛体接続を柔らかくしたので制限角度が効かなくなっていた
　　　　自前で制限処理をすることにより物理角度制限復活
　　　　LimitEulerプレートメニューのダイアログにLimitRateスライダーを追加
　　　　設定した制限角度を100%守って制限すると、動きが激しい部分の動きがカクカクパタパタしてしまう
　　　　LimitRateスライダーを適当に設定して制限を緩めることにより制限しつつ滑らかな動きへと近づく
　　　　そのような設定をするためには、制限角度をオーバーして回転することを考慮して制限角度を小さめに設定しておく必要がある
　　　　LimitRateはボーンごとに設定可能で、ApplyDeeperボタンで下層ツリーへ一括設定、ApplyAllボタンで全ボーンへ一括設定可能

　　　　DispAndLimitsプレートメニューにPhysicalLimitScaleスライダーを追加
　　　　　LimitEulerプレートメニューで各ボーンに対してlimitrateを設定しておいて
　　　　　動作環境の速い遅いへの対応策としてDispAndLimitsプレートメニューのPhysicalLimitScaleで全ボーンのlimitrateに倍率を掛けて調整する


　　　重力スケールの最大値を100から200へと変更
　　　回転バネ定数の設定範囲を0から500の範囲へと変更(以前は2から3000)
　　　　バネを柔らかくして重さを軽くして重力で調整してみる試み

　　　EditRate, MotionSpeed, PhysicalLimitScale, cameraDistをプロジェクトファイル(*.cha)保存時に保存

　　　Testフォルダのモデル更新
　　　　1009_5
　　　　　剛体の重さを一番小さく設定　ヘアのバネ定数を大きく　スカートのバネ定数を小さく
　　　　　LimitRate設定
　　　　　　スカートの真横ボーンには制限角度を設定しないことにより、ジャンプでスカートは拡がるが中は見えないように.
　　　　　　ヘアの制限角度を+-15degree、スカートの制限角度を+-5degree
　　　　　　スカートだけではなくヘアに対する角度制限にも使えるようになった
　　　　　　fpsが小さい場合にもLimitRateスライダーで対応できるようだ. 75fps-->LimitRate85, 20fps-->LimitRate98
　　　　BoySporty_2
　　　　　以前と大きくは変わらないようにLimitRateを設定

　　RC2:
　　　DispAndLimitsプレートメニューにPhysicalLimitScaleスライダーを追加
　　　　LimitEulerプレートメニューで各ボーンに対してlimitrateを設定しておいて
　　　　動作環境の速い遅いへの対応策としてDispAndLimitsプレートメニューのPhysicalLimitScaleで全ボーンのlimitrateに倍率を掛けて調整する
　　　EditRate, MotionSpeed, PhysicalLimitScale, cameraDistをプロジェクトファイル(*.cha)保存時に保存

　　RC3:
　　　Rigの修正
　　　　1009_5モデルにおいてapplyframeが167となるように複数フレームを選択して足の青いリグを回転すると回転軸が設定と異なる不具合があった
　　　　通常のマニピュレータ回転時には子供ジョイントの軸で親ジョイントを回転させる
　　　　それに対してRig回転時には子供ジョイント軸で子供ジョイントを回転させる
　　　　Rig回転のときの回転軸計算に通常マニピュレータ回転軸計算結果を使っていたというミス
　　　　修正により複数フレーム選択時のリグ回転も正常になった
　　　EditRangeの修正
　　　　ブラシピーク位置をg_applyrateとCEditRange::s_applyrateと２か所で管理していて問題が出たので、g_applyrateだけで管理するように修正

　　RC4:
　　　Rigの修正
　　　　更に修正
　　　　ブラシピーク位置以外のリグ回転も正常に.
　　　　Rig回転時はapplybone引数にcurboneを渡して解決


動画
　20fpsで物理角度制限テスト
　　https://youtu.be/sCNE9C_zWNA

  ver1.0.0.4以降共通
　　新機能の使い方まとめ動画
　 　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　https://youtu.be/oKGY62YosSg




2024/04/15
　物理角度制限修正
　　LimitEulerプレートメニューのLimitRateスライダー修正
　　limitrateが実質FreeRateになっていたので100-limitrateを新しいlimitrateに.
　
　重力スケールの最大値を100から200へと変更
　回転バネ定数の設定範囲を0から500の範囲へと変更(以前は2から3000)
　　バネを柔らかくして重さを軽くして重力で調整してみる試み

　Testフォルダのモデル更新
　　1009_5
　　　剛体の重さを一番小さく設定　ヘアのバネ定数を大きく　スカートのバネ定数を小さく
　　　ヘアの制限角度を+-15degree、スカートの制限角度を+-5degree
　　　スカートだけではなくヘアに対する角度制限にも使えるようになった
　　　fpsが小さい場合にもLimitRateスライダーで対応できるようだ. 75fps-->LimitRate85, 20fps-->LimitRate98


2024/04/14
　物理角度制限を修正
　　SetBtMatLimited()関数内の多数のミスを修正
　　制限設定値と候補値の間を補間した後で、更にその値と前回表示値との間を補間
　　制限角度に引っ掛からない場合にも前回表示値との間を補間
　　ヘアとスカートで試したが、ヘアに使うとパタパタするのが目立つことがあり、今のところスカート用の機能という印象

　物理角度制限を更に修正
　　ローカルオイラー角計算箇所にグローバル行列を使っていたミスを修正.
　　２回補間していた部分を１回補間に.
　　LimitRateスライダーの値で大きく表示が変わるようになった.
　　RigidParamsプレートメニューでの設定と合わせて調整可能になったように思う.
　　物理挙動はfps依存、こちらの環境では角度制限で止まった後の戻り方が改善した(以前はもっとパタパタしていた)
　　しかしスカート用という印象.

　Testフォルダのモデル更新
　　1009_4　剛体パラメータを修正　スカートの回転バネ定数を少し大きく


2024/04/13
　//2024/04/13メモ
　//物理を柔らかく揺らすために剛体の結合を柔らかく設定した
　//剛体の接続を柔らかく設定した影響で物理の角度制限が効かなくなっていた
　//よって一度は取り下げたが自前の角度制限を物理に対しても適用することにした

　物理の角度制限方法を修正(LimitRateForPhysics)
　　きっちり制限値で止めるとかえってねじれることがあった
　　制限値から指定％だけ物理計算値に近づけた値を設定することにした
　　どれだけ物理計算値に近づけるかという割合をLimitEulerプレートメニューのlimit rate for physicsスライダーで設定
　　スライダー値０で制限値100%、スライダー値100で候補値100%となる
　　fps(表示速度)が速いほど１フレーム当たりの変化は小さくなるのでスライダーによる効果も感じ難くなる(デバッグビルドは実行が遅いので効果を感じ易い)
　　現在Testフォルダの1009_1のモデルのスカートに対して+-5度の制限角度を設定しているが、以前よりは良くなった

　


2024/04/12
　LimitEulスプライトスイッチオンの時に物理にも角度制限
　　物理のパラメータを緩くしてから制限が効いていなかった
　　bulletphysicsの処理の後で自前の角度制限を実施
　　制限角度の設定はLimitEulerプレートメニューで.




2024/04/12
　AdditiveIK 1.0.0.15 release
　　1.0.0.14からの変更点
　　　不具合修正
　　　　モデルが全体移動している場合にシャドウが表示されていなかった不具合を修正
　　　　ChkInViewにおけるシャドウカメラ変換行列がモデル全体移動に対応していなかった
　　　
　　　DOF表示の高速化
　　　　被写界深度(DOF)をオンにした時の表示速度がDOFをオフにしたときの表示速度と同じくらいにまで高速化

　　　シャドウ品質の改善
　　　　シャドウの品質改善とはシャドウのギザギザ表示を解消すること
　　　　ShadowプレートメニューにVarianceShadowMapsチェックボックスとBlurShadowチェックボックスを追加
　　　　VarianceShadowMaps(分散シャドウマップ)とは
　　　　　シャドウの深度情報の差分から影かどうかの分散(確率用語)を計算して影の色を決める方法
　　　　BlurShadowは
　　　　　ガウシアンによるボカシを掛ける機能でオフにしている場合にも縮小拡大効果によりボカシを適用して品質向上

　　RC2:
　　　blurShadowオフの時にbloom効果が小さくなっていた不具合修正
　　　ボカシ具合の調整
　　　　ボケ過ぎないように.
　　　　ガウシアンブラーの計算ノード数(8 x 2)を半分(4 x 2)に. 
　
　　release:
　　　LODの２段階目のメッシュが表示されなくなっていた不具合(1.0.0.15へ向けての修正時に生じた不具合)を修正
　　　ChkInViewのコンピュートシェーダの記述ミス



2024/04/10
　VarianceShadowMaps(分散シャドウマップ)導入
　　ShadowプレートメニューにVarianceShadowMapsチェックボックスを追加
　　深度情報の差分から光が当たる確率を求めて陰色割合を決める方法
　　影の色が(変化して)ソフトになりノイズも減るようです
　　調整法としては、VSMをオンにする場合には自動で影の濃さが変わるのでcolor値は小さめも有, ノイズも確率的に減るのでbias値も小さく.

　BlurShadow
　　VSMオンの時もオフの時もシャドウマップに対してボカシ処理を追加
　　



2024/04/09
　DOF表示の高速化
　　DOFをオンにした時の表示速度が約1.5倍速(DOFオフの時とほぼ同じ)に.

　不具合修正
　　モデルが全体移動している場合にシャドウが表示されていなかった不具合を修正
　　　ChkInViewにおけるシャドウカメラ変換行列がモデル全体移動に対応していなかった

　デバッグビルドの警告解消
　　デバッグビルドにおいて、PixelShaderがSV_Target1使うはずなのにPSOにそのための設定が無いという警告が出ていた
　　調査した結果、シャドウマップ出力PSにおける警告だった
　　シャドウマップPSはSV_Target1を出力しないのだが、同じfxファイル内の他のPSはSV_Target1を利用していた
　　同じfxファイルにSV_Target1を使うPSがある場合にはPSOにSV_Target1の準備設定をしておくことにより解決、警告は出なくなった

　DOFプレートメニューのSkyDofのオンオフが機能するように.
　　DOF表示の高速化の修正でSkyDofがダイアログのチェックに関わらず常にオンになっていたのを修正



2024/04/07
　AdditiveIK 1.0.0.14 release
　　1.0.0.13からの変更点
　　　コンピュートシェーダー対応
　　　　CPU処理とGPU処理を同期して使うことが出来るようにコンピュートシェーダを即時実行するためのクラスを新規

　　　　ピック&セット機能がスキンメッシュ(ボーン入りのメッシュ)に対しても機能するように.
　　　　　ボーン変形計算とピック計算をコンピュータシェーダで実行
　　　　　ビデオメモリ不足がシビアにならない程度に(こちらで以前読めていたアセットを読み込むことが出来る程度に)コンピュートシェーダ化
　　　　　
　　　　視野内判定(ChkInView)の改善
　　　　　視錐体による判定(改善前は境界球判定だった)
　　　　　コンピュートシェーダによる高速計算

　　　Pick最大距離設定スライダー
　　　　ProjAndLODプレートメニューにPickDistスライダーを追加
　　　　PickDistRate x ProjectionFarの距離より遠いメッシュに対してはPick処理をスキップ
　　　　PickDist 0.0でPick全スキップ、PickDist 1.0で視野内全メッシュに対してPick
　　　　
　　　マニピュレータの色の濃さを調整
　　　　色が濃すぎてメッシュが隠れてしまっていたのを見易くなるように修正

　　　半透明ブレンドに関わるメッシュソートの改良
　　　　管理クラスをはっきりさせて、まとめる部分はまとめてからソート


　　RC2:
　　　シェーダー内の割り算を出来るだけ掛け算表現で計算するように修正
　　　　多少高速化
　　　コンピュートシェーダ版のChkInViewにおいて座標変換が抜け落ちていたのを修正
　　　　モデル全体位置を設定している場合にモデルが表示されないことがあった
　　　重いアセットで物理シミュをするとエラー終了する不具合を修正
　　　　IMComputeを実行する関数は実行中再入禁止(仕様として再入できない)
　　　　再入してエラーになるときの症状としては、コマンドリストリセットエラー、リソースバッファMapエラーなど原因が分かりずらかった
　　RC3:
　　　RC2で修正したChkInView再入禁止問題について更に修正
　　　　CModel::UpdateMatrixの呼び出し方を修正することによりCModel::ChkInViewに再入するような呼び出しがされないようにした
　　RC4:
　　　ジャンプ補間と物理ベイクのアンドゥリドゥに関する修正
　　　　オイラーグラフの更新も追加
　　RC5:
　　　複数モデルに対して同時に物理シミュを実行するとChkInViewへの再入が起きてエラーになる不具合を修正
　　　　CModel::UpdateMatrixをSetBtMotion(), Motion2Bt()の外に出してCModel::UpdateMatrixをシングルスレッドから呼び出すことで
　　　　CModel::ChkInViewへの再入が起こらないようにした
　　RC6:
　　　メッシュの無いfbx(モーションだけのRokokoのfbxなど)を読み込もうとするとエラーになる不具合を修正
　　　　ChkInViewコンピュートシェーダ実行用のオブジェクト作成でエラーになっていた
　　　　メッシュが無い場合はChkInView実行用オブジェクト作成をスキップ



2024/04/04
　ChkInViewをコンピュートシェーダで実行
　　シェーダリソース数が増えすぎないようにCModelに１つCSChkInViewクラスを作成して実行
　　視錐体で計算.(今までは境界球計算していた)
　　多少高速化(ChkInView処理よりもDOFの処理の方が重いのでDOFをオフにして比べると効果が分かり易い)

　ComputeDeformコンピュートシェーダの実行頻度変更
　　現在はまだPickのときにしかDefrom結果を使わないので、DeformはPickのときだけ実行するように修正


2024/04/03
　Pickシェーダの出力要素数を1にして最適化

　IMComputeの使わないメンバを削除
　　コンピュートシェーダ即時実行専用に

　ビデオメモリ使用量の最適化
　　TheHuntやMountEnvironmentのような大きめのステージ読み込み時にビデオメモリが足りないエラーが出たので最適化
　　Deformコンピュートシェーダはスキンメッシュに対してのみ行う
　　Pickコンピュートシェーダはスキンメッシュに対してだけ行う
　　背景メッシュのPickについては無変換の座標に対してCPUで行う
　　以前読めていたステージは読み込んでもメモリ不足エラーにならないように.

　ProjAndLODプレートメニューにPickDistスライダーを追加
　　PickDistRate x ProjectionFarの距離より遠いメッシュに対してはPick処理をスキップ
　　PickDist 0.0でPick全スキップ、PickDist 1.0で視野内全メッシュに対してPick
　

2024/04/02
　座標変換だけではなくPick処理本体もコンピュートシェーダ化
　　座標変換だけCSでCPUでピックしていたのだが遅かったのでピック本体もCS化
　　DispGroupメニューとShaderメニュー時に、毎フレームPick計算しても70fpsが60fpsになるくらいの速さ

　IMComputeクラスを追加
　　コンピュートシェーダの実行をCPUと同期処理で行うためにIMComputeクラス(即時実行の意)を作成
　　実行の度に終了を待つことにしたのでCPU処理の中にコンピュートシェーダ処理を組み入れることが出来た
　　現在は、毎フレーム視野内全メッシュの座標変換と、30fpsの頻度でマウスピック処理をするのに使用している
　　コンピュートシェーダに投げることが出来る処理は投げていく予定


2024/04/01
　CDispObjクラスのコンピュートシェーダ部分をCSDeformクラスにクラス化
　　コンピュートシェーダを増やしていく前にクラス化して整理


2024/03/31
　スキンメッシュ(ボーン入りのメッシュ)に対してもPickAndSetが使えるように.
　　DispGroupプレートメニューまたはShaderプレートメニュー選択時にスキンメッシュもマウスで選択可能に.
　　スキンメッシュに対してはコンピュートシェーダーでボーン変形をして当たり判定
　　コンピュートシェーダーをもってしてもpick中は描画回数が半分くらいになるがDispGroupとShaderメニューオンの時だけなので良しとする
　　コンピュートシェーダーは大きい入力小さい出力で威力を発揮するので、そのような機能に対して使用していく予定　　

　Pick用のコンピュートシェーダーのダイエット
　　頂点バッファへの流し込みは重いので想定から外して座標変換目的に合わせてダイエット
　　ビデオカードスレッド数８から１６へ変更
　
　高速ツールチップの調整
　　マウスをがちゃがちゃ動かさないと出てこないツールチップに腹が立ったのでツールチップを高速表示していた
　　しかしツールチップのためのpick処理が増えて重くなったので0.1秒に１回未満の表示回数へと調整
　　DispGroupメニュー、Shaderメニュー時にも表示が遅くならなくなった(変更前は、DispGroupメニューをオンにすると70fpsが20fpsに激減していた)


2024/03/30
　リファクタリング
　　レンダーオブジェクトの管理クラスをChaSceneに.
　　ブレンドのためのカメラ距離ソート部分修正.
　　レンダーオブジェクトコピー時のメモリアロケートを修正.

　マニピュレータの色を薄く

　ループ時ガベージコレクタをコメントアウトしていたのを復活
　　まとめて大きく遅くなることが無いようにループで呼ぶのが正解らしい.


2024/03/29
　AdditiveIK 1.0.0.13 release
　　1.0.0.12からの変更点
　　　不具合修正
　　　　DepthOfField(DOF)の修正
　　　　　ボケるべき位置にボケない三角形が多数表示される不具合を修正
　　　　　SkyDOFの実装方法をSkyデプス方式からクリア方式へ変更
　　　　　大きいモデル(ポリゴン)表示時やカメラが遠くに離れた場合に不具合が生じていた
　　　　　RefPosをオンにした場合にも生じていた
　　　　RefPosの修正
　　　　　半透明がブレンドされていなかった不具合修正
　　　　　DOFと一緒に使うとボケない三角形が多数表示されていた不具合修正
　　　　　スキンメッシュの内部配列のインデックスが一部RefPosに対応できていなかった不具合修正
　　　　OWPスライダーの修正
　　　　　セパレータ内のスライダーの左ダブルクリックが効かなくなっていたのを修正
　　　　　　左ダブルクリック位置の数値を設定
　　　　　セパレータ内の右ダブルクリックが効かなくなっていたのを修正
　　　　　　右ダブルクリックでアンドゥ実行
　　　　　スライダードラッグ時につまみの位置が微妙にずれるのを修正
　　　　　　クリック位置とつまみ位置のずれを保ったままドラッグによりスライドする
　　　　　　修正により、つまみ中央をドラッグした場合にもつまみ位置とマウスと位置がぴったり合うことを確認
　　　　剛体マーク表示の修正
　　　　　マルチスレッドのスロット番号合わせ
　　　　　マウスホイール回転でタイムラインのフレームを変化させたときに、剛体マークとモデルの姿勢が描画１回分ずれていたのを修正
　　　　　プレビュー時もマウスホイール時も表示がずれなくなった
　　　　リグマーク表示の修正
　　　　　マルチスレッドのフレーム番号合わせ
　　　　　マウスホイール回転でタイムラインのフレームを変化させたときに、リグ(Rig)マークとモデルの姿勢が描画１回分ずれていたのを修正

　　　
　　　アルファテストスライダー追加
　　　　ShaderプレートメニューにAlphaTestスライダーを追加
　　　　透明度がスライダー値より小さい場合にピクセル単位で描画をスキップする(アルファテスト)

　　　アルファテスト修正
　　　　アルファテスト時にシェーディングアルファ設定にも簡略計算にて対応
　　　　シェーディングアルファで透明度を設定しておいてからアルファテストスライダーを操作することにより
　　　　メッシュを明るい部分から徐々に出現させたり、暗い部分から徐々に消したりすることが可能
　　　　アルファテストで完全に消えた場合の跡地がDOFでボケるようになった　　　

　　　ブラシのスピーディー選択
　　　　3Dウインドウの何も無いところ(背景)を右クリックするとブラシ選択コンテクストメニューが出る
　　　　詳細な設定はBrusheParamsプレートメニューで行いますが、ブラシの種類をパッと変えたいときに便利

　　　選択中ブラシ名を表示
　　　　オイラーグラフのオイラー数値表示の並びに、選択中のブラシ名も表示


　　RC2:
　　　TestフォルダにBoySporty_2モデルを追加
　　　　新しいVRoidでモデルを出力し直して復活
　　　　顔のシェーディングが直った
　　RC3:
　　　OWPスライダーの修正
　　　　セパレータ内のスライダーの左ダブルクリックが効かなくなっていたのを修正
　　　　　ダブルクリック位置の数値を設定
　　　　セパレータ内の右ダブルクリックが効かなくなっていたのを修正
　　　　　アンドゥ
　　　　スライダードラッグ時につまみの位置が微妙にずれるのを修正
　　　　　クリック位置とつまみ位置のずれを保ったままドラッグによりスライドする
　　　　　修正により、つまみ中央をドラッグした場合にもつまみ位置とマウスと位置がぴったり合うことを確認
　　RC4:
　　　剛体マーク表示の修正
　　　　マルチスレッドのスロット番号合わせ
　　　　マウスホイール回転でタイムラインのフレームを変化させたときに、剛体マークとモデルの姿勢が描画１回分ずれていたのを修正
　　　　プレビュー時もマウスホイール時も表示がずれなくなった
　　RC5:
　　　リグマーク表示の修正
　　　　マルチスレッドのフレーム番号合わせ
　　　　マウスホイール回転でタイムラインのフレームを変化させたときに、リグ(Rig)マークとモデルの姿勢が描画１回分ずれていたのを修正
　　　　プレビュー時もマウスホイール時も表示がずれなくなった






2024/03/25
　README.mdのスクリーンショット(説明付き)を更新　

　DOF修正
　　DOFを有効にすると大きいポリゴンやラインオブジェクトの境界部分にボケない三角形が表示される不具合を修正
　　　SkyDOFの実装方法としてSkyオブジェクトのZを使うのではなく、サーフェスをZPRE_ZMAXで初期化することにした
　　　dof.fx内のテクスチャサイズが間違っていたのを修正
　　　DOFとRefPosの相性は改善したので両方をオンにすることも可能に.
　　　相性問題の原因を探る過程でCModelにGroundFlag追加、ChkInViewで無条件視野内の場合にもダミーカメラ距離設定、skyのレンダリングパイプライン修正



2024/03/24
　RefPosのときだけ半透明がブレンドされない不具合を修正
　　refpos時にもカメラからの距離でソートして描画
　　視野内判定、カメラ距離をrefpos分計算して保持

　　RefPosオン時にはDOF描画をスキップ
　　　RefPosオン時にDOFをオンにするとオブジェクトの境目部分に不透明の三角が多数表示されるのでDOFの方をオフ

　スキンメッシュのパイプラインステートのルートシグネチャのインデックスにミスがあったのを修正
　　RefPosの際に単一モデルの描画多重化が出来ていないことがあったようだ

　DOF描画時のアルファテストを修正
　　DOF時にアルベドテクスチャのアルファだけチェックしていたが、DiffuseTextureのアルファも簡略計算ながら考慮に入れた
　　アルファテストで完全に消えたときにDOFでボケるようになった



2024/03/23
　ブラシ選択をスピーディーに
　　3Dウインドウの何も無いところを右クリックするとブラシ選択コンテクストメニューが出ます
　　詳細な設定はBrushesプレートメニューで行いますが、ブラシの種類をパッと変えたいときに便利になりました



2024/03/22
　アルファテストの閾値を設定可能に.
　　ShaderプレートメニューにAlphaTestスライダーを追加
　　1.0.0.12ではAlbgedoTextureのアルファだけで判定していたが、AlbedoTextureAlpha x DiffuseTextureAlphaで判定.

　RefPosのときだけ半透明がブレンドされない件を調査
　　描画前にソートしていないことが原因
　　後で対応予定




2024/03/20
　AdditiveIK 1.0.0.12 release
　　1.0.0.11からの変更点
　　　不具合修正
　　　　マルチスレッド処理修正
　　　　　マルチスレッドのスロット合わせし直し
　　　　　以前はループの最後と最初の部分で部分的に形状が伸びることがあったがその症状は解消した
　　　　　レンダリング中に姿勢計算をしても表示が乱れなくなった
　　　　シェーダーコンパイルエラー時にabortするように.
　　　　　ユーザーがシェーダーをいじることも想定
　　　　　エラーの時にはアプリを終了
　　　　　シェーダーにミスがあった場合(例えばfxファイルに全角スペース１個入っていた場合)にアプリとWindowsOSが固まる不具合を解消


　　　拡大、回転、移動の必要なものだけペースト
　　　　操作対象ボーン設定ダイアログに機能追加
　　　　ペーストショートカットボタンを右クリックで出る操作対象ボーン設定ダイアログに機能追加
　　　　PasteScale, PasteRotation, PasteTranslationの３つのチェックボックスを追加
　　　　スケール(拡大縮小)、ローテーション(回転)、トランスレーション(移動)の中の必要なものだけチェックしてペースト
　　　　SRT３つの組み合わせも可能

　　　ジャンプ補間ボタン
　　　　Hipsジャンプ補間ボタンを追加
　　　　上段カエルボタンを押したときに、補間ボタンの左隣にジャンプ補間ボタンを追加
　　　　選択フレーム範囲の最初フレームと最後フレームのHipsの移動アニメを放物線で補間する
　　　　最後のフレームでちょうど着地するように機能
　　　　ボタンを押したときに、ジャンプ補間用の重力設定ダイアログ(再計算ボタン付き)を表示

　　　常用スライダーを常駐
　　　　アプリ上部に常駐スライダーを追加
　　　　EditRateスライダー、Speedスライダー、TopPosスライダーを常駐ウインドウに配置していつでも操作可能に
　　　　TopPosスライダーの横幅が長くなったのでブラシのピーク位置の設定精度が上がった(長い分、目盛りが細かくなった)
　　　
　　　被写界深度(Depth of Field)対応
　　　　DOFプレートメニュー新規
　　　　ボカシ始め距離、ボカシ完了距離、SkyDof(天球にもボカシを入れるかどうか)の設定
　　　　８スロット分設定可能

　　　フォグ対応
　　　　Fogプレートメニュー新規
　　　　カメラ距離フォグと高さフォグに対応
　　　　フォグ色も指定可能　
　　　　８スロット分設定可能　　　　

　　　Skyプレートメニュー新規
　　　　８スロット分設定可能

　　　アルファテスト
　　　　ピクセルシェーダ内でテクスチャのアルファが0x08より小さい場合に書き込みをスキップ
　　　　書き込みスキップ時はZバッファにも描画されないのでテクスチャ抜きが綺麗に.
　　　
　　　シェーディングアルファ
　　　　BaseAのスライダーでマテリアルの透明度を設定可能
　　　　HiA,LowAも設定可能
　　　　マテリアルごとに
　　　　光の当たり方(シェーディング)によってアルファ(透明度)を徐々に変化させることが可能

　　　DispAndLimitsプレートメニューにAlphaBlendingチェックボックスを追加
　　　　アルファテストだけのアルファ抜き表示の時はオフ、ブレンドしたい場合にオン
　　　　オンにした場合にはZバッファのクリア１回分処理が増える

　　　ドキュメント追記
　　　　Documents/TroubleShooting/0_HowToSetShadowParams.docx
　　　　


　　RC2 : 
　　　　ScreenShotsフォルダに1.0.0.12の新機能に関するスクリーンショットを追加
　　　　追記：Documents/TroubleShooting/0_HowToSetShadowParams.docx　　　
　　RC3 : 
　　　　Sky,Fog,DOFダイアログがメインメニューバーの表示(disp)を操作しても出ないことがあった不具合修正
　　　　　プレートメニューからは出ていたが、メインメニューバーからは出ないことがあった
　　　　　プレートメニュー、メインメニューバー両方から表示できるように修正
　　　　README.mdで参照していた画像のリンク切れ修正
　　　　　RC2での整理の際に消し過ぎていたのを復活
　　RC4 :
　　　　マルチスレッドスロット番号処理に不具合があったので修正
　　　　　表示にだけ影響
　　　　　RefPosが表示されない不具合から発覚して修正
　　　　　RefPosの表示に関して
　　　　　　DOFオンの時にゴーストが消えたり、手前に表示するものがあるとブレンドされずに消えたりする問題あり
　　　　　　すぐには解決できないので次バージョン以降の課題として持ち越す




2024/03/18
　Shaderプレートメニューのマテリアルのアルファスライダーが機能するように.
　　BaseAのスライダーでマテリアルの透明度を設定可能
　　HiA,LowAも設定可能 : 光の当たり方によってアルファ(透明度)を徐々に変化させることが可能

　DispAndLimitsプレートメニューにAlphaBlendingチェックボックスを追加
　　アルファテストだけのアルファ抜き表示の時はオフ、ブレンドしたい場合にオン
　　オンにした場合にはZバッファのクリア１回分処理が増える

　Sky, Fog, DOFをプレートメニュー化
　　覚えやすいアクセス法、簡単アクセスに.
　　Skyに関しては設定ダイアログが大きくて右ペインに収まらないのでそのまま出すように.




2024/03/17
　アルファテスト
　　ピクセルシェーダ内でテクスチャのアルファが0x08より小さい場合に書き込みをスキップ
　　書き込みスキップ時はZバッファにも描画されないのでテクスチャ抜きが綺麗に.

　カメラアニメのMOTINFOについてもアクセスをカプセル化

　常駐スライダーによるサイズ変更の影響でウインドウに微妙に余白が出来ていたのを修正

　シェーダーコンパイルエラー時にabortするように.
　　エラーの時にはアプリを終了
　　シェーダーにミスがあった場合(例えばfxファイルに全角スペース１個入っていた場合)にアプリとWindowsOSが固まる不具合を解消




2024/03/16
　MOTINFO構造体へのアクセスをカプセル化
　　MOTINFO構造体のポインタへのアクセスはCModelからに限定し、他からのアクセスに対しては値を返すように.
　　Get,Set用の関数を追加

　README.mdに新しいスクリーンショットを追加


2024/03/15
　被写界深度(Depth of Field)対応
　　DispAndLimitsプレートメニューのZPrepassとHDRBloomにチェックを入れるとDOFが機能する
　　現在はカメラからの距離が3000からボケ始めて距離6000で最大のボケになる
　
　DOFパラメータ設定画面
　　メインメニューバーに　表示(disp)-->被写界深度設定(DOF Params)メニューを追加
　　ボカシの開始距離とボカシの終了距離を指定
　　天球にもボカシを掛けるかどうかのチェックボックスも追加
　　　ステージが無い場合に天球にボカシを掛けると、ボカシ距離より近いキャラクターにもボケが掛かります

　2024/3/13の修正で物理シミュ時にエンドジョイントの表示フレームが他のジョイントの表示フレームとずれていた
　　修正済


2024/03/14
　フォグ対応
　　メインメニューバーに　表示(disp)-->フォグ設定(FogParams)メニューを追加
　　カメラ距離フォグと高さフォグに対応
　　フォグ色も指定可能　
　
2024/03/13
　マルチスレッド表示の同期の仕方を再び修正
　　3/12の修正は表示速度が遅かったので、以前の方法で表示が乱れないように修正した
　　以前はループの最後と最初の部分で部分的に形状が伸びることがあったがその症状は解消した
　　レンダリング中に姿勢計算をしても表示が乱れなくなった

　マルチスレッド処理によりボーンマーク剛体マークの位置が１フレームずれていたのを修正
　　レンダースロットの姿勢の位置で計算するように.


2024/03/12
　Hipsジャンプ補間ボタンを追加
　　上段カエルボタンを押したときに、補間ボタンの左隣にジャンプ補間ボタンを追加
　　選択フレーム範囲の最初フレームと最後フレームのHipsの移動アニメを放物線で補間する

　　ボタンを押したときに、ジャンプ補間用の重力設定ダイアログ(再計算ボタン付き)を表示

　アプリ上部に常駐スライダーを追加
　　EditRateスライダー、Speedスライダー、TopPosスライダーを常駐ウインドウに配置していつでも操作可能に
　　TopPosスライダーの横幅が長くなったのでブラシのピーク位置の設定精度が上がった(長い分、目盛りが細かくなった)
　　
　表示の同期の仕方を修正
　　マルチスレッド処理についても処理ごとに同期することにした
　　大きく動く場合にも表示が乱れなくなった


2024/03/11
　操作対象ボーン設定ダイアログに機能追加
　　ペーストショートカットボタンを右クリックで出る操作対象ボーン設定ダイアログに機能追加
　　PasteScale, PasteRotation, PasteTranslationの３つのチェックボックスを追加
　　スケール(拡大縮小)、ローテーション(回転)、トランスレーション(移動)の中の必要なものだけチェックしてペースト
　　SRT３つの組み合わせも可能
　


2024/03/08
　AdditiveIK 1.0.0.11 release
　　1.0.0.10からの変更点
　　　不具合修正
　　　　インスタンシング描画修正
　　　　　プリミティブ数指定を修正
　　　　　直す前は、デバッグビルド実行時に警告が出ることがあったようだ

　　　　Shaderプレートメニュー修正
　　　　　見出しボタンを押した後にShaderTypeを変更した場合に
　　　　　最後のマテリアルの３文字タイプ表記が変わらない不具合を修正
　　　　　(設定はされていた)

　　　　fbxに四角形が含まれていた場合に警告ダイアログを出すように.
　　　　　エラーにはならないが４点目の法線を読み込んでいないので警告ダイアログを出した.
　　　　　ワーニングは１ノードに付き１回まで.

　　　　起動時のウインドウ大小選択ダイアログでキャンセルしてアプリを終了した場合に
　　　　　メモリリークしていたのを修正

　　　　法線マップとメタルマップのサンプラー修正
　　　　　複数アセットで確認したが、albedoとnormalとmetalはセットで切り替えるようだった
　　　　　normalとmetalのサンプラーにもalbedoのサンプラーを使用することにした
　　　　　TheHuntStreet1の地面の凸凹が改善した


　　　マテリアルごとに影を落とさない設定を可能に
　　　　ShaderプレートメニューにShadowCasterチェックボックス追加
　　　　天井や壁や仕切りカーテンなどに対してShadowCasterのチェックをオフにすることで狭い場所にもきれいに影が落ちやすくなった

　　　２番目のトークンで類似チェックオンオフを可能に
　　　　DispGroupプレートメニューのSimilarチェックをアップデート
　　　　メッシュ名を右クリックで出るコンテクストメニューに2nd ON, 2nd OFFを追加
　　　　_で区切られたメッシュ名の２つ目の_の後のトークンを元に処理
　　　　例えば、Model_tree_1というメッシュに対して2nd ONを実行するとModel_tree_2, Model_tree_3などがチェックオンになります

　　　ShaderプレートメニューにLightingチェックボックス追加
　　　　チェックオフ時にはライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示
　　
　　　DispAndLimitsプレートメニューのEnableLightチェックをオフにした場合は
　　　　シーン全体に対してライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示

　　　天球表示をオプションに
　　　　DispAndLimitsプレートメニューにSkyDispチェックボックスを追加

　　　天球マテリアル設定機能追加
　　　　アプリ上部のメインメニューバーの表示(disp)-->天球設定(SkyParams)メニュー選択でダイアログ表示
　　　　設定はアプリ終了時自動保存、アプリ起動時自動読込

　　　UVの繰り返し回数設定
　　　　ShaderプレートメニューにTilingU, TilingVのスライダーを追加
　　　　スライダー設定をリアルタイムでテクスチャの繰り返し回数として適用
　　　　Albedoテクスチャ, Normalテクスチャ, Metalテクスチャすべてに影響
　　　　fbxファイルのUVScalingに保存して読み込み
　　　　UVScalingはMayaとUnityでは現在は無視されているようにみえる
　　　　fbxの正式なtiling回数の保存読み込みに関しては不明

　　　CameraDistスライダーの最大値を1000から5000に変更


　　RC2:
　　　起動時のウインドウ大小選択ダイアログでキャンセルしてアプリを終了した場合に
　　　メモリリークしていたのを修正
　　RC3:
　　　ShaderプレートメニューのHSVスライダーなどが機能しなくなっていたのを修正
　　　　DlgProcで設定中に初期化されていたのが原因だった(今回のバージョン用の修正にて出ていた不具合)
　　　法線マップとメタルマップのサンプラー修正
　　　　複数アセットで確認したが、albedoとnormalとmetalはセットで切り替えるようだった
　　　　normalとmetalのサンプラーにもalbedoのサンプラーを使用することにした
　　　　TheHuntStreet1の地面の凸凹が改善した
　　　CameraDistスライダーの最大値を1000から5000に変更
　　　ShaderメニューとDispGroupメニューでPick&Set中にはボーンをピックしないように修正
　　　　Pick&Set中にクリック位置近くにボーンがある場合に設定が出来なくなっていたため
　　　fbx読み込み時にUVScaleの最小値を1.0として読み込むように
　　RC4:
　　　fbx読み込み時にマテリアルが無い場合にもERROR: MaterialNum Overflowの警告が出ていたのを修正
　　　　モーションキャプチャのモーションだけのfbxの読み込み時に要らない警告が出ていた
　　　　今回のバージョン用の修正により起きていた不具合

　　　




2024/03/07
　インスタンシング描画修正
　　プリミティブ数指定を修正
　　直す前は、デバッグビルド実行時に警告が出ることがあったようだ

　ShaderプレートメニューにLightingチェックボックス追加
　　チェックオフ時にはライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示
　　
　　DispAndLimitsプレートメニューのEnableLightチェックをオフにした場合は
　　シーン全体に対してライトの向きを考慮しない白い拡散色とマテリアルテクスチャで表示

　天球マテリアル設定機能追加
　　アプリ上部のメインメニューバーの表示(disp)-->天球設定(SkyParams)メニュー選択でダイアログ表示
　　設定はアプリ終了時自動保存、アプリ起動時自動読込



2024/03/05
　UVの繰り返し回数設定
　　ShaderプレートメニューにTilingU, TilingVのスライダーを追加
　　スライダー設定をリアルタイムでテクスチャの繰り返し回数として適応
　　Albedoテクスチャ, Normalテクスチャ, Metalテクスチャすべてに影響
　　fbxファイルのUVScalingに保存して読み込み
　　UVScalingはMayaとUnityでは現在は無視されているようにみえる
　　fbxの正式なtiling回数の保存読み込みに関しては不明


2024/03/04
　Shaderプレートメニュー修正
　　見出しボタンを押した後にShaderTypeを変更した場合に
　　最後のマテリアルの３文字タイプ表記が変わらない不具合を修正
　　(設定はされていた)

　　マテリアルの最大数は1000個だが一時的に4個に変えてみてオーバーフロー時の処理を修正
　　エラーダイアログを出して、ショートカット一覧ウインドウに切り替えるようにした
　　修正後に元の1000個に戻した

　天球表示をオプションに
　　DispAndLimitsプレートメニューにSkyDispチェックボックスを追加
　　
　　こちらの環境では
　　freefpsオン時に３D画面上部にティアリングによる横線が表示されているのが確認された
　　更に調べてみたところ、黒色の横線はSkyDispオンオフに関わらずY12位の位置に表示されていた
　　画面上部上からY24までの部分に黒いアッパーバーを表示することにより、ティアリングに気が付かないようにすることが出来た
　　

2024/03/03
　ShaderプレートメニューにShadowCasterチェックボックス追加
　　天井や壁や仕切りカーテンなどに対してShadowCasterのチェックをオフにすることで狭い場所にもきれいに影が落ちやすくなった

　複数モデルを含むプロジェクトファイル読み込み時やモデル切り替え時に、カレントボーン番号(選択中のボーンの番号)を初期化
　　NULLチェックはしていたのでエラーにはなっていなかったが、デバッグビルドのポインタ確認箇所でASSERTしていたので修正
　　
　fbxに四角形が含まれていた場合に警告ダイアログを出すように.
　　エラーにはならないが４点目の法線を読み込んでいないので警告を出した.
　　ワーニングは１ノードに付き１回まで.


2024/03/02
　天球(sky)モデルを表示
　　透過テクスチャの奥に空が表示されるように天球は最初にレンダーするように.
　　Media/CelestialSphereフォルダに天球データを置くことにした.フォルダ内のReadMe.txtを参照.
　　
　DispGroupプレートメニューのSimilarチェックをアップデート
　　メッシュ名を右クリックで出るコンテクストメニューに2nd ON, 2nd OFFを追加
　　_で区切られたメッシュ名の２つ目の_の後のトークンを元に処理
　　例えば、Model_tree_1というメッシュに対して2nd ONを実行するとModel_tree_2, Model_tree_3などがチェックオンになります

　　

2024/02/29
　ショートムービー
　　半回転階段チャレンジ
　　https://youtu.be/TzlAqf45jIQ



2024/02/27
　AdditiveIK 1.0.0.10 release
　　1.0.0.9からの変更点
　　　不具合修正
　　　　シャドウカメラの計算を修正
　　　　　思った通りになっていなかったのを修正
　　　　ピック&セットの不具合修正
　　　　　DispGroupプレートメニューにおいて、クリックしてもGUI上で選択メッシュが自動選択されないケースがある不具合修正
　　　　　選択メッシュをみつけた場合のbreak抜けにより自動選択されないケースがあった
　　　　OWP_Sliderの修正
　　　　　スライダー上のクリック位置からの移動量でスライドする機能の修正
　　　　　スライダーがセパレータの右側にある場合に計算が間違っていたのを修正
　　　　Testフォルダのモデル更新
　　　　　新しいVRoidのモデルはStdシェーダで表示しても顔の中央に白いラインが出ないので、今後は新しいVRoidのモデルを使用する
　　　　　2/22のモーキャプ＠夕暮れキッチン(https://youtu.be/pMRaTOw5B38)のモデルを新規
　　　　　スカートに剛体設定してスカートのシミュをオンに設定
　　　　　ジャンプした際にスカートががめくれないようにするにはこちらではDispAndLimitsメニューのSpeedを0.5に.　
　　　　Rigの軸がドラッグ開始姿勢に依存していた問題解決
　　　　　ジョイントドラッグのIKはうまくいっていたがRigで問題が出ていた
　　　　　Rigの軸としてNodeX, NodeY, NodeZのどれかを選ぶことで動作が安定
　　　　　ただしfbxのジョイントに適切な初期姿勢が設定されていることが前提
　　　　　初期姿勢が設定されていない場合にNodeX, NodeY, NodeZを指定するとボーン軸ではなくグローバルXYZの回転になってしまう
　　　　　新しいVRoidのモデルではうまくいっているようだ
　　　　DispGroupメニューのメッシュ名右クリックからのSimilarON,OFFの修正
　　　　　処理関数を書き直し
　　　　　先頭に'_'があってもうまくいくようになった
　　　　DispGroupメニューの項目の選択処理が重すぎたのを修正
　　　　　プログラムからの項目選択時にも項目選択リスナーを呼び出していたのを呼び出さないように修正
　　　　カメラドリーダイアログの修正
　　　　　カメラドリーダイアログを出したときにカメラの位置が変わってしまわないように修正
　　　　　(保存したいカメラ画面にしてからダイアログを出す場合に画面が変わると困るから)

　　　カメラターゲットに関わるGUIを右ペインの上のウインドウに常駐
　　　　Lock2Jointチェックボックス : 選択中のジョイントをカメラの注視点にする
　　　　DispTargetチェックボックス : カメラターゲットの位置にマニピュレータと位置座標の数値を表示する
　　　　CamDistスライダー : カメラの視点と注視点の距離を設定する
　　　　MoveEyePosチェックボックス : オフの時スライダー操作時に注視点を移動、オンの時スライダー操作時にカメラ位置を移動.
　　　　CamDistスライダーで注視点を前後させて、カメラの回転の中心を設定することが可能
　　　　MoveEyPosチェックとスライダーの組み合わせで、尺取虫の様にカメラを操作することも可能
　　　　注視点はカメラを回転する場合の回転中心になる

　　　
　　　ファイルオープンダイアログを通常のエクスプローラタイプに変更
　　　　エクスプローラタイプに変更するとファイルを選択しやすい
　　　　しかし
　　　　現状のゲームパッド対応コードでは目的のGUIコントロールを取得することが出来なかった
　　　　(ゲームパッドでオープンダイアログのボタンを押すことが出来ない)
　　　　ゲームパッド対応はモーション遷移テストやキャラクターの移動などに限定して使用していく予定
　　　　ゲームパッド対応時にもマウスは必要という方針に変更
　　　　どうしてもゲームパッドでファイルを開く必要が生じた場合には、ゲームパッドでピック可能なオープンダイアログを作ることになる
　　　　ver1.0.0.10時点では一時的にゲームパッド対応コードをコメントアウトしている
	
　　　LightsプレートメニューのGUI改良
　　　　ライトの方向を設定するためのGUIを極座標表現に変更
　　　　角度２つで設定可能なのでベクトル指定よりも直感的に設定することが可能
　　　　内部データと読み書き用ファイルは向きベクトルのまま
　　　　極座標のXZの角度は本来はX軸方向だが、アプリ起動時のカメラの向きに合わせてZ軸方向を0度にした
　　　　GUIでの角度の数値の小数第２位以降は誤差ですが、表示桁数を減らすと余計に誤差が大きくなるので小数４桁表示しています
　　　
　　　マニピュレータ表示修正
　　　　回転モードのときにはリングも表示
　　　　移動モード、拡縮モードの時には軸だけ表示

　　　DispGroupメニューにClearボタンを追加
　　　　メッシュ名のチェックマークをクリアするボタン

　　　ドキュメント追加
　　　　Documents/TroubleShooting/0_HowToSetPhysicsOfSkirt.docx
　　　　Documents/TroubleShooting/0_HowToSetShadowParams.docx
　　　　Documents/TroubleShooting/0_Win32DialogHasABlackFrame.docx

　　RC1: 
　　　右ペイン上部のカメラターゲットウインドウにMoveEyePosチェックボックスを追加
　　　オンにするとスライダー操作時にカメラ位置を移動、オフにするとスライダー操作時に注視点を移動
　　　MoveEyePosチェックボックスとCamDistスライダーで尺取虫のようにカメラを操作することが可能
　　　注視点はカメラを回転する場合の回転中心になる
　　RC2:
　　　カメラドリースプライトのドラッグが効かなくなっていたのを修正
　　　CameraTargetウインドウのDispTargetにチェックを入れている間はターゲット位置に座標のツールチップを表示
　　RC3:
　　　DispGroupメニューのメッシュ名右クリックからのSimilarON,OFFの修正
　　　　処理関数を書き直し
　　　　先頭に'_'があってもうまくいくようになった
　　　DispGroupメニューにClearボタンを追加
　　　　メッシュ名のチェックマークをクリアするボタン
　　　DispGroupメニューの項目の選択処理が重すぎたのを修正
　　　　プログラムからの項目選択時にも項目選択リスナーを呼び出していたのを呼び出さないように修正
　　　カメラドリーダイアログの修正
　　　　カメラドリーダイアログを出したときにカメラの位置が変わってしまわないように修正
　　　　(保存したいカメラ画面にしてからダイアログを出す場合に画面が変わると困るから)
　　RC4:
　　　Testフォルダのモデルの設定ファイルを修正
　　　　新しいモデルのtboファイル(操作対象ボーン設定ファイル)が未設定だったのを修正
　　release:
　　　Lightsメニューの角度Yの符号が反転する不具合を修正
　　　　符号が反転してしまった数値は自動的には直りません


動画
　　モーキャプ＠夕暮れキッチン
　　https://youtu.be/pMRaTOw5B38

　 【ショート】ピッチャーと棒【モーキャプ】
　　https://youtu.be/WG7QEvYetJg

　 【モーキャプ】VRoidでプロのアセットを飛んでみた【編集ツール】
　  https://youtu.be/R0MsXt8plYg

  ver1.0.0.4以降共通
　　新機能の使い方まとめ動画
　 　【DirectX12】AdditiveIK新機能【モーキャプ編集】
 　 　https://youtu.be/oKGY62YosSg





2024/02/26午前
　カメラターゲットに関わるGUIを右ペインの上のウインドウに常駐
　　Lock2Jointチェックボックス : 選択中のジョイントをカメラの注視点にする
　　DispTargetチェックボックス : カメラターゲットの位置にマニピュレータを表示する
　　CamDistスライダー : カメラの視点と注視点の距離を設定する

　　CamDistスライダーで注視点を前後させて、カメラの回転の中心を設定することが可能
　　
　マニピュレータ表示修正
　　回転モードのときにはリングも表示
　　移動モード、拡縮モードの時には軸だけ表示

　OWP_Sliderの修正
　　スライダー上のクリック位置からの移動量でスライドする機能の修正
　　　スライダーがセパレータの右側にある場合に計算が間違っていたのを修正



2024/02/25
　ドキュメント追加
　　Documsnts/TroubleShooting/0_HowToSetShadowParams.docx
　　Documsnts/TroubleShooting/0_Win32DialogHasABlackFrame.docx
　
　シャドウのシャドウカメラ位置の計算を大幅修正
　　思った通りになっていなかったのを修正
　　設定の仕方はDocumsnts/TroubleShooting/0_HowToSetShadowParams.docxに記述



2024/02/24
　ドキュメント追加
　　　　Documsnts/TroubleShooting/0_HowToSetPhysicsOfSkirt.docx

　ピック&セットの不具合修正
　　DispGroupプレートメニューにおいて、クリックしてもGUI上で選択メッシュが自動選択されないケースがある不具合修正
　　　選択メッシュをみつけた場合のbreak抜けにより自動選択されないケースがあった

　ファイルオープンダイアログを通常のエクスプローラタイプに変更
　　エクスプローラタイプに変更すると
　　　ファイルを選択しやすい
　　　しかし
　　　現状のゲームパッド対応コードでは目的のGUIコントロールを取得することが出来なかった
　　　ゲームパッド対応はモーション遷移テストやキャラクターの移動などに限定して使用していく予定
　　　ゲームパッド対応時にもマウスは必要という方針に変更
　　　どうしてもゲームパッドでファイルを開く必要が生じた場合には、ゲームパッドでピック可能なオープンダイアログを作ることになる
　　　2024/02/24時点では一時的にゲームパッド対応コードをコメントアウトしている
	
　LightsプレートメニューのGUI改良
　　ライトの方向を設定するためのGUIを極座標表現に変更
　　内部データと読み書き用ファイルは向きベクトルのまま
　　極座標のXZの角度は本来はX軸方向だが、アプリ起動時のカメラの向きに合わせてZ軸方向を0度にした
　　GUIでの角度の数値の小数第２位以降は誤差ですが、表示桁数を減らすと余計に誤差が大きくなるので小数４桁表示しています



############
## 備考002
############
　右ペインのWin32ダイアログに黒い枠表示が付いてしまう件
　　ウインドウの背景色は本来はプログラムごとにいじるものではないらしい
　　WindowsのユーザがWindowsの設定画面を使ってテーマと背景色を設定するのが本来のやり方とのこと
　　設定の仕方としてはWindows11においては以下のようだった
　　　設定-->アクセシビリティ-->コントラストテーマ-->夜空-->適用する
　　上記設定をするとWindows11全体としてウインドウの背景色が黒になる
　　ショートカットでテーマのオンオフも可能
　　　左Alt + 左Shift + PrintScreenでテーマをオンオフ





2024/02/23
　Testフォルダのモデル更新
　　新しいVRoidのモデルはStdシェーダで表示しても顔の中央に白いラインが出ないので、今後は新しいVRoidのモデルを使用する
　　2/22のモーキャプ＠夕暮れキッチンのモデルを新規
　　スカートに剛体設定してスカートのシミュをオンに設定
　　ジャンプした際にスカートががめくれないようにするにはこちらではDispAndLimitsメニューのSpeedを0.5に.　

　Rigの軸がドラッグ開始姿勢に依存していた問題解決
　　ジョイントドラッグのIKはうまくいっていたがRigで問題が出ていた
　　Rigの軸としてNodeX, NodeY, NodeZのどれかを選ぶことで動作が安定
　　ただしfbxのジョイントに適切な初期姿勢が設定されていることが前提
　　初期姿勢が設定されていない場合にNodeX, NodeY, NodeZを指定するとボーン軸ではなくグローバルXYZの回転になってしまう
　　新しいVRoidのモデルではうまくいっているように思う(詳しくは調べてはいない)



2024/02/22夜
　ショートムービー
　モーキャプ＠夕暮れキッチン
　https://youtu.be/pMRaTOw5B38




2024/02/22
　AdditiveIK 1.0.0.9 release
　　1.0.0.8からの変更点
　　　不具合修正
　　　　ノーマルマップを小さく表示するとモアレが出る不具合修正
　　　　ノーマルマップだけMipMapを0に固定していたのが原因
　　　AdditiveIKの方向性としてトゥーンベースに
　　　　全てのシェーダ(PBR, Std. Toon)において拡散色のシェーディング時にHSV_Toonを参照するように.
　　　　黒くなるシェーディングではなく
　　　　色相を保ちながらまたは色相を変化させながらHSVのVが小さくなるシェーディングが可能.
　　　　ベースとなるToon設定としてグラデーションとパワートゥーンを追加.
　　　　顔の陰が綺麗に出るようにNormalY0チェックボックスを追加.
　　　　SpecularCoefスライダでスペキュラーの倍率をマテリアルごとに設定可能に.
　　　Q2Eul_Thresholdプレートメニューを追加
　　　　Retargetメニューの並びに配置.
　　　　リターゲット時、fbx入出力時と姿勢をオイラー角に変換する計算時に使用する閾値の調整が可能.
　　　Rigidプレートメニューの各項目の右にToDeeperボタンを追加
　　　　選択剛体の全ての子供の剛体に対してカレント値をコピペ.
　　　　例えば手の甲に物理パラメータ設定をしてToDeeperボタンを押すと子供の指剛体全部にコピペされる.
　　　ドキュメント追加
　　　　Documsnts/TroubleShooting/0_HowToSettingsAboutShaders.docx
　　　　Documsnts/TroubleShooting/0_ThresholdSettingForFlipMotionCorrection.docx

　　　RC2: 
　　　　ウインドウ小モードにおける各種ダイアログの大きさ調整. 見切れすれすれのものが多数あったので対応.
　　　　Q2Eul_ThreasholdプレートメニューにDefaultValueボタンを追加.　数値が分からなくなった時用.
　　　　法線マップとメタルマップのサンプラーのフィルターをMIP_POINTに変更. ぼけ過ぎないように.
　　　　UV0とUV1の切り替えテストのためのUVSet決め打ちコードが残っていたのを修正.　fbxの元のものを読まないと正しく直らないことも有り.
　　　　ScreenShotフォルダの中身を新しいSSに更新.
　　　　TestフォルダのモデルのShader設定を更新.　体はStd.　顔だけToonLit2でY0フラグオン.　顔のセンターの法線の具合がStd.で光るので対策.
　　　RC3:
　　　　TestフォルダのSpringモデルとWinterモデルの顔シェーダの再調整
　　　release:
　　　　TestフォルダのSpringモデルとWinterモデルの顔シェーダの再調整
　　　　(DispAndLimitsプレートメニューのライト倍率(全てのライト対してに掛ける倍率)が違うと見え方がかなり変わるので、設定時にはライト倍率を確認)





2024/02/21午前
　【ショート】ピッチャーと棒【モーキャプ】
　　https://youtu.be/WG7QEvYetJg

　　

2024/02/20
　Rigidプレートメニューの各項目の右にToDeeperボタンを追加
　　選択剛体の全ての子供の剛体に対してカレント値を設定するボタン

　Retargetプレートの並びにQ2Eul_Thresholdプレートメニューを追加
　　リターゲット時、fbx入出力時と姿勢をオイラー角に変換する計算時に使用する閾値の調整が可能
　　例えばリターゲット結果の頭の向きが１８０度裏返ることが稀にありますが
　　Q2Eul_thresholdメニューのEndJoint閾値を調整する(オイラーグラフをみながら推定して変更する)ことで直ることが多いです
　　モーションキャプチャは測定値であり誤差も様々なので閾値も臨機応変に変える必要があります
　　設定した閾値の値はアプリ終了時に保存されて起動時に自動で読み込みます
　　それでも直らないことがありますが、その場合にはオイラーグラフをみながらLimitEulをオンにしてダイアログで制限角度を設定すると緩和されます




2024/02/19
　README.mdにシェーダまとめの図を追加

　ShaderプレートメニューにGUI追加
　　SpecularCoefスライダ：マテリアルごとにスペキュラー倍率を指定
　　NormalY0チェックボックス：トゥーンテクスチャ参照計算時の法線のY成分をキャンセルするかどうかのフラグ
　　　デフォルト値はスキンメッシュでオン、非スキンメッシュでオフ
　　　モデルの顔のシェーディングの際にきれいに陰色を付けるために法線のY成分を0として計算するためのもの


2024/02/18
　HSV_Toon改良
　　ShaderプレートメニューにPowerToonチェックボックスを追加
　　Gradationチェック時の色の補間もHSVで行うように.
　　PowerToonチェック時にはLow-->Base, Base-->Highの補間にpowを使用.
　　Gradationチェックをオフにした場合にはPowerToonチェックボックスは無効に.
　　プロジェクト保存と読み込み時にGradationとPowerToon設定も保存と読み込み.

    シェーダを好みに近づけていく作業
　　　キャラクター(VRoid)はベタ塗という路線において、リアルな背景アセットについてもおかしくないようにトゥーン化する必要がある.
　　　全てのシェーダをトゥーンベースに.
  　　Std.シェーダとPBRシェーダのライトループ中の拡散色計算にもHSV_Toonを使用.
　　　Std.シェーダは実質ライト８個(ライト色も反映)までのトゥーンシェーダ(HSV_Toon)になった.
　　　PBRシェーダはも同様に実質ライト８個(ライト色も反映)までのHSV_Toon.
　　　PBRシェーダの場合には法線マップが考慮されてSmoothCoefスライダー設定が有効.
　　　HSVToonシェーダ単体としてはトゥーンテクスチャ設定用なので白色ライト１個のトゥーンシェーダ.

　PBRの法線マップが小さい画面でモアレ表示になる不具合修正
　　法線マップだけLOD読み込み用の関数でLOD_0を指定して読み込んでいたため



2024/02/17
　HSV_ToonにGradation(グラデーション)追加
　　ShaderプレートメニューにGradationチェックボックスを追加
　　Gradationをオンにすると滑らかにトゥーン色を変化させる
　　変化のさせ方はまだ確定していない.　とりあえず線形補間からスタート.
　　初期状態でGradationオン.


2024/02/17
　AdditiveIK 1.0.0.8 release
　　1.0.0.7からの変更点
　　　能動的デストラクトとメモリリーク解消
　　　　Direct3Dオブジェクトをメンバに持つ自動変数、static変数、global変数の解放を能動的に行った
　　　　アプリ終了時に自動開放を待たずに能動的にデストラクトすることによりリークしていたメモリを把握出来て修正することが出来た
　　　　ダンプにおいてDebugDevice以外のRefcountが0になった(IntRefには何か書いてあるが問題ないらしい)
　　　　メモリリークは解決したようだ
　　　TOONシェーダ対応(HSV_Toon)
　　　　NOLIGHTシェーダをTOONシェーダに変更
　　　　Shaderプレートメニューでマテリアル名のボタンを押してToonを選択すると機能
　　　　TOON用のライトとしてはLightプレートメニューのライトの向きを使用
　　　　マテリアルの拡散色から自動的にTOONテクスチャを作成しdiffuseMapとしてシェーダで使用
　　　　設定画面
　　　　　Shaderプレートメニューで設定
　　　　　面の向きとToon用ライトの向きが同じ向きを向いているほどHiAddr,LowAddrのスライダーは右側にします
　　　　　HiAddrよりも向きが同じ方向の場合にはハイライト色、LowAddrよりも向きが違う場合には陰色、どちらでもない場合にはベース色を表示
　　　　　トゥーンの色の設定はHSVで行います
　　　　　HSVのHは色相で0から360の数値をとります.　Sは彩度で0から1、Vは輝度で0から1.
　　　　　Base色はHSVの数値そのものを指定.
　　　　　AddH, AddS, AddVはベース色のHSVに加える分(引くときはマイナスの数値を指定)の数値を指定.
　　　　　各設定項目にはGUIスライダー有り
　　　　　プロジェクト保存時に*.stfファイルにテキスト保存、プロジェクト読み込み時に自動読込
　　　PBR, StdのdiffuseMap参照の際にもHSV_Toonのテクスチャを参照
　　　PBRの法線修正
　　　　法線マップが無い場合には頂点法線を使用するように.
　　　　法線マップが無いメッシュにPBRシェーダを選んでもそれなりに表示されるように.
　　　NumKeyピッキング
        ShaderプレートメニューとDispGroupプレートメニュー時のピック処理修正
　　　　オブジェクトの中心がカメラから一番近いオブジェクトをピックしていました.
　　　　オブジェクトの形状によっては意図したオブジェクトがピック出来ないことがありました.
　　　　1-9の番号を押しながらピックすることでカメラから番号番目に近いオブジェクトをピックするようにしました.
　　　　処理の高速化のために距離の順番はカメラとオブジェクト中心との距離、見つかった時点ですぐに結果を返す仕様.
　　　　現在は非スキンメッシュだけがピック対象(これも高速化のため).
　　　1オブジェクトだけのテスト表示機能
　      DispGroupプレートメニューのTestボタンが機能していなかったのを修正
　　　Rigスプライトの画像ファイル更新
　　　　見やすく
　　　ZPreCullingをデフォルトでオフ
　　　　ZPreによる効果よりも不具合の方が多くなってきたため.
　　　RefPosの選択ジョイント軌跡表示修正
　　　　カレントフレームの選択ジョイント位置も軌跡に含めるように.
　　　TestフォルダのモデルのShader設定を修正
　　

    ###############################
　　###  HSV_Toon設定時の注意  ####
    ###############################
　　　HSV_ToonにはRGBとHSVの変換計算が関係しています
　　　Windowsに付いているペイントというソフトで色作成ボタンを押して
　　　色の種類をRGBからHSVに変えてから色の位置をいろいろクリックすると分かるのですが。
　　　HSVのSが0の場合にはHをどんなに変えても色は白です.
　　　fbxの拡散色として真っ白が設定されている場合、Sが0になっています.
　　　その状態から色を変えたい場合には、まずSとVを変えてからHを変えてください.
　　　


　RC2: HSV_Toonの修正
　　　色の境目ではない場所に細い筋が表示されていた不具合修正
　　　Testフォルダのモデルの設定を再修正
　RC3: メモリリーク解決
　　　AdditiveIK.cppにおいてID3D12DebugDeviceを使用してリークの詳細ダンプをした
　　　DirectXのCreate*関数で作成したオブジェクトにアロケート番号付きの名前をSetNameして調査
　　　ダンプにおいてdebugdevice以外のRefcountが0になった(IntRefには何か書いてあるが)
　　　メモリリークは解決したようだ
　RC4: HSV_Toonのライトの向きに関する修正
　　　Lightプレートメニューで有効にチェックしていないライト(の向きだけ)も選択可能に.
　RC5: ShaderプレートメニューのToonパラメータの数値テキストが見切れていたのを修正.
　RC6: ShaderプレートメニューとDispGroupプレートメニュー時のピック処理修正
　RC7: NumKeyピッキングの検索ループにおいて、同じオブジェクトを見つけた場合には階層数を足さずにcontinueするように.
　　　 DispGroupプレートメニューのTestボタンが機能していなかったのを修正





2024/02/14_1
　HSV_Toonの修正
　　シェーダでの法線の計算が間違っていたのを修正
　　BaseHSVの設定項目追加
　　HSV_Toon用のライトインデックス設定項目追加
　　Shaderメニューで全マテリアル設定を選んだ場合(見出し行のボタンを押した場合)の処理を修正
　PBR, StdのdiffuseMap参照の際にもHSV_Toonのテクスチャを参照
　PBRの法線修正
　　法線マップが無い場合には頂点法線を使用するように.
　Rigスプライトの画像ファイル更新
　　見やすく
　ZPreCullingをデフォルトでオフ
　TestフォルダのモデルのShader設定を修正
　　顔には陰が付かないように.




2024/02/13
　TOONシェーダ対応
　　NOLIGHTシェーダをTOONシェーダに変更
　　Shaderプレートメニューでマテリアルの名前のボタンを押してToonを選択すると機能
　　TOON用のライトとしてはLightプレートメニューの１番目のライトの向きを使用
　　マテリアルの拡散色から自動的にTOONテクスチャを作成しdiffuseMapとしてシェーダで使用
　　設定画面
　　　Shaderプレートメニューで設定
　　　面の法線(シェーダで少し加工)とライト向き(シェーダで少し加工)の内積をnlとして説明
　　　(nl + 1) / 2が　HiAddr以上の場合ハイライト色、HiAddrからLowAddrまでの場合拡散色、LowAddrよりも小さい場合陰色
　　　拡散色はfbxに指定してあるdiffuses色
　　　ハイライト色はdiffuse色をHSVに変換後AddH, AddS, AddVを施した色
　　　陰色はdiffuse色をHSVに変換後AddH, AddS, AddVを施した色
　　　各設定項目にはGUIスライダー有り
　　　プロジェクト保存時に*.stfファイルにテキスト保存、プロジェクト読み込み時に自動読込




2024/02/11
　AdditiveIK 1.0.0.7 release
　　1.0.0.6からの変更点
　　　不具合修正
　　　　LimitEulウインドウでCurrentBoneに対するFromCurrentMotionボタンを実行すると
　　　　　他のボーンの制限角度が０リセットされて動かなくなる不具合修正
　　　　　カレントボーンだけを初期化してからカレントボーンだけに値をセットするように.
　　　　　AllBoneボタンの処理はそのまま.
　　　　Brushesプレートメニューでアンドゥリドゥ時にウインドウが更新されない不具合を修正
　　　　BrushMethodのコンボボックスを変更してもアンドゥ用の保存がされていなかったのを修正
　　　　右ペインウインドウを開いたままリターゲットバッチを実行すると
　　　　　他のウインドウを表示した時に裏に残ったままになる不具合を修正
　　　　　リターゲットバッチ実行前に右ペインウインドウを閉じるように.
　　　　IKモードスプライト表示状態の初期値修正
　　　　　回転モードスプライトを初期状態でONに.
　　　　　(初期状態で回転モードになっていたが表示色がオフ色になっていた.)
　　　　アプリの終了処理を修正　　　


　　　クリック(ピック)＆セット　
　　　　DispGroupプレートメニュー選択時
　　　　マウス位置のメッシュ名をToolTip表示し、クリックしたモデルとメッシュを選択してGUIに反映
　　　　ただし背景だけ（スキンメッシュは未対応）

　　　　Shaderプレートメニュー選択時
　　　　マウス位置のマテリアル名をToolTip表示し、クリックしたモデルとマテリアルを選択してGUIに反映
　　　　ただし背景だけ（スキンメッシュは未対応）


　　　RefPos機能をDirectX12に対応させて復活
　　　　CameraAndIKプレートメニューのRefPosオンオフに対応.
　　　　スキンメッシュ(ボーンが入っているメッシュ)のみ対応.
　　　　複数残像を表示する機能ですがメッシュメモリは使いまわし、必要なメモリを残像１０個分アロケートします.
　　　　選択フレーム範囲を８分割して９個の残像フレームと１個のカレントフレームを表示します.
　　　　選択中のジョイントの軌跡を赤いソリッドコーンでインスタンシング表示. 動きが大きいほどコーンの大きさは大きい.
　　　　プレビューにも対応.
　　　　DispAndLimitsプレートメニューのRefPosAlphaで残像の透明度調整
　　　　DispAndLimitsプレートメニューのZCmpAlwaysチェックボックスでカレントフレームのZバッファ方式を切り替え


　　　RC2: クリック(ピック)＆セットの不具合修正
　　　　読み込みモデルによってはクリックしたメッシュやマテリアルに選択が切り替わらない不具合があったのを修正
　　　　pick構造体の初期化の値の問題だった
　　　RC3: クリック(ピック)＆セットに関する修正
　　　　メッシュやマテリアルをピックした際にモーション選択が変化してカメラ状態も変わる不便さをなるべく解消
　　　　ピック前後で選択モデルが同じ場合にはモデル選択関数を呼ばないように.
　　　RC4: 大きいサイズのfbxを読み込むと落ちやすい不具合が改善
　　　　GraphicsEngineのコンストラクタ記述によりConstantBuffer::CopyToVRAMで落ちなくなったようだ.
　　　　ただし1.0.0.7で１つのメッシュ当たりのビデオメモリ消費量が増えたので、大きいfbx読み込み時にビデオメモリ不足で落ちることはあります.
　　　RC5:
　　　　大きいfbx読み込み時にエラーで落ちる不具合には２つ原因があったので修正.
　　　　１つ目はメッシュタイプとシェーダ定数タイプの組み合わせミス(リファクタリング時のミス).　症状としてはConstantBuffer::CopyToVRAMで例外が出て落ちる.
　　　　２つ目はビデオメモリ不足. 症状としてはDescriptorHeapのCommit失敗ダイアログが出て落ちる.
　　　　以前読み込めていたものを読み込むことが出来るようにするために、RefPosの表示数を10個から4個に減らしビデオメモリの節約をした.
　　　　プロジェクト保存前にGUIを閉じるように修正.
　　　　ConstantBufferとDescriptorHeapをダブルバッファからシングルバッファに変更.
　　　　ConstantBufferとDescriptorHeapへのセットは計算関数からではなく、事前作成したものに対して描画関数から呼ぶのでメモリ節約のためにシングルにした.



2024/02/08
　アプリの終了処理を修正

　RefPos機能をDirectX12に対応させて復活(その２)
　　選択ジョイントの軌跡を赤いコーンでインスタンシング表示
　　軌跡のコーンは動きが大きいほど大きく表示


2024/02/07
　RefPos機能をDirectX12に対応させて復活(その１)
　　CameraAndIKプレートメニューのRefPosオンオフに対応.
　　調整機能は後で.
　　スキンメッシュ(ボーンが入っているメッシュ)のみ対応.
　　複数残像を表示する機能ですがメッシュメモリは使いまわし、必要なメモリを残像１０個分アロケートします.
　　選択フレーム範囲を８分割して９個の残像フレームと１個のカレントフレームを表示します.
　　プレビューにも対応.

2024/02/06
　プレビュー時はピックをスキップするように.
　　ただしカメラ操作はプレビュー中も可能に.

　プレビュー中は右クリック処理をスキップ.
　　ただしカメラのツイスト処理はプレビュー中も可能に.

　IKモードスプライト表示状態の初期値修正
　　回転モードスプライトを初期状態でONに.
　　(初期状態で回転モードになっていたが表示色がオフ色になっていた.)

2024/02/04
　DispGroupメニューとShaderメニューのピックよりもGUIのピックを優先


2024/02/03
　DispGroupプレートメニュー選択時
　マウス位置のメッシュ名をToolTip表示し、クリックしたモデルとメッシュを選択してGUIに反映
　ただし背景だけ（スキンメッシュは未対応）

　Shaderプレートメニュー選択時
　マウス位置のマテリアル名をToolTip表示し、クリックしたモデルとマテリアルを選択してGUIに反映
　ただし背景だけ（スキンメッシュは未対応）

　メモリの節約のために消していたデータの一部を消さないでpick処理に使用
　ただし背景だけ

　シャドウマップとPreZ処理でRGBAすべてに出力していたのにRGのフォーマットを指定していた部分で警告が出たので修正
　RGBAとして処理


2024/02/02
　未使用ファイル未使用クラスのダイエット
　　CModelクラスとModelクラスが存在するなど混乱の元なので使っていないものは削除しました.
　　レイトレーシングについても速い環境が手に入ってからということで削除.

　右ペインウインドウを開いたままリターゲットバッチを実行すると
　他のウインドウを表示した時に裏に残ったままになる不具合を修正
　　リターゲットバッチ実行前に右ペインウインドウを閉じるように.

　LimitEulウインドウでCurrentBoneに対するFromCurrentMotionボタンを実行すると
　他のボーンの制限角度が０リセットされて動かなくなる不具合修正
　　カレントボーンだけを初期化してからカレントボーンだけに値をセットするように.
　　AllBoneボタンの処理はそのまま.

　Brushesプレートメニューでアンドゥリドゥ時にウインドウが更新されない不具合を修正

　BrushMethodのコンボボックスを変更してもアンドゥ用の保存がされていなかったのを修正





2024/02/01
　AdditiveIK 1.0.0.6 release
　　1.0.0.5からの変更点
　　　不具合修正
　　　　カメラアニメ選択後にカメラの無いモデルを選択してプレビューすると
　　　　カメラアニメが再生されない不具合修正
　　　　最後に選択したカメラアニメが有効.
　　　　カメラの無いモデルのモーション編集中にもカメラアニメが動くように.


　　　ShaderプレートメニューのEmissionチェックボックスの隣にEmissiveScaleスライダーを追加
　　　Emissionに対して0%から100%まで倍率を指定
　　　fbxに既に設定してあるマテリアルのemissiveに対して作用.

　　　DispAndLimitsプレートメニューのEditRateの値の範囲を0倍から50倍までに.(変更前は０から１)
　　　CameraAndIKプレートメニューの移動モード時にもEditRateを考慮(回転モードは以前から対応しているが9.9度以上のステップにはならないリミッター有)
　　　広いステージをスプライトドラッグで移動する場合にも速やかに移動可能に.

　　　Shiftキーを押しながらスケールドラッグでXYZ全軸に対してスケール処理

　　　ToolButtonのモーションの補間機能がスケールに対応していなかったのを修正
　　　スケール対応
　　　対応前は例えば全体を５倍したモデルのフレーム範囲を補間した場合に
　　　補間区間のモデル倍率が１倍になってしまっていた.
　　　対応後は５倍されたまま姿勢が補間される.

　　　カメラアニメ計算時の時間を丸めないdoubleに.
　　　カメラに合わせてモデルのモーションを付ける際に
　　　モデルだけ補間されてカメラが補間されない場合に、モデルが画面上を行ったり戻ったりするようにみえる不具合解消のため.




2024/01/31
　ToolButtonのモーションの補間機能がスケールに対応していなかったのを修正
　　スケール対応

　カメラアニメ選択後にカメラの無いモデルを選択してプレビューするとカメラアニメが再生されない不具合修正
　　最後に選択したカメラアニメが有効.
　　カメラの無いモデルのモーション編集中にもカメラアニメが動くように.

　カメラアニメ計算時の時間を丸めないdoubleに.
　　カメラに合わせてモデルのモーションを付ける際に
　　モデルだけ補間されてカメラが補間されない場合に、モデルが画面上を行ったり戻ったりするようにみえる不具合解消のため.
　　


2024/01/30
　ShaderプレートメニューのEmissionチェックボックスの隣にEmissiveScaleスライダーを追加
　　Emissionに対して0%から100%まで倍率を指定
　　fbxに既に設定してあるマテリアルのemissiveに対して作用.

　DispAndLimitsプレートメニューのEditRateの値の範囲を0倍から50倍までに.(変更前は０から１)
　CameraAndIKプレートメニューの移動モード時にもEditRateを考慮(回転モードは以前から対応しているが9.9度以上のステップにはならないリミッター有)
　　広いステージをスプライトドラッグで移動する場合にも速やかに移動可能に.

　Shiftキーを押しながらスケールドラッグでXYZ全軸に対してスケール処理


2024/01/28
　使用例動画
　【モーキャプ】VRoidでプロのアセットを飛んでみた【編集ツール】
　 https://youtu.be/R0MsXt8plYg


2024/01/27
　AdditiveIK 1.0.0.5 release
　　1.0.0.4からの変更点
　　　不具合修正

　　　　既知の問題005の解決
　　　　　１メッシュに複数マテリアルが設定してあるfbxの書き出しに関する不具合修正.
　　　　　修正前の症状としては
　　　　　マテリアル番号オブジェクトが２つ出来て１つ目が未設定になりUnityでは読めるがMayaでは表示が指定通りでは無かった.
　　　　　修正後は
　　　　　UnityでもMaya2024でも指定通りの表示になった. 
　　　　　マテリアル番号オブジェクトが２つあるfbxを読み込んだ場合には書き出し時に２つ目を書き出すようにした.
　　　　　古いAdditiveIKで保存したfbxはver1.0.0.5で読み込んで保存し直すことでMaya2024でも正常に読み込めます.

　　　　既知の問題006の解決
　　　　　症状としては
　　　　　AdditiveIKで出力したfbxをMaya2024.2で読み込むとバインドポーズに関する警告が出てモーションが大きく変質する不具合.
　　　　　Maya2023.3では無警告で正常に読み込み正常に再生できる.
　　　　　解決方法としては
　　　　　古いAdditiveIKで保存したfbxはver1.0.0.5で読み込んで保存し直すことでMaya2024でも正常に読み込めます.

　　　　Testフォルダのモデルを1.0.0.5で読み込んで保存し直し

　　　　Hand_Closeリグで手を握った状態から開こうとするとうまくいかない不具合修正
　　　　　設定ファイル*.rigを更新
　　　　　親指の回転軸をNodeYに変更(変更前はCurrentY)



　　既知の問題
　　　問題006 (1.0.0.5 RC2で解決　RC3, RC4でリファクタリング)
　　　AdditiveIKで出力したfbxをMaya2024.2で読み込むとバインドポーズに関する警告が出てモーションが大きく変質する不具合.
　　　Maya2023.3では無警告で正常に読み込み正常に再生できる.
　　　###  1.0.0.5 RC2で解決  ###





2024/01/22
　既知の問題005が解決した
　　１メッシュ複数マテリアルのVRoidを読み込み保存してMaya2024で読み込んでもOK
　　これから他のものについてもテストしていく




2024/01/21
　AdditiveIK 1.0.0.4 release
　　1.0.0.3からの変更点
　　　不具合修正
　　　　BrushParamsプレートメニューでTopPosスライダー操作直後のIK中に、
　　　　3dwndのポーズの表示が変化しないことがある不具合を修正

　　　DispGroupの挙動を修正
　　　　グループごとに不透明はカメラから近い順、半透明はカメラから遠い順にソートしてから描画
　　　　Treeのグループ番号を大きい値に設定するだけで、ステージのTreeの影付き透過表示がうまくいくようになった

　　　メッシュ名右クリックのSimilarチェック時に
　　　メッシュ名先頭にPrefabがあった場合には２番目の'_'までをパターンとする

　　　Shadowプレートメニューのbias値の最大値を0.03に変更(変更前は0.01)

　　　対称コピーに関する修正
　　　　実際に有効な使用方法としてはRootBone:SymDirAndSymPosAndSymScaleだけとも言えるので
　　　　他のメニューはグレーアウト
　　　　部分的にペーストしたい場合には
　　　　上段カエルショートカットボタンの中のペーストボタンを"右"クリックして対象を絞って対称ペーストする

　　　IK操作中は30fps以上のマウス移動に対する処理をしないように修正
　　　　IKの後処理が重くなり過ぎないようにするため。
　　　　表示のfpsは今回の修正によっては制限を受けない

　　　Rigクリックだけで右ペインにクリックしたRigの設定画面を出すように.
　　　　設定中のRigと操作中のRigを一致させることにより、誤保存を回避、操作も効率的に。

　　　Test/3_Winter2_1モデルのRig設定を修正
　　　　このモデルはTestフォルダの中の他のVRoidよりも新しいVRoidで出力したモデル
　　　　新しいVRoidにはローカル軸が保存されるようになったようだ
　　　　それを踏まえて、新しいVRoidのリグの設定時には、軸の種類としてNodeX,NodeY,NodeZを選ぶと良い
　　　　特に足の部分のリグにはNodeX,NodeY,NodeZを選ばないとうまくいかないことが多い


　　備考
　　　ノーマルマップテクスチャの表示について
　　　テクスチャにはMipMapの処理を入れてある
　　　MipMapが本当に機能しているかどうかについてはまだ調べ切っていない
　　　PBR表示の際のノーマルマップテクスチャについては遠くのテクスチャにモアレが出ることがある
　　　PBRをオフにすると通常のテクスチャに対してはモアレは出ない
　　　ノーマルマップを施しているメッシュについてはLOD(詳細度切替機能)を使って
　　　遠くのオブジェクトに対してはノーマルマップ無しのモデルに置き換えるというのが良いと思っている




　　既知の問題
　　　問題005 (### 2024/01/22 　1.0.0.5に向けた修正にて解決 ###)
　　　１メッシュに複数マテリアルが設定してあるモデルの場合
　　　AdditiveIKで読み込んでから保存すると
　　　Unityではきちんと１メッシュに対して複数マテリアルが読み込まれるが
　　　Mayaではメッシュに１つのマテリアルしかアタッチされていないことがある
　　　という問題が起きています(Mayaでもマテリアル自体は読み込まれています)
　　　解決に時間が掛かりそうなのと他の不具合修正分を早く出したいので
　　　問題005は未解決ですが 1.0.0.4を出します





2024/01/20
　DispGroupの挙動を修正
　　グループごとに不透明はカメラから近い順、半透明はカメラから遠い順にソートしてから描画
　　　Treeのグループ番号を大きい値に設定するだけで、ステージのTreeの影付き透過表示がうまくいくようになった

　　メッシュ名右クリックのSimilarチェック時に
　　メッシュ名先頭にPrefabがあった場合には２番目の'_'までをパターンとする

　Shadowプレートメニューのbias値の最大値を0.03に変更(変更前は0.01)

　対称コピーに関する修正
　　実際に有効な使用方法としてはRootBone:SymDirAndSymPosAndSymScaleだけとも言えるので
　　他のメニューはグレーアウト
　　部分的にペーストしたい場合には
　　上段カエルショートカットボタンの中のペーストボタンを"右"クリックして対象を絞って対称ペーストする




2024/01/19
　不具合修正
　　BrushParamsプレートメニューでTopPosスライダー操作直後のIK中に、
　　3dwndのポーズの表示が変化しないことがある不具合を修正

　IK操作中は30fps以上のマウス移動に対する処理をしないように修正
　IKの後処理が重くなり過ぎないようにするため。
　表示のfpsは制限を受けない




2024/01/17
 動画作成
　【DirectX12】AdditiveIK新機能【モーキャプ編集】
　　VRoidとモーキャプをプロのアセットに盛り付けるツール
　　AdditiveIK(アディティブアイケー)
　　のアップデートのお知らせ

　　EditMot + DirectX12 でAdditiveIKとしてリスタート
　　DirectX12に対応し、魔導書２冊を導入して表示のテコ入れをしました。
　　主に新機能の紹介として次の９つの項目をざっくり説明しています。
　　１、LaterTransparent(モデル内半透明描画順序：まゆ毛透過)
　　２、Shader(シェーダー設定)
　　３、WorldPos(モデル位置設定)
　　４、DispGroup(モデル横断半透明描画順序)
　　５、Shadow(シャドウ設定)
　　６、Retarget(Rokokoモーションキャプチャをリターゲット)
　　７、BulletPhysics(物理シミュ設定)
　　８、LOD(詳細度切替設定)
　　９、AlphaMarks(マークの明るさと透明度設定)

　　https://youtu.be/oKGY62YosSg





2024/01/12
　AdditiveIK 1.0.0.3 release
　　1.0.0.2からの変更点
　　　不具合修正
       １メッシュに複数マテリアルがある場合に　面のマテリアル番号設定に問題があったのを修正
　　　　LaterTransparent設定ウインドウに　Albedoテクスチャ名がエントリーされていなかった不具合修正
　　　　　AlbedoでもNormalでもMetalでもないテクスチャ名だけがエントリーされていた不具合だった
　　　　　(修正前はVRoidではうまくいっていた)
　　　　BrushParamsプレートメニューのTopPosのテキスト表示更新に関わる不具合を修正
　　　　　フレーム選択変更時にTopPosのGUI表示が更新されていなかった
　　　　右ペインのウインドウのスクロールバードラッグのキャプチャとリリースに関して修正
　　　　　スクロールバードラッグ中に　画面外でマウスを離した場合に　挙動がおかしくなる不具合が直った
　　　　モデルを追加読み込みするとモーションスピードがスライダーの値と異なってしまう不具合を修正
　　　　　DispAndLimitsプレートメニューのSpeedスライダーの設定どおりになった

      ２つまでのマルチUVに対応
　　　　Albedo, Normal, Metal丸ごと一緒にUVSet0とUVSet1を切り替えるように.
　　　　DispAndLimitsプレートメニューに UVSetコンボボックスを追加
　　　インスタンシング表示
　　　　リグと剛体をインスタンシング表示(１モデルに対する１回の描画で複数個表示)
　　　　フォントとボーンマークは1.0.0.1からインスタンシング表示
　　　ボーンマークの明るさ、リグ(Rig)の透明度、剛体(Rigid)の透明度を設定可能に.
　　　　DispAndLimitsプレートメニューのスライダーで設定
　　　Rigの設定(ジョイント右クリック->Rig名->Settingメニューで出る)の回転軸の追加
　　　　CurrentX, CurrentY, CurrentZ,
　　　　ParentX, ParentY, ParentZ,
　　　　GlobalX, GlobalY, GlobalZ,
　　　　NodeX, NodeY, NodeZ
　　　　上記９種類に増やした
　　　　足の付け根UpperLegの前後回転軸はParentYとした
　　　　Testフォルダのrigファイルを更新
　　　　古い設定はCurrent*として扱う　　　
　　　マニピュレータの計算の修正
　　　　Hipsの特別扱いを止めて　Hips自身の回転を考慮するようにした
　　　　Rigの足の付け根(UpperLeg)の回転が　体全体の回転後も設定どおりに曲がるようになった
　　　テクスチャアドレッシングモードの読み込みと表示への適用と保存
　　　　サンプラーステートにも適用
　　　テクスチャ命名規則を少し修正(_Baseが加わった)
　　　　Albedoまたはalbedoまたは_Baseが名前にテクスチャをAlbedoMapとする
　　　　Normalまたはnormalが名前につくテクスチャをNormalMapとする
　　　　Metalまたはmetalが名前につくテクスチャをMetalMapとする
　　　VRoidに対する剛体作成の修正
　　　　VRoidの足の横に平行して作成されるCoatSkirt用のボーンに対しては自動で剛体を作成 "しない" ように修正
　　　ジョイントマークを修正
　　　　選択時は赤、非選択時は黄色に. 明るさ調整はスライダーで.
　　　モーションスピードの初期値を1.0に変更
　　　　変更前は3.0

　　　外部ライブラリのバージョンアップ(差し替え)
　　　　DirectXTK12をJun2023からDec2023に差し替え
　　　　DirectXTexをDec2023に差し替え

　　　モデル更新
　　　　Test/3_Winter2_1のモーションを修正
　　　　　全フレームのHipsのスケールを初期化
　　　　　スケール値に不具合を引き起こす値が入っていたようで
　　　　　Mayaで服のテクスチャが表示されなかったり　IK時に軸がブレたりした
　　　　　スケール初期化で直った


2024/01/11
　BrushParamsプレートメニューのTopPosのテキスト表示更新に関わる不具合を修正
　　フレーム選択変更時にTopPosのGUI表示が更新されていなかった
　モデルのインスタンシング表示に対応
　　ただし非スキンメッシュで１メッシュにつき１マテリアルのモデルに限る
　　インスタンシングには表示最大個数があり256個以上ある場合には１つも表示しないようにしています.
　　モデルごとの制限数なので人物ごとにfbxファイルを分けて読み込むと制限に収まると思います.
　リグの表示をインスタンシング方式に変更
　　CameraAndIKプレートメニューのRigボタンを押したときに表示されるリグに関する変更
　　アプリ起動の高速化
　　　アプリ起動時にリグを１００個読み込んでいたのが　４個の読み込みになった
　　球、リングX、リングY,リングZそれぞれリグについて24個までの制限. (個数は暫定)
　剛体マークをインスタンシング表示
　　剛体マークのオンオフはDispAndLimitsプレートメニューのDispRigidMarkチェックボックスで.
　　DispRigidMarkにチェックを入れても表示されない場合は剛体が作成されていない可能性が高い.
　　剛体を作成するには下段カエルボタンでRigidParamsメニューを出し
　　Valid/Invalidにチェックを入れてその右にあるToAllボタンを押すと一括作成されます.
　　　



2024/01/09
　Rigの設定(ジョイント右クリック->Rig名->Settingメニューで出る)の回転軸の追加
　　CurrentX, CurrentY, CurrentZ,
　　ParentX, ParentY, ParentZ,
　　GlobalX, GlobalY, GLobalZ,
　　NodeX, NodeY, NodeZ
　　上記９種類に増やした
　　足の付け根UpperLegの前後回転軸はParentYとした
　　Testフォルダのrigファイルを更新
　　古い設定はCurrent*として扱う
　マニピュレータの計算の修正
　　Hipsの特別扱いを止めて　Hips自身の回転を考慮するようにした
　　Rigの足の付け根(UpperLeg)の回転が　体全体の回転後も設定どおりに曲がるようになった
　右ペインのウインドウのスクロールバードラッグのキャプチャとリリースに関して修正
　　スクロールバードラッグ中に　画面外でマウスを離した場合に　挙動がおかしくなる不具合が直った
　モデルを追加読み込みするとモーションスピードがスライダーの値と異なってしまう不具合を修正
　　DispAndLimitsプレートメニューのSpeedスライダーの設定どおりになった


2024/01/08
　マルチUVの使い方を修正
　　Albedo, Normal, Metal丸ごと一緒にUVSet0とUVSet1を切り替えるように.
　　DispAndLimitsプレートメニューに UVSetコンボボックスを追加
　LaterTransparent設定ウインドウに　Albedoテクスチャ名がエントリーされていなかった不具合修正
　　AlbedoでもNormalでもMetalでもないテクスチャ名だけがエントリーされていた不具合だった


2024/01/07
　２個までのマルチUVに対応
　　ただし用途は限定　１つ目のUVはalbedoテクスチャ　２つ目のUVはノーマルマップとメタルマップ用
　　マルチUV対応で　ノーマルマップの模様ががカメラ距離で伸び縮みする不具合解消
　１メッシュに複数マテリアルがある場合に　面のマテリアル番号設定に問題があったのを修正
　テクスチャアドレッシングモードの読み込みと表示への適用と保存
　　サンプラーステートにも適用
　テクスチャ命名規則を少し修正(_Baseが加わった)
　　Albedoまたはalbedoまたは_Baseが名前にテクスチャをAlbedoMap
　　Normalまたはnormalが名前につくテクスチャをNormalMap
　　Metalまたはmetalが名前につくテクスチャをMetalMap
　DirectXTexをDec2023に差し替え


2024/01/05
　DirectXTK12をJun2023からDec2023に差し替え.
　　MiniEngine直下に置いていたd3dx12.hも更新
　　d3dx12.hのwarningが出なくなった.
　　遠くのテクスチャの画質が良くなったような気がする?

　既知の問題と対処法
　　問題004
　　　ジョイントの方向(いわゆる初期姿勢)として　X180, Y90, Z0が設定されているfbxの書き出しが変質する不具合がある。
　　　書き出し時だけ問題が出る。読込とリターゲットはうまくいく。
　　　X180, Y90, Z0の初期姿勢が設定されているモーションに対しては
　　　読み込み後に普通の軸のモデルにリターゲットしてから保存してください。





2024/01/04
　AdditiveIK 1.0.0.2 release
　　1.0.0.1からの変更点
　　　不具合修正
　　　　ボタンを押してもShader設定ダイアログが出ないことがある不具合修正
　　　　Rigの設定が意図せず重複して片方を選べなくなる不具合修正
　　　　シャドウの向きを修正
　　　　マニピュレータの軸(計算と表示共に)がparent側に１階層分ずれていたのを修正
　　　　　体全体を９０度回転した場合に足の付け根のRigの軸が設定と異なる現象を追いかけていたら発覚
　　　　　IK操作、Rig操作とRigの設定に影響
　　　　　軸の種類はDispAndLimitプレートメニューのAxisKindコンボボックスで
　　　　　Current, Parent, Global, Nodematから選択可能. 
　　　　　今回の修正をする前の振る舞い再現はAxisKindでParentを選択すれば可能(Rigの設定が昔のままの場合).
　　　　　IK操作の軸が操作中にブレないことを再確認
　　　LOD機能追加　ProjAndLODプレートメニュー追加
　　　MipMap対応
　　　　テクスチャ読み込み時に全レベルMipMapを作成して転送
　　　　サンプリングステートでMipを有効に
　　　VRoid特有のジョイント名がある場合には　シェーダー設定がAUTOのときにNOLIGHTを適用してトゥーン風に表示
　　　ブラシ設定のRepeatsのスライダーの最大値を100に.(変える前は10)
　　　起動時の初期値を変更
　　　　HighRpmを最初から有効に.
　　　　4Kモード時には　ZprepassCullingを最初から有効に.
　　　ツールショートカットボタンのModelWorldMat設定ウインドウにカメラ位置、カメラ注視点にモデルを置くボタンを追加
　　　シャドウのbiasスライダーの最小値を0に.(変更前は0.001)
　　　Testフォルダにモデル追加　
　　　　Test/3_Winter2_1
　　　トラブルシューティング追加
　　　　Documsnts/TroubleShooting/AboutSettingsOfLOD.docx
　　　　Documsnts/TroubleShooting/AboutSettingsOfShader.docx
　　　　Documsnts/TroubleShooting/AboutSettingsOfShadow.docx
　　　　Documsnts/TroubleShooting/DarkNoiseOn3DScreen.docx
　　　　Documsnts/TroubleShooting/HowToImproveJaggedImageQuality.docx
　　　　Documsnts/TroubleShooting/Partially180DegreesDifferent.docx




2024/01/02
　Testフォルダにモデル追加
　　Test/3_Winter2_1
　　VRoid製のモデルです  ３万数千ポリゴンです
　VRoid特有のジョイント名がある場合には　シェーダー設定がAUTOのときにNOLIGHTを適用してトゥーン風に表示
　ブラシ設定のRepeatsのスライダーの最大値を100に.(変える前は10)
　トラブルシューティング追加
　　Documsnts/TroubleShooting/AboutSettingsOfLOD.docx
　　Documsnts/TroubleShooting/AboutSettingsOfShader.docx
　　Documsnts/TroubleShooting/AboutSettingsOfShadow.docx
　　Documsnts/TroubleShooting/DarkNoiseOn3DScreen.docx




2024/01/01
　MipMapに対応
　　とりあえず対応しました
　　何回もテストをしましたが正しく出来ている確信はまだ無いです
　　Stdシェーダーはきれいになったと思います　しかし、PBRの遠くのざらざらしているノーマルマップはまだ縞模様になったりしています




2023/12/30
 前述問題002に対応
　　ProjAndLODプレートメニュー追加
　　プロジェクションとLODのパラメータを設定可能に
　　プロジェクションとLODの設定はプロジェクトファイル(*.cha)保存時に保存、プロジェクトファイル読み込み時に読み込み
　　効果について
　　　少し試してみて感想
　　　LODで高速化の効果を出すのは結構大変(データ作成やシーンとしての最適化が難しい)
　　　それでもLOD0, LOD1のクリッピング距離を最低値に近づけると多少効果はあった
　　　プロジェクションパラメータを絞り込む方が目にみえて効果がある
　　　例えばFov(視野角)をシーンが欠けない程度に小さくする
　　　例えばnearを出来るだけ大きく、farを出来るだけ小さく(near < farの範囲で)
　　　####!!!!  4KモードにおいてはDispAndLimitsメニューのZPrePassCullingがとても効果的  !!!!####
　　　DispAndLimitsメニューでDispBoneMarkをオフにしても効果有
　　　DispAndLimitsメニューでHighRpmにしてからUpdateThreadsスライダーを調整
　　　上記パラメータ設定にての合わせ技にて
　　　当方の環境(古めの８コアPC+RTX2080)では４Kモード(ウインドウ大モード)でアセットシーンがどれも33fps程になった
　　　最近のゲーミングPCでなら60fpsを越えるものと思われる　(とにかく重い処理をしているのだからしょうがない)
　12/30 その２
　　ProjAndLODメニューのFOV(視野角)の設定がカメラの設定に適用されていなかったのを修正
　　(クリッピングにだけ反映されていた)
　　FOVは焦点距離に関係する. 小さくするほど描画は速くなるが絵の奥行き感が減る.
　　視野内判定ChkInViewを最適化して少し高速化.
　12/30 その３
　　起動時の初期値を変更
　　　HighRpmを最初から有効に.
　　　4Kモード時には　ZprepassCullingを最初から有効に.
　　ProjAndLODメニューのFOV(視野角)のスライダーの最大値を179degreeに.

　　前述の既知の問題001, 002, 003について対応済とする
　　　問題001
　　　　 ShaderParamsDlgProcの問題だった。WndProcを回すべきところで回っていなかったのを修正
　　　　解決
　　　問題002
　　　　直しながら症状をみたが　計算による遅さというよりも描画そのものの重さのようだ
　　　　思いついた対策はしたが　とりあえずここまでとする
　　　　当方のビデオカードはRTX2080で今でも速い部類のようだが　現行のRTX4070は２倍速いらしい
　　　　現状でも４Kモードでもなんとか30fps出るので　開発環境についてはゆっくり考える
　　　問題003
　　　　Rig設定ウインドウを出すときに　右ペインウインドウ全てを閉じるようにして解決
　　
　　



2023/12/27 既知の問題と対処法について
　問題001(2023/12/30解決)
　　カメラ操作用スプライトをマウスでドラッグし、
　　右ペインのメニューボタン上でマウスを離すと
　　右ペインウインドウの設定ボタン類を押しても無反応になる
　対処方
　　右ペインのメニューボタン上ではマウスを離さない
　プログラム修正予定　：　有

　問題002(2023/12/30解決)
　　アセットの表示が重すぎる
　原因
　　表示詳細度切り替え用のLODオブジェクト全てを
　　重ねて表示している状態
　対処法
　　DispGroupメニューで
　　非表示にしたいオブジェクトにグループ番号を付けてから
　　非表示ボタンを押す
　プログラム修正予定　：　有

　問題003(2023/12/30解決)
　　Rigの設定でRigの名前が既存Rigの名前と同じになり
　　選択不能になる
　原因
　　Rigの設定ウインドウが開いている状態で
　　他のRigの設定ウインドウが開いてしまい
　　保存時に同じ内容になる
　対処法
　　右ペインのXボタンで
　　Rig毎に手動でウインドウを閉じてから
　　次のRigウインドウを開いて設定する
　プログラム修正予定　：　有




2023/12/24
AdditiveIK 1.0.0.1 release




2023/12/23
AdditiveIK 1.0.0.1 RC6(リリース候補6)
　１段目と２段目のプレートメニュークリックで出る右ペインウインドウが重なって表示されていた不具合修正
　iniファイルのファイル名修正
　Testフォルダのモデルデータのまゆ毛透過をLaterTransparentメニューで設定
　TestフォルダのSpring1の髪の毛がまだ少し肩に食い込んでいたので調整
　ファイルオープンダイアログのTestフォルダのパスが古かったのを修正




2023/12/22
AdditiveIK 1.0.0.1 RC5(リリース候補5)
　ShaderTypeウインドウ、ShaderTypeParamsダイアログの挙動修正

AdditiveIK 1.0.0.1 RC4(リリース候補4)
　ShaderTypeダイアログがスクロール出来ていなかったのを修正.
　ShaderTypeParamsダイアログにEnableEmissionチェックボックスを追加.
　　色の計算にEmissionを含める場合にはEnableEmissionにチェックを入れる.
　　EnableEmissionの初期値はfalse.
　マニピュレータの色調整.
  fps数字表示位置を少し下に移動.



2023/12/21
AdditiveIK 1.0.0.1 RC3(リリース候補3)
　デバッグビルドで　レンダー時にバリアの警告が出ていた問題について修正
　README.mdに使い方を追記




2023/12/19
AdditiveIK 1.0.0.1 RC2(リリース候補2)
　ダイアログの最初の出現位置をセンターにしつつ　操作中に元の位置に戻らないように.
　Rigボタンを押したときのRigの表示. Rigは球、RingX, RingY, RingZの４種類あり　それぞれ24個までの制限に.
　準備中のウインドウ領域が白くならないように.



2023/12/18
AdditiveIK 1.0.0.1 RC1(リリース候補1)
　Shadowパラメータを８スロット分設定可能に.
　Shaderのライトスケール最大値を5.0に.
　ダイアログのセンターに配置し直す機能はデスクトップの(0, 0)に表示しようとした場合にだけ.
　プレビュー中はプレートメニューを非表示に.
　Documents/TroubleShooting追加

　機能していない設定画面もありますが　年内に一度リリースしておきたいので　いったんここで区切ります




2023/12/17
ピクセルシェーダ内の計算が有効なライトの個数分だけループするように.
HDRP対応
　ライトスライダーの上限値を3.0に. Shaderのライト倍率の上限値も3.0に.
HDRP Bloomエフェクト追加
　色の値が1.0を越えた部分にブルームがかかり　周りに淡く広がりを持つ表示になります
　シェーダーをStdにして　ライトを1.0以上にすると　効果が掛かりやすい
README.mdのスクリーンショット更新



2023/12/15
Shadowプレートメニュー追加
　設定はアプリ終了時にtempフォルダに保存し　起動時に自動読込
DispAndLimitsメニューに　Free fpsチェックボックス追加
　FreeFpsをオンにするとfpsは大きくなりますが　
　可変周波数対応モニタ以外でオンにすると　ティアリングが起こることがあります
Shadowメニューに　EnableShadowチェックボックス追加
　シャドウ表示をオンオフ出来ます



2023/12/14
デプスシャドウ機能を追加
　テストとしてカメラから選択モデルのHipsジョイントの方向へシャドウ用のライトを向けています
プロジェクト保存時に　Shaderメニューのsmoothcoefも保存
デプスシャドウのスクリーンショットをREADME.mdに追加
デプスシャドウリファクタリング　必要不要を試行錯誤して判断しメモリの不要な多重化をやめた




2023/12/10
MetalSmoothMapの　rにmetalcoefを　aにsmoothcoefを掛けて調整
　ShaderメニューのMetalCoefスライダーとSmoothCoefスライダーで設定
　手持ちのアセットで試したところ　smoothCoefの方が影響が大きい　smoothが大きいほど白く小さいほど拡散色が出る
ShaderTypeParamsDlgでの設定値をShaderTypeWndにも反映
ツールボタンショートカットアイコンのMaterialRate設定の内DiffuseRateとSpecularRateをシェーダに反映
　モデル単位でDiffuseとSpecularに倍率を掛けることが可能
　AUTO, PBR, STD, NOLIGHTに対して効果有



2023/12/09
ZPrepassクリッピングをDispAndLimitsメニューのオプションに.
　シーンによって効果がある場合と　マイナス効果になる場合があったので必要に応じて.
PBR時NormalMapが無い場合には　GetNormalMap()はblackMapを返すように.
　PBRにはnormalMapは必須という前提だがそれが無い場合の対応.
　whiteMapを返すと法線の向きが変わってしまうのでblackMapを返すことに.
シェーダ定数の転送は　シェーダファイル毎描画フレーム毎に１回にしてみた
　fpsに変わりはなかった


2023/12/08
Shaderプレートメニュー追加
　Shaderの設定をマテリアルごとに設定する仕様に変更.
　Shaderメニューのウインドウの見出し行のボタンで全マテリアルに対しての設定も可能.
　マテリアルごとにシェーダータイプ、メタル係数、ライトスケールx8個の設定が可能.
　プロジェクトファイル保存時に他のファイルと共に*.stfファイルとして保存、プロジェクト読み込み時に自動読込
ライトパラメータのシェーダへの転送が十分ではなかったのを修正
デフォルトのメタル係数を0.7から0.25へ変更
アプリのアイコンを変更(再起動しないと変更が反映されないこともあるようです)
README.mdのスクリーンショットを更新


2023/12/06
Lightプレートメニューの設定をシェーダーに反映.
ライトの数は８個まで.
矢印キーによるジョイント階層ウインドウの選択移動機能を復活


2023/12/05
ZPrepassレンダーを導入. カラー描画前にZバッファを構築する方法. 画面手前に遮蔽物があるほど描画が高速化.
ZPrepassレンダー時には半透明メッシュはZバッファに書き込まないように.
ZPrepassは4KTVモードでは遮蔽面積が大きいため効果があるが2KTVモードではZ書き込みコストの方が効果よりも大きい
ZPrepassは4KTVモードのときだけ有効にした.
シェーダーとパイプラインについてリファクタリングし　DispParamsプレートメニューのShaderTypeでAuto, PBR, STD, NOLIGHTを切り替え可能に.
法線マップを設定していないモデルに対してPBRを選択すると　法線が０となり黒い表示になることに注意
ShaderTypeでAUTOを選んだ場合のシェーダー設定は以下
　スキンメッシュについては　[Albedo無しまたはNormal有またはMetal有]->PBR,　[Albedoだけ有またはテクスチャ１つも無し]->NOLIGHT
　非スキンメッシュについては　[Albedo無しまたはNormal有またはMetal有]->PBR,　[Albedoだけ有またはテクスチャ１つも無し]->STD
スキンメッシュと非スキンメッシュそれぞれのShaderTypeに対して　不透明、半透明、半透明常時上書きの設定があり自動設定



2023/12/04
PBR対応開始
//############
// UnityAssetをUnityでfbxエクスポートする場合、全てのマテリアルのシェーダーをStandardにするとfbxにテクスチャ名が出力される
// それ用のEditorスクリプトをみつけてきて使っています
//############
テクスチャ無しの場合とノーマルマップまたはメタルマップがある場合にPBR、それ以外の場合にStandardで描画
プロジェクト保存時　fbxのPBR用テクスチャ(albedo, normal, metal)も保存
描画はモデルを横断してDispGroupNo順に行っている　DispGroupNo == 1以外の描画時には強制的に半透明描画
//############
//pMesh->GetNode()に対してGetMaterial(i)を呼んでマテリアル情報を取得すると不正な情報が入っていた
//マテリアル名に本来のマテリアル情報とは異なるtypo_2という名前, テクスチャにtype_2.pngが入っていた
//pMesh->GetNode()はマテリアル情報のためには使わないことに.
//############


2023/12/02
もう少し前準備として　不透明半透明のパイプライン切り替え　ボーンマトリックス更新最適化
プロジェクト保存時にfbxのテクスチャが保存されなくなっていたのを修正
Testフォルダをgit add. モデルはVRoid.


2023/12/01
描画を綺麗にする前に目立った不具合に対応
MaterialBankをモデル(fbx, mqo)ごとに持つように修正
マテリアル番号の重複によるマテリアルずれ解消
マニピュレータ不具合解消
ボーンマトリックスの転送を毎回の描画のマテリアルごとに１回に絞り少しだけ高速化


2023/11/30
MaterialBankを追加することにより大きい背景fbxも読み込めるようになった
ただし１つのfbxにつきボーン数は1000個までという制限付き
デスクリプタヒープの数を減らすことにより背景を読めるようになったのだが
マテリアルごとに全部のボーン姿勢を転送しなくてはならなくなり重くなってしまった
マニピュレータの常時上書き設定は一時的に効かなくしている
明日は背景を綺麗に表示するために修正する予定(予定)


2023/11/29
DescriptorHeapに関するリファクタリング
大きい背景読み込み時に4038個目のDescriptorHeap作成でE_OUTOFMEMORYになる症状は変わらず
背景の描画をきれいにしたかったのだが　どうするか試しながら考える


2023/11/28
プレートメニューを２段構成に.
１段目は常時固定メニュー. ２段目はカエルボタンで変化.
１段目のメニューに対するGUIは右ペインウインドウに表示.
１段目と２段目のメニューに関わる作業を行き来するに便利なようにしたつもり.
１段目のCameraAndIKは他のメニューとは独立してトグル.
１段目のCameraAndIK以外は１段目の他のメニューをオンにしたときにオフになる.
２段目のプレートをオンにすると１段目のCameraAndIK以外はオフになる.


2023/11/27
レンダリングエンジンにフォント表示を追加
ツールチップを表示
線だけで構成されたメッシュの表示にも対応
地面データとして線で出来た格子と軸を表示


2023/11/26
選択ジョイントの位置にマニピュレータを表示
マウスホバーでマニピュレータをハイライト表示
物理プレイボタンと物理ベイクボタンをプレイヤーボタンに追加
レンダリングエンジンにスプライト描画処理を追加.
ジョイント位置にスプライト表示. マークは白、セレクトツリーは赤.


2023/11/25
魔導書のSpriteクラスを拡張してインスタンシングに対応させたInstancedSpriteクラス新規
同じスプライトを違う場所違う大きさで描画可能
InstancedSpriteでfpsとアンドゥバッファ位置を表示
GUIに関しては現在のウインドウに重ねて表示できるものがみつからないため　右ペインに通常通り表示する予定に変更
なるべくクリック回数が増えないように段階を追って改善していくつもり
関節部ドラッグでとりあえずAdditiveIK出来るようにしました.　ブラシパラメータ設定などはGUIを準備してから.


2023/11/23
デバッグビルドで実行終了時に表示されるメモリリークが気になってリファクタリング
メモリリークは無くなった?


2023/11/22
スプライトGUIを魔導書のSpriteクラスで.
プロジェクトやfbxを読み込むとプレートメニューが出ます.
下の方のカエルボタンでメニュー変更. 上の方のカエルボタンでショートカットボタンを変更.
Documents/ModifyAboutGrimoireSpriteClass.docx追加
Documents/CoexistenceOfConventionalMaterialsAndPBR.docx追加
カメラ操作を有効に. CameraAndIKプレートをクリックしてボタンを出し、３つのカメラボタンドラッグでカメラ操作.
モーションのプレビューが出来るようになりました.
モーション付きモデルを読み込み後にタイムラインのプレイマークのボタンでプレビュー.


2023/11/20
Texture設定の無いメッシュ描画時には白いalbedoテクスチャを使用
マテリアルのdiffuse色のテクスチャを作成してalbedoテクスチャと乗算して描画
このようにすることで　古いマテリアル形式と将来対応するPBRとが共存出来る可能性
4KTV接続時にアプリウインドウ大と小を選べるように


2023/11/19
Texture表示が可能になった
透過テクスチャを有効に
透過テクスチャ遅延描画順機能(LaterTransparent)を有効に


2023/11/18
DirectX12による表示開始
とりあえず　白いシルエットでモデルを表示
VRoidモデルはシルエット表示できた
仕組みとしてはテクスチャに対応しているのだが　シェーダーでテクスチャを使うと何も表示されなかった
4000個くらいメッシュがあるfbxを読み込むとアウトオブメモリエラーだった
次回はテクスチャを表示したい


2023_11_14
もの凄い作り直しをしようとしていましたが　考えた結果　表示とUIの挿げ替えをすることに
MameBake3Dの表示をPBRとカスケードシャドウに対応させて　UIはimguiで表示するための作業をしていく 予定
とりあえずDX12用のファイルを足して　DX11をコメントアウト　してビルドして起動可能に
まだモデルを表示できない状態


2023_11_12
まずはAdditiveIKのレポジトリを作成
MameBake3D + HLSシェーダーの魔導書(DirectX12)の描画　+ DirectX12の魔導書のDX12文法 + bullet physicsからスタートする予定
ビルドは出来ますがまだ動きません　これからです.








